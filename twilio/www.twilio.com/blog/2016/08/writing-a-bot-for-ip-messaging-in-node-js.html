<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:10:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<script type="text/javascript">
(function() {
    var projectId = 3524915770;
    var protocol = ('https:' == document.location.protocol ?
    'https://' : 'http://');
    var scriptTag = document.createElement('script');
    scriptTag.type = 'text/javascript';
    scriptTag.async = true;
    scriptTag.src = protocol + 'cdn.optimizely.com/js/' +
    projectId + '.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(scriptTag, s);
})();
function optimizelyTimeout() {
    window.optimizely = window.optimizely|| [];
    if (!window.optimizely.data) {
    window.optimizely.push("timeout");
    }
}
setTimeout(optimizelyTimeout, 1000);
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://www.twilio.com/blog/xmlrpc.php">
<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '815114181']);
_elqQ.push(['elqTrackPageView']);
_elqQ.push(['elqUseFirstPartyCookie', 'www.twilio.com']);
(function () {
  function async_load()
  {
    var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
    s.src = 'http://img03.en25.com/i/elqCfg.min.js';
    var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
  }
  if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
  else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','http://connect.facebook.net/en_US/fbevents.js');

fbq('init', '467131150158811');
fbq('track', "PageView");</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=467131150158811&amp;ev=PageView&amp;noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->

<style>
@media screen and (max-width: 600px) {
  #signal-header { display: none; }
}
</style>

<link type="text/css" media="all" href="https://www.twilio.com/blog/wp-content/cache/autoptimize/css/autoptimize_7a2cc50131d932d32297f43c61de37cd.css" rel="stylesheet" /><link type="text/css" media="screen" href="https://www.twilio.com/blog/wp-content/cache/autoptimize/css/autoptimize_97ca666341cd9b69002e26c8f2ca5299.css" rel="stylesheet" /><title>Writing a bot for Programmable Chat in Node.js &#8211; Twilio Cloud Communications Blog</title>

<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.13 - http://yoast.com/wordpress/seo/ -->
<meta name="description" content="Learn how to create your own chat bot for IP Messaging using Node.js and Express."/>
<link rel="canonical" href="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" />
<!-- / Yoast WordPress SEO plugin. -->

<link rel='dns-prefetch' href='https://www.twilio.com/blog//s0.wp.com' />
<link rel='dns-prefetch' href='https://www.twilio.com/blog//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Twilio Cloud Communications Blog &raquo; Feed" href="https://www.twilio.com/blog/feed" />
<link rel="alternate" type="application/rss+xml" title="Twilio Cloud Communications Blog &raquo; Comments Feed" href="https://www.twilio.com/blog/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Twilio Cloud Communications Blog &raquo; Writing a bot for Programmable Chat in Node.js Comments Feed" href="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/twilioinc.wpengine.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.2"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>










<!-- This site uses the Google Analytics by Yoast plugin v5.4.7 - Universal enabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','http://www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-2900316-1', 'auto');
	__gaTracker('set', 'forceSSL', true);
	 window.optimizely = window.optimizely || [];
 window.optimizely.push("activateUniversalAnalytics");
	__gaTracker('set', 'dimension4', 'Dominik Kundel');
	__gaTracker('set', 'dimension5', 'post');
	__gaTracker('set', 'dimension6', 'all-things-code');
	__gaTracker('set', 'dimension7', 'IP Messaging,js,nodejs,Programmable Chat,Twilio IP');
	__gaTracker('set', 'dimension8', '2016-08-29T11:47:41+00:00');
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by Yoast -->


<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.4.3","is_admin":"0","ajaxurl":"https:\/\/twilioinc.wpengine.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>

<script type='text/javascript'>
/* <![CDATA[ */
var swiftypeParams = {"engineKey":"UpGyyJZzgUMXHM65YENj"};
/* ]]> */
</script>

<link rel='https://api.w.org/' href='https://www.twilio.com/blog/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.twilio.com/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.twilio.com/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://www.twilio.com/blog/?p=18663' />
<link rel="alternate" type="application/json+oembed" href="https://www.twilio.com/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.twilio.com%2Fblog%2F2016%2F08%2Fwriting-a-bot-for-ip-messaging-in-node-js.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.twilio.com/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.twilio.com%2Fblog%2F2016%2F08%2Fwriting-a-bot-for-ip-messaging-in-node-js.html&amp;format=xml" />
<link rel="icon" href="https://www.twilio.com/blog/wp-content/uploads/2015/09/cropped-favicon_1141-32x32.png" sizes="32x32" />
<link rel="icon" href="https://www.twilio.com/blog/wp-content/uploads/2015/09/cropped-favicon_1141-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://www.twilio.com/blog/wp-content/uploads/2015/09/cropped-favicon_1141-180x180.png" />
<meta name="msapplication-TileImage" content="https://www.twilio.com/blog/wp-content/uploads/2015/09/cropped-favicon_1141-270x270.png" />
</head>

<body class="single single-post postid-18663 single-format-standard group-blog">
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.twilio.com/blog//www.googletagmanager.com/ns.html?id=GTM-W4RVXH"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W4RVXH');</script>
<!-- End Google Tag Manager -->

<div id="fb-root"></div>
<script>(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "http://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=414254592083321&version=v2.0";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));
window.fbAsyncInit = function() {
  FB.Event.subscribe('edge.create', function(targetUrl) {
    __gaTracker('send', 'social', 'facebook', 'like', targetUrl);
  });
};
window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));

function trackTwitter(intent_event) {
  if (intent_event) {
    var opt_pagePath;
    if (intent_event.target && intent_event.target.nodeName == 'IFRAME') {
          opt_target = extractParamFromUri(intent_event.target.src, 'url');
    }
    __gaTracker('send', 'social', 'twitter', 'tweet', opt_pagePath);
  }
}

function extractParamFromUri(uri, paramName) {
  if (!uri) {
    return;
  }
  var regex = new RegExp('[\\?&#]' + paramName + '=([^&#]*)');
  var params = regex.exec(uri);
  if (params != null) {
    return unescape(params[1]);
  }
  return;
}

//Wrap event bindings - Wait for async js to load
twttr.ready(function (twttr) {
  //event bindings
  twttr.events.bind('tweet', trackTwitter);
});
</script>
<script type="text/javascript">
  window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var n=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(n?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o);for(var r=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=r(p[c])};
  heap.load("1541905715");
</script>
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<nav class="navbar navbar-default" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle hidden-xs" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://www.twilio.com/blog/">
					<img src="https://s3.amazonaws.com/ahoy-assets.twilio.com/global/images/wordmark.svg" width="200"> <span class="logo-blog">blog</span>
				</a>
			</div>

			<div class="hidden-xs"><ul id="menu-site-navigation" class="nav navbar-nav pull-right"><li id="menu-item-12202" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12202"><a href="http://www.twilio.com/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.twilio.com/', 'Home');" title="Home">Home</a></li>
<li id="menu-item-12205" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12205"><a href="http://www.twilio.com/blog" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.twilio.com/blog', 'Blog');" title="Blog">Blog</a></li>
<li id="menu-item-12204" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12204"><a href="https://www.twilio.com/docs/howto" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://www.twilio.com/docs/howto', 'Tutorials');" title="Tutorials">Tutorials</a></li>
<li id="menu-item-12206" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12206"><a href="https://www.twilio.com/docs/api" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://www.twilio.com/docs/api', 'Docs');" title="Docs">Docs</a></li>
<li id="menu-item-12207" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12207"><a href="http://www.twilio.com/help" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.twilio.com/help', 'Help');" title="Help">Help</a></li>
<li id="menu-item-12208" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12208"><a href="https://www.twilio.com/login" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://www.twilio.com/login', 'Login');" title="Login">Login</a></li>
<li id="menu-item-12209" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12209"><a href="https://www.twilio.com/try-twilio" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://www.twilio.com/try-twilio', 'Signup');" title="Signup">Signup</a></li>
</ul></div>		</div>
	</nav>

	<div id="content" class="site-content container">
		<div class="row">

	<div id="primary" class="content-area col-md-9">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-18663" class="row post-18663 post type-post status-publish format-standard has-post-thumbnail hentry category-all-things-code tag-ip-messaging tag-js tag-nodejs tag-programmable-chat tag-twilio-ip">
	<header class="entry-header col-md-12">
		<h2 class="entry-title">Writing a bot for Programmable Chat in Node.js</h2>
						<div class="entry-image col-md-12">
        <img width="640" height="274" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/AKIvGY1sDFtPrrqtVXUOdufg1J3pVc9XRJKSyQu0ysca8K9Z6xYZ_T_jxDWot-lAwIuLqjkAt-UIBVDhm-_KW1_-2ofjagu5jS6e7eOpjELQKtOJUAfRD7fbreXVBJAYE5zpDw9b.png" class="img-responsive wp-post-image" alt="AKIvGY1sDFtPrrqtVXUOdufg1J3pVc9XRJKSyQu0ysca8K9Z6xYZ_T_jxDWot-lAwIuLqjkAt-UIBVDhm-_KW1_-2ofjagu5jS6e7eOpjELQKtOJUAfRD7fbreXVBJAYE5zpDw9b" srcset="https://www.twilio.com/blog/wp-content/uploads/2016/08/AKIvGY1sDFtPrrqtVXUOdufg1J3pVc9XRJKSyQu0ysca8K9Z6xYZ_T_jxDWot-lAwIuLqjkAt-UIBVDhm-_KW1_-2ofjagu5jS6e7eOpjELQKtOJUAfRD7fbreXVBJAYE5zpDw9b.png 700w, https://www.twilio.com/blog/wp-content/uploads/2016/08/AKIvGY1sDFtPrrqtVXUOdufg1J3pVc9XRJKSyQu0ysca8K9Z6xYZ_T_jxDWot-lAwIuLqjkAt-UIBVDhm-_KW1_-2ofjagu5jS6e7eOpjELQKtOJUAfRD7fbreXVBJAYE5zpDw9b-300x129.png 300w, https://www.twilio.com/blog/wp-content/uploads/2016/08/AKIvGY1sDFtPrrqtVXUOdufg1J3pVc9XRJKSyQu0ysca8K9Z6xYZ_T_jxDWot-lAwIuLqjkAt-UIBVDhm-_KW1_-2ofjagu5jS6e7eOpjELQKtOJUAfRD7fbreXVBJAYE5zpDw9b-200x86.png 200w" sizes="(max-width: 640px) 100vw, 640px" />			</div>
      <div class="clear"></div>
			
		<footer class="entry-footer">
			<div class="entry-meta">
					<div class="row">
	<div class="col-md-6">
	<span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://www.twilio.com/blog/author/dominik">Dominik Kundel</a></span></span> on <span class="posted-on"><a href="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" rel="bookmark"><time class="entry-date published" datetime="2016-08-29T11:47:41+00:00">August 29, 2016</time><time class="updated" datetime="2016-11-21T07:46:47+00:00">November 21, 2016</time></a></span>	</div>
	<div class="col-md-6">
		<div class="social-buttons">
			<div class="fb-like" data-href="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" data-layout="button" data-action="like" data-show-faces="false" data-share="false"></div>
			<a href="https://twitter.com/share" class="twitter-share-button" data-via="twilio" data-count="none" data-url="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" data-text="Writing a bot for Programmable Chat in Node.js ">Tweet</a>
      <a href="https://twitter.com/twilio" class="twitter-follow-button" data-show-count="false">Follow @twilio</a>
		</div>
	</div>
	</div>
			</div><!-- .entry-meta -->
		</footer><!-- .entry-footer -->
	</header><!-- .entry-header -->

	<div class="entry-content col-md-12">
		<div class="row">
			<div class="col-md-12">
				<p>It seems like bots are the new hot thing that every chat supports. They usually <a href="https://www.twilio.com/blog/2016/05/build-sms-slack-bot-python.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/blog/2016/05/build-sms-slack-bot-python.html', 'augment conversations');">augment conversations</a> or they can <a href="https://www.twilio.com/blog/2016/05/creating-a-phone-number-lookup-bot-using-microsoft-bot-framework-and-c.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/blog/2016/05/creating-a-phone-number-lookup-bot-using-microsoft-bot-framework-and-c.html', 'perform tasks');">perform tasks</a> for the user. We will add to an existing <a href="https://www.twilio.com/docs/api/ip-messaging" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging', 'Programmable Chat');">Programmable Chat</a> chat a simple bot that will return us a GIF whenever we ask for it.</p>
<h2 id="h.a3c7m6xyohe4" class="c1 c3 c10">Getting Your Initial Chat Up And Running</h2>
<p>We will be working off an existing chat application. Before we get started with our bot we need to get a couple of things ready.<br />
First of all, make sure you have:</p>
<ul style="padding-left: 36px;">
<li>Node.js and npm which you can get <a href="https://nodejs.org/en" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://nodejs.org/en', 'here');">here</a></li>
<li>A Twilio Account to set up Programmable Chat &#8211; <a href="https://www.twilio.com/try-twilio" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/try-twilio', 'Sign up for free');">Sign up for free</a></li>
<li><a href="https://ngrok.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://ngrok.com/', 'ngrok');">ngrok</a> &#8211; You can read more about ngrok <a href="https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html', 'here');">here</a></li>
</ul>
<p>The existing chat application that we will base our work off is <a href="https://www.twilio.com/docs/api/ip-messaging/guides/quickstart-js" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging/guides/quickstart-js', 'this quickstart project');">this quickstart project</a>. It only takes 5 minutes to set this project up. Clone the repository by running:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0dbc610482041" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
git clone https://github.com/TwilioDevEd/ipm-quickstart-node.git
cd ipm-quickstart-node</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0dbc610482041-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dbc610482041-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0dbc610482041-1"><span class="crayon-e">git </span><span class="crayon-r">clone</span><span class="crayon-h"> </span><span class="crayon-i">https</span><span class="crayon-o">:</span><span class="crayon-c">//github.com/TwilioDevEd/ipm-quickstart-node.git</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dbc610482041-2"><span class="crayon-r">cd</span><span class="crayon-h"> </span><span class="crayon-i">ipm</span><span class="crayon-o">-</span><span class="crayon-i">quickstart</span><span class="crayon-o">-</span><span class="crayon-i">node</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Configure it according to the <a href="https://github.com/TwilioDevEd/ipm-quickstart-node/blob/master/README.md" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/TwilioDevEd/ipm-quickstart-node/blob/master/README.md', 'README');">README</a>.</p>
<h2 id="h.2u449dmnunxp" class="c1 c3 c10">Intercepting Messages</h2>
<p><a href="https://www.twilio.com/docs/api/ip-messaging" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging', 'Twilio Programmable Chat');">Twilio Programmable Chat</a> will handle the sending of chat messages from client to client. The product also has <a href="https://www.twilio.com/docs/api/ip-messaging/webhooks" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging/webhooks', 'webhook');">webhook</a> notifications for when new messages in our chat are sent. Using these webhooks we can control whether a message should be delivered or blocked. All this can be done simply by returning different HTTP status codes. Status code 200 (<code>OK</code>) means continue delivering this message and 403 (<code>Forbidden</code>) means block this message.<br />
Before we decide whether to block or forward a message we will need to access the data that Twilio sends to our application. To do that we first need to parse it first by adding <code>body-parser</code> to our project using npm:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0dcf227747521" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
npm install body-parser --save</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0dcf227747521-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0dcf227747521-1"><span class="crayon-e">npm </span><span class="crayon-e">install </span><span class="crayon-i">body</span><span class="crayon-o">-</span><span class="crayon-i">parser</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">save</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Once the package is installed add it to <code>index.js</code>:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0dda823896651" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
require('dotenv').load();
var http = require('http');
var path = require('path');
var AccessToken = require('twilio').AccessToken;
var IpMessagingGrant = AccessToken.IpMessagingGrant;
var express = require('express');
var bodyParser = require('body-parser');
var randomUsername = require('./randos');

// Create Express webapp
var app = express();
app.use(express.static(path.join(__dirname, 'public')));

app.use(bodyParser.json({})) 
app.use(bodyParser.urlencoded({
  extended: true
}));</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-2">2</div><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-4">4</div><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-6">6</div><div class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-58794fe4d0dda823896651-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-8">8</div><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-10">10</div><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-12">12</div><div class="crayon-num" data-line="crayon-58794fe4d0dda823896651-13">13</div><div class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-14">14</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0dda823896651-15">15</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0dda823896651-16">16</div><div class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-58794fe4d0dda823896651-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0dda823896651-1"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'dotenv'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'http'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0dda823896651-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'path'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">AccessToken</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'twilio'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-i">AccessToken</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0dda823896651-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">IpMessagingGrant</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AccessToken</span><span class="crayon-sy">.</span><span class="crayon-i">IpMessagingGrant</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">express</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'express'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-58794fe4d0dda823896651-7"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">bodyParser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'body-parser'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-8"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">randomUsername</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./randos'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0dda823896651-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-10"><span class="crayon-c">// Create Express webapp</span></div><div class="crayon-line" id="crayon-58794fe4d0dda823896651-11"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">express</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-12"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">express</span><span class="crayon-sy">.</span><span class="crayon-m">static</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-i">__dirname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'public'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0dda823896651-13">&nbsp;</div><div class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-58794fe4d0dda823896651-14"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0dda823896651-15"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">urlencoded</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0dda823896651-16"> <span class="crayon-h"> </span><span class="crayon-v">extended:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line crayon-marked-line crayon-bottom" id="crayon-58794fe4d0dda823896651-17"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0089 seconds] -->
<p>Add a very basic endpoint to <code>index.js</code> that will print the data received and return the status code 200 to tell Twilio to continue with delivering the message:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0de4855787363" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
app.post('/message', function (req, res, next) {
  console.dir(req.body, { depth: 1 });
  res.sendStatus(200);
});

// Create http server and run it
var server = http.createServer(app);
var port = process.env.PORT || 3000;
server.listen(port, function() {
    console.log('Express server running on *:' + port);
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num crayon-marked-num crayon-top" data-line="crayon-58794fe4d0de4855787363-1">1</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0de4855787363-2">2</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0de4855787363-3">3</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0de4855787363-4">4</div><div class="crayon-num" data-line="crayon-58794fe4d0de4855787363-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0de4855787363-6">6</div><div class="crayon-num" data-line="crayon-58794fe4d0de4855787363-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0de4855787363-8">8</div><div class="crayon-num" data-line="crayon-58794fe4d0de4855787363-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0de4855787363-10">10</div><div class="crayon-num" data-line="crayon-58794fe4d0de4855787363-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line crayon-marked-line crayon-top" id="crayon-58794fe4d0de4855787363-1"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/message'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0de4855787363-2"> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">dir</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-i">body</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">depth:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0de4855787363-3"> <span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">sendStatus</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-58794fe4d0de4855787363-4"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0de4855787363-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0de4855787363-6"><span class="crayon-c">// Create http server and run it</span></div><div class="crayon-line" id="crayon-58794fe4d0de4855787363-7"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">createServer</span><span class="crayon-sy">(</span><span class="crayon-i">app</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0de4855787363-8"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">process</span><span class="crayon-sy">.</span><span class="crayon-v">env</span><span class="crayon-sy">.</span><span class="crayon-i">PORT</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0de4855787363-9"><span class="crayon-v">server</span><span class="crayon-sy">.</span><span class="crayon-e">listen</span><span class="crayon-sy">(</span><span class="crayon-i">port</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0de4855787363-10"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Express server running on *:'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">port</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0de4855787363-11"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0066 seconds] -->
<p>Restart the server by running:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0def390229279" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
node .</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0def390229279-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0def390229279-1"><span class="crayon-v">node</span><span class="crayon-h"> </span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We need to expose our application to the public so Twilio can deliver the webhook. For this execute in a different terminal:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0df9124118276" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
ngrok http 3000</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0df9124118276-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0df9124118276-1"><span class="crayon-e">ngrok </span><span class="crayon-i">http</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p><img class="&quot; aligncenter" style="width: 624.00px; height: 294.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/HWDleH9ulWrWm5W4yqA7pi5XMqzUYVYF5zlYHbDbzByBi9iJoMc-ropkzFmm5ZY336yHks2nDIzGwtr96zGVwEubVlYqoTYf9NSOePAmNswkgCPpZj4VbgNKmSVNsorxIDD2F0ig.png" alt="screenshot-ngrok.png" /><br />
Afterwards go to your messaging service in the console and configure the webhook URL as: <code>http://&lt;your_ngrok_url&gt;.ngrok.io/message</code>.<br />
Make sure that the HTTP method is <code>POST</code> and that <code>OnMessageSend</code> is activated.<br />
<img class="&quot; aligncenter" style="width: 624.00px; height: 352.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/RwUKCGD8VHe_gGv5Fhn5zs9xqxlh95-9_jGTLh6QHqJg1PdlrgZvAQFoSXbMdtFxcVWNYprS-hezkiZX7vBfwiIdtC9ZH_mbATMIbp1j6Q7Pt3If9F8MdY3tTSu0-tUXDNH0kCCQ.png" alt="ipm-screenshot-webhook.png" /><br />
Navigate to <a href="http://localhost:3000/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://localhost:3000/', 'http://localhost:3000/');">http://localhost:3000</a> and start writing messages. You should see them start appearing on in your terminal with additional information for the message.<br />
<img class="&quot; aligncenter" style="width: 624.00px; height: 270.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/B7L4cS7JyKkRgeQChiRNv9ahytEJ2OgFPJhbx5NNS-Too8tz_9o2OlG_OG2WLJRNsW0V6ux0bfMNumiG8xS84gGBvBXsBdaefbogJLlHnSifQV738VK-MBZS44ygXd5L5jkNlUhg.png" alt="logging-messages.gif" /></p>
<h2 id="h.tm5iaiv749fz" class="c1 c3 c10">Controlling The Conversation</h2>
<p>Now that you are receiving all the necessary information, we can dive deeper into the <a href="https://www.twilio.com/docs/api/ip-messaging/webhooks#pre-processing" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging/webhooks#pre-processing', 'control');">control</a> that these webhooks provide. If we return the status code 403 instead of 200 we can block the respective message. Let’s alter the route to intercept and not deliver messages that start with <code>/gif</code>:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0e04911735814" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
app.post('/message', function (req, res, next) {
  if (req.body.Body.toLowerCase().indexOf('/gif') === 0) {
    res.sendStatus(403);
  } else {
    res.sendStatus(200);
  }
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0e04911735814-1">1</div><div class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-58794fe4d0e04911735814-2">2</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e04911735814-3">3</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e04911735814-4">4</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e04911735814-5">5</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0e04911735814-6">6</div><div class="crayon-num" data-line="crayon-58794fe4d0e04911735814-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0e04911735814-1"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/message'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-58794fe4d0e04911735814-2">  <span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-s">'/gif'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e04911735814-3"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">sendStatus</span><span class="crayon-sy">(</span><span class="crayon-cn">403</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e04911735814-4"> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e04911735814-5"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">sendStatus</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-58794fe4d0e04911735814-6"> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-58794fe4d0e04911735814-7"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>Restart your server and send a message with <code>/gif</code>. You should see that it’s not showing up. All other messages will normally appear.<br />
<img class="&quot; aligncenter" style="width: 624.00px; height: 382.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/mELd-O_zoRF1GCXZxIWDZyo3ixRY-7-pAyPBfoaOZhNS00Q3QcD77KQRinL2el-C67t88LWz4y1C2HczZDoEwKPikAJ59GaWmopenJ1Yv7QL1i6DDoOuaVSlBYLpShTU3rnCzg2f.png" alt="blocked-gif-message.gif" /></p>
<h2 id="h.dhi13sk7g6nk" class="c1 c3 c10">Let The Bots Join!</h2>
<p>So far we can intercept the content that is being sent but we want to actually send our own messages. We want our bot to actually participate in the chat. For this we will forward the message at all times and then use the information about the channel to place the bot in the channel and write a message to it using the <a href="https://www.twilio.com/docs/libraries/node" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/libraries/node', 'Twilio helper library');">Twilio helper library</a>.<br />
Modify the <code>index.js</code> file accordingly:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0e0f949405874" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
require('dotenv').load();
var http = require('http');
var path = require('path');
var Twilio = require('twilio');
var AccessToken = Twilio.AccessToken;
var IpMessagingGrant = AccessToken.IpMessagingGrant;
var express = require('express');
var bodyParser = require('body-parser');
var randomUsername = require('./randos');

var client = new Twilio.IpMessagingClient();
var service = client.services(process.env.TWILIO_IPM_SERVICE_SID);
var botName = 'gifinator';

// Create Express webapp
var app = express();
app.use(express.static(path.join(__dirname, 'public')));

app.use(bodyParser.json({})) 
app.use(bodyParser.urlencoded({
  extended: true
}));

app.get('/token', function(request, response) {
// ----------------------
// Hidden for conciseness
// ----------------------
});

app.post('/message', function (req, res, next) {
    res.sendStatus(200);

    if (req.body.Body.toLowerCase().indexOf('/gif') === 0) {
        var channel = service.channels(req.body.ChannelSid);
        channel.members.create({
            identity: botName
        }).then(function (response) {
            return channel.messages.create({
                from: botName,
                body: 'http://i.giphy.com/h8E7oT2FGEJkQ.gif'
            });
        }).then(function (response) {
            console.log('Bot message sent!');
        }).catch(function (err) {
            console.error('Failed to send message');
            console.error(err);
        });
    }
});

// Create http server and run it
var server = http.createServer(app);
var port = process.env.PORT || 3000;
server.listen(port, function() {
    console.log('Express server running on *:' + port);
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-2">2</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-3">3</div><div class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-4">4</div><div class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-58794fe4d0e0f949405874-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-6">6</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-8">8</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-10">10</div><div class="crayon-num crayon-marked-num crayon-top" data-line="crayon-58794fe4d0e0f949405874-11">11</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-12">12</div><div class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-58794fe4d0e0f949405874-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-14">14</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-16">16</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-18">18</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-20">20</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-22">22</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-24">24</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-26">26</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-28">28</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-30">30</div><div class="crayon-num crayon-marked-num crayon-top" data-line="crayon-58794fe4d0e0f949405874-31">31</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-32">32</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-33">33</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-34">34</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-35">35</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-36">36</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-37">37</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-38">38</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-39">39</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-40">40</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-41">41</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-42">42</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-43">43</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-44">44</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-45">45</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-46">46</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e0f949405874-47">47</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-48">48</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-50">50</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-52">52</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-54">54</div><div class="crayon-num" data-line="crayon-58794fe4d0e0f949405874-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e0f949405874-56">56</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-1"><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'dotenv'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'http'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'path'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-58794fe4d0e0f949405874-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">Twilio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'twilio'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom" id="crayon-58794fe4d0e0f949405874-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">AccessToken</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Twilio</span><span class="crayon-sy">.</span><span class="crayon-i">AccessToken</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">IpMessagingGrant</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AccessToken</span><span class="crayon-sy">.</span><span class="crayon-i">IpMessagingGrant</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-7"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">express</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'express'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-8"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">bodyParser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'body-parser'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-9"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">randomUsername</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./randos'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-10">&nbsp;</div><div class="crayon-line crayon-marked-line crayon-top" id="crayon-58794fe4d0e0f949405874-11"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Twilio</span><span class="crayon-sy">.</span><span class="crayon-e">IpMessagingClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-12"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">service</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">services</span><span class="crayon-sy">(</span><span class="crayon-v">process</span><span class="crayon-sy">.</span><span class="crayon-v">env</span><span class="crayon-sy">.</span><span class="crayon-i">TWILIO_IPM_SERVICE_SID</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom" id="crayon-58794fe4d0e0f949405874-13"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-e ">botName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'gifinator'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-14">&nbsp;</div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-15"><span class="crayon-c">// Create Express webapp</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-16"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">express</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-17"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">express</span><span class="crayon-sy">.</span><span class="crayon-m">static</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-i">__dirname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'public'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-18">&nbsp;</div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-19"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-20"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">urlencoded</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-21"> <span class="crayon-h"> </span><span class="crayon-v">extended:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-22"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-24"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/token'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-i">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-25"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-26"><span class="crayon-c">// Hidden for conciseness</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-27"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-28"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-30"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/message'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-top" id="crayon-58794fe4d0e0f949405874-31"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">sendStatus</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-32">&nbsp;</div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-33">  <span class="crayon-h"> </span> <span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-s">'/gif'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-34"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">channel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">service</span><span class="crayon-sy">.</span><span class="crayon-e">channels</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-i">ChannelSid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-35"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">channel</span><span class="crayon-sy">.</span><span class="crayon-v">members</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-36"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">identity:</span><span class="crayon-h"> </span><span class="crayon-i">botName</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-37"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-38"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">channel</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-39"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">from:</span><span class="crayon-h"> </span><span class="crayon-i">botName</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-40"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">body:</span><span class="crayon-h"> </span><span class="crayon-s">'http://i.giphy.com/h8E7oT2FGEJkQ.gif'</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-41"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-42"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-43"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Bot message sent!'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-44"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">catch</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">err</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-45"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">error</span><span class="crayon-sy">(</span><span class="crayon-s">'Failed to send message'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-46"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">error</span><span class="crayon-sy">(</span><span class="crayon-i">err</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e0f949405874-47"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-58794fe4d0e0f949405874-48"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-49"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-50">&nbsp;</div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-51"><span class="crayon-c">// Create http server and run it</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-52"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">createServer</span><span class="crayon-sy">(</span><span class="crayon-i">app</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-53"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">process</span><span class="crayon-sy">.</span><span class="crayon-v">env</span><span class="crayon-sy">.</span><span class="crayon-i">PORT</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-54"><span class="crayon-v">server</span><span class="crayon-sy">.</span><span class="crayon-e">listen</span><span class="crayon-sy">(</span><span class="crayon-i">port</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-58794fe4d0e0f949405874-55"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Express server running on *:'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">port</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e0f949405874-56"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0302 seconds] -->
<p>Once you restarted the server try writing <code>/gif</code> in the chat again. Now you should see the bot write the actual message and your message staying preserved.<br />
<img class="&quot; aligncenter" style="width: 624.00px; height: 385.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/XOY6C6quaBUi8FvTA78R6BqWgU9mPkYPvx3YBTXPygYAAB3OBeMRDndjIAddOtMZ-_RhK5152hcP6KdFut-EuokN5xTmQoOYhaRapzYtXSpK45BiqaKXVuFkVyy4VaVlNvzLnEHQ.png" alt="returned-gif-link.gif" /></p>
<h2 id="h.i2v093t0j8c9" class="c1 c3 c10">Upgrade Your Bot</h2>
<p>So far we are only sending text with our bot. We can use the new <a href="https://www.twilio.com/docs/api/ip-messaging/rest/messages#action-create" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/docs/api/ip-messaging/rest/messages#action-create', 'message attributes');">message attributes</a> to add additional contextual information to our message, such as information that this is actually a picture.<br />
For this send an object as attributes that specifies the type as <code>'image'</code> when creating the message:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0e1b233993545" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
app.post('/message', function (req, res, next) {
// ----------------------
// Hidden for conciseness
// ----------------------
            return channel.messages.create({
                from: botName,
                body: 'http://i.giphy.com/h8E7oT2FGEJkQ.gif',
                attributes: JSON.stringify({
                    type: 'image'
                })
            })
// ----------------------
// Hidden for conciseness
// ----------------------
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-2">2</div><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-4">4</div><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-6">6</div><div class="crayon-num crayon-marked-num crayon-top" data-line="crayon-58794fe4d0e1b233993545-7">7</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-8">8</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e1b233993545-9">9</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-10">10</div><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-12">12</div><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e1b233993545-14">14</div><div class="crayon-num" data-line="crayon-58794fe4d0e1b233993545-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-1"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/message'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-2"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-3"><span class="crayon-c">// Hidden for conciseness</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-4"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-5"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">channel</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-6"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">from:</span><span class="crayon-h"> </span><span class="crayon-i">botName</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-marked-line crayon-top" id="crayon-58794fe4d0e1b233993545-7">  <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">body:</span><span class="crayon-h"> </span><span class="crayon-s">'http://i.giphy.com/h8E7oT2FGEJkQ.gif'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-8"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">attributes:</span><span class="crayon-h"> </span><span class="crayon-v">JSON</span><span class="crayon-sy">.</span><span class="crayon-e">stringify</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e1b233993545-9"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">type:</span><span class="crayon-h"> </span><span class="crayon-s">'image'</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-58794fe4d0e1b233993545-10"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-11"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-12"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-13"><span class="crayon-c">// Hidden for conciseness</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e1b233993545-14"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e1b233993545-15"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0074 seconds] -->
<p>Now that we are sending this information we need to update our front-end to display the image. Open <code>public/index.js</code> and update the <code>printMessage</code> method as well as the event listener for <code>messageAdded</code> to wrap an image-tag around the content:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-58794fe4d0e26353044876" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover expand" style=" margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 16px !important; line-height: 24px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:2; -o-tab-size:2; -webkit-tab-size:2; tab-size:2; font-size: 16px !important; line-height: 24px !important;">
// ----------------------
// Hidden for conciseness
// ----------------------

    // Helper function to print chat message to the chat window
    function printMessage(fromUser, message, type) {
        var $user = $('&lt;span class="username"&gt;').text(fromUser + ':');
        if (fromUser === username) {
            $user.addClass('me');
        }
        // replace original $message declaration with the following lines
        var $message = $('&lt;span class="message"&gt;');
        if (type === 'image') {
            $message.html('&lt;img width="500" src="' + message + '"/&gt;');
        } else {
            $message = $message.text(message);
        }
        var $container = $('&lt;div class="message-container"&gt;');
        $container.append($user).append($message);
        $chatWindow.append($container);
        $chatWindow.scrollTop($chatWindow[0].scrollHeight);
    }

// ----------------------
// Hidden for conciseness
// ----------------------
    
    // Set up channel after it has been found
    function setupChannel() {
        // Join the general channel
        generalChannel.join().then(function(channel) {
            print('Joined channel as ' +
                  '&lt;span class="me"&gt;' + username + '&lt;/span&gt;.', true);
        });

        // Listen for new messages sent to the channel
        generalChannel.on('messageAdded', function(message) {
            var type;
            if (message.attributes) {
                type = message.attributes.type;
            }
            printMessage(message.author, message.body, type);
        });
    }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-2">2</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-4">4</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-5">5</div><div class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-6">6</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-8">8</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-10">10</div><div class="crayon-num crayon-marked-num crayon-top" data-line="crayon-58794fe4d0e26353044876-11">11</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-12">12</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e26353044876-13">13</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-14">14</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e26353044876-15">15</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-16">16</div><div class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-58794fe4d0e26353044876-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-18">18</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-20">20</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-22">22</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-24">24</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-26">26</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-28">28</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-30">30</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-32">32</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-34">34</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-36">36</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-37">37</div><div class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-38">38</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e26353044876-39">39</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-40">40</div><div class="crayon-num crayon-marked-num" data-line="crayon-58794fe4d0e26353044876-41">41</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-42">42</div><div class="crayon-num" data-line="crayon-58794fe4d0e26353044876-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-58794fe4d0e26353044876-44">44</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 24px !important;"><div class="crayon-line" id="crayon-58794fe4d0e26353044876-1"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-2"><span class="crayon-c">// Hidden for conciseness</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-3"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-4">&nbsp;</div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-5"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-c">// Helper function to print chat message to the chat window</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-58794fe4d0e26353044876-6"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">printMessage</span><span class="crayon-sy">(</span><span class="crayon-i">fromUser</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">message</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">type</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-7"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;span class="username"&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">text</span><span class="crayon-sy">(</span><span class="crayon-i">fromUser</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">':'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-8"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">fromUser</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-i">username</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-9"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-e">addClass</span><span class="crayon-sy">(</span><span class="crayon-s">'me'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-10"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-marked-line crayon-top" id="crayon-58794fe4d0e26353044876-11"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-c">// replace original $message declaration with the following lines</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-12"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;span class="message"&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e26353044876-13"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-s">'image'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-14"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-e">html</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img width="500" src="'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">message</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'"/&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e26353044876-15"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-16"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-e">text</span><span class="crayon-sy">(</span><span class="crayon-i">message</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom" id="crayon-58794fe4d0e26353044876-17"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-18"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">container</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div class="message-container"&gt;'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-19"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">user</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">message</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-20"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">chatWindow</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-i">container</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-21"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">chatWindow</span><span class="crayon-sy">.</span><span class="crayon-e">scrollTop</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">chatWindow</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-i">scrollHeight</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-22"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-24"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-25"><span class="crayon-c">// Hidden for conciseness</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-26"><span class="crayon-c">// ----------------------</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-27"> <span class="crayon-h"> </span> <span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-28"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-c">// Set up channel after it has been found</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-29"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">setupChannel</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-30"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-c">// Join the general channel</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-31"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">generalChannel</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-i">channel</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-32"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-r">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Joined channel as '</span><span class="crayon-h"> </span><span class="crayon-o">+</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-33"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-s">'&lt;span class="me"&gt;'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">username</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;/span&gt;.'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-34"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-36"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-c">// Listen for new messages sent to the channel</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-37"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">generalChannel</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">'messageAdded'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-i">message</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-58794fe4d0e26353044876-38"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-i">type</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e26353044876-39"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-i">attributes</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-40"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-v">attributes</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-58794fe4d0e26353044876-41"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-58794fe4d0e26353044876-42"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-e">printMessage</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-i">author</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-i">body</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">type</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-58794fe4d0e26353044876-43"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-58794fe4d0e26353044876-44"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0253 seconds] -->
<p>Now restart the server and reload your browser and you should be able to see the GIF properly appear the next time you write <code>/gif</code>!</p>
<p><img class="&quot; aligncenter" style="width: 624.00px; height: 484.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/HTybh5Fq9oO-a7aFZpU-6690HDQFTts2Db3UhFAWFlncgfl-RFFIBmtzglc3qChiW8xShUjpE7WxSZEImASPQaBjFglC5iiCzZBGdNvwJRcQ6tIqdRBT-a-9Jjge0Whw4fs40ByG.png" alt="with-actual-gif.gif" /></p>
<h2 id="h.e713exwsddxg" class="c1 c10">Rise Of The Bots<img class="&quot; alignright" style="width: 287.00px; height: 400.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="" src="https://www.twilio.com/blog/wp-content/uploads/2016/08/nwZp8jaQKlIK1LQbaQjoP-UHXu7FjFngHr0weeiqE6agBjzKB5Cp2U1KNSpHq6vOOqdecnnv9GRMtZb1nn_Kdvqi4d6K-DokDZOhWqL_i9IPwXShvao8nCC4Yzsq2bAiZaAji8Rz.png" alt="mIZ9rPeMKefm0.gif" /></h2>
<p>Amazing! You just finished your first bot!<br />
But you don’t have to stop here. You could extend the bot to return a random GIF using the <a href="https://api.giphy.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://api.giphy.com/', 'Giphy API');">Giphy API</a> or come up with your very own bots. How about a bot that recommends a restaurant whenever you talk with your colleagues about lunch? Now that you have the tools you are only limited by your imagination!<br />
Let me know what you came up with by sending me a message or tell me in person at <a href="https://www.twilio.com/signal/london" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.twilio.com/signal/london', 'SIGNAL London');">SIGNAL London</a>. You can use DKUNDEL20 to get 20% off.</p>
<p>We can’t wait to see what you build!</p>
<ul style="padding-left: 36px;">
<li>Email: <a class="c7" href="mailto:dkundel@twilio.com">dkundel@twilio.com</a></li>
<li>Twitter: <a href="https://twitter.com/dkundel" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://twitter.com/dkundel', '@dkundel');">@dkundel</a></li>
<li>GitHub: <a href="https://github.com/dkundel" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/dkundel', 'dkundel');">dkundel</a></li>
<li>Twitch (streaming live code): <a href="https://twitch.tv/dkundel" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://twitch.tv/dkundel', 'dkundel');">dkundel</a></li>
</ul>
			</div>
					</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer col-md-12">
		<div class="entry-meta">
					<div class="social-buttons">
			<div class="fb-like" data-href="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" data-layout="button" data-action="like" data-show-faces="false" data-share="false"></div>
			<a href="https://twitter.com/share" class="twitter-share-button" data-via="twilio" data-count="none" data-url="https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html" data-text="Writing a bot for Programmable Chat in Node.js ">Tweet</a>
      <a href="https://twitter.com/twilio" class="twitter-follow-button" data-show-count="false">Follow @twilio</a>
		</div>
<span class="author-avatar"><img alt='' src='https://secure.gravatar.com/avatar/8492cae550ace194748f18e81d1f488d?s=20&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/8492cae550ace194748f18e81d1f488d?s=40&amp;d=mm&amp;r=g 2x' class='avatar avatar-20 photo' height='20' width='20' /></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://www.twilio.com/blog/author/dominik">Dominik Kundel</a></span></span> <span class="author-meta author-email"><a href="mailto:dkundel@twilio.com">dkundel@twilio.com</a></span>		</div>
	</footer><!-- .entry-footer -->

   <div class="build-more"><h3>Use Twilio Tutorials to Start Building</h3>         <a href="https://www.twilio.com/docs/tutorials/walkthrough/call-tracking/php/laravel" onclick="__gaTracker('send', 'event', 'startbuilding-widget', 'https://www.twilio.com/docs/tutorials/walkthrough/call-tracking/php/laravel', '');">
          <h5>Call Tracking</h5>
        </a>
         <a href="https://www.twilio.com/docs/tutorials/walkthrough/server-notifications/php/laravel" onclick="__gaTracker('send', 'event', 'startbuilding-widget', 'https://www.twilio.com/docs/tutorials/walkthrough/server-notifications/php/laravel', '');">
          <h5>SMS and MMS Notifications</h5>
        </a>
         <a href="https://www.twilio.com/docs/tutorials/walkthrough/two-factor-authentication/php/laravel" onclick="__gaTracker('send', 'event', 'startbuilding-widget', 'https://www.twilio.com/docs/tutorials/walkthrough/two-factor-authentication/php/laravel', '');">
          <h5>Two-Factor Authentication with Authy</h5>
        </a>
      
</article><!-- #post-## -->

			
<div id="disqus_thread">
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html';
    var disqus_identifier = 'https://www.twilio.com/blog/2016/08/18663 https://www.twilio.com/blog/?p=18663';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'twilioblog';
    var disqus_title = "https://www.twilio.com/blog/2016/08/Writing a bot for Programmable Chat in Node.js";
        var disqus_config = function () {
        var config = this; // Access to the config object
        config.language = '';

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html?cf_action=sync_comments&amp;post_id=18663';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "https:\/\/www.twilio.com\/blog\/2016\/08\/writing-a-bot-for-ip-messaging-in-node-js.html\/trackback"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.74';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area col-md-3 hide-xs" role="complementary">
	<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://www.twilio.com/blog/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside><aside id="text-2" class="widget widget_text">			<div class="textwidget"><p>Power modern communications. Build the next generation of voice and SMS applications.</p>

 <a href="http://twilio.com/try-twilio" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://twilio.com/try-twilio', 'Start Building For Free');" class="btn">Start Building For Free</a></div>
		</aside><style scoped type="text/css">.utcw-8ngloje {word-wrap:break-word}.utcw-8ngloje span,.utcw-8ngloje a{border-style:solid;border-width:1px}.utcw-8ngloje span:hover,.utcw-8ngloje a:hover{border-style:solid;border-width:1px}</style><aside id="utcw-2" class="widget widget_utcw widget_tag_cloud"><h1 class="widget-title">Posts By Stack</h1><div class="utcw-8ngloje tagcloud"><a class="tag-link-22 utcw-tag utcw-tag-net" href="https://www.twilio.com/blog/tag/net" style="font-size:16px" title="40 topics">.NET</a> <a class="tag-link-98 utcw-tag utcw-tag-arduino" href="https://www.twilio.com/blog/tag/arduino" style="font-size:16px" title="21 topics">Arduino</a> <a class="tag-link-598 utcw-tag utcw-tag-java" href="https://www.twilio.com/blog/tag/java" style="font-size:16px" title="14 topics">Java</a> <a class="tag-link-600 utcw-tag utcw-tag-javascript" href="https://www.twilio.com/blog/tag/javascript" style="font-size:16px" title="86 topics">JavaScript</a> <a class="tag-link-847 utcw-tag utcw-tag-php" href="https://www.twilio.com/blog/tag/php" style="font-size:16px" title="57 topics">PHP</a> <a class="tag-link-891 utcw-tag utcw-tag-python" href="https://www.twilio.com/blog/tag/python" style="font-size:16px" title="72 topics">Python</a> <a class="tag-link-969 utcw-tag utcw-tag-ruby" href="https://www.twilio.com/blog/tag/ruby" style="font-size:16px" title="69 topics">Ruby</a> <a class="tag-link-2856 utcw-tag utcw-tag-swift" href="https://www.twilio.com/blog/tag/swift" style="font-size:16px" title="22 topics">Swift</a></div></aside><style scoped type="text/css">.utcw-5dkhj5o {word-wrap:break-word}.utcw-5dkhj5o span,.utcw-5dkhj5o a{border-style:solid;border-width:1px}.utcw-5dkhj5o span:hover,.utcw-5dkhj5o a:hover{border-style:solid;border-width:1px}</style><aside id="utcw-3" class="widget widget_utcw widget_tag_cloud"><h1 class="widget-title">Posts By Product</h1><div class="utcw-5dkhj5o tagcloud"><a class="tag-link-2043 utcw-tag utcw-tag-mms" href="https://www.twilio.com/blog/tag/mms" style="font-size:16px" title="50 topics">MMS</a> <a class="tag-link-3513 utcw-tag utcw-tag-programmable-chat" href="https://www.twilio.com/blog/tag/programmable-chat" style="font-size:16px" title="9 topics">Programmable Chat</a> <a class="tag-link-1537 utcw-tag utcw-tag-sip" href="https://www.twilio.com/blog/tag/sip" style="font-size:16px" title="15 topics">SIP</a> <a class="tag-link-1031 utcw-tag utcw-tag-sms" href="https://www.twilio.com/blog/tag/sms" style="font-size:16px" title="372 topics">SMS</a> <a class="tag-link-2871 utcw-tag utcw-tag-taskrouter" href="https://www.twilio.com/blog/tag/taskrouter" style="font-size:16px" title="8 topics">Task Router</a> <a class="tag-link-1199 utcw-tag utcw-tag-twilio-client" href="https://www.twilio.com/blog/tag/twilio-client" style="font-size:16px" title="32 topics">Twilio Client</a> <a class="tag-link-3032 utcw-tag utcw-tag-twilio-video" href="https://www.twilio.com/blog/tag/twilio-video" style="font-size:16px" title="9 topics">Twilio Video</a> <a class="tag-link-1277 utcw-tag utcw-tag-voice" href="https://www.twilio.com/blog/tag/voice" style="font-size:16px" title="172 topics">Voice</a></div></aside><aside id="text-5" class="widget widget_text">			<div class="textwidget"><a href="http://www.twilio.com/docs/tutorials" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.twilio.com/docs/tutorials', '');"><img src="https://www.twilio.com/blog/wp-content/uploads/2016/07/tutorials.png" style="width: 255px" /></a></div>
		</aside><aside id="categories-3" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-13"><a href="https://www.twilio.com/blog/all-things-code" >Code, Tutorials and Hacks</a>
</li>
	<li class="cat-item cat-item-5"><a href="https://www.twilio.com/blog/customer-highlights" >Customer Highlights</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://www.twilio.com/blog/developers-drawing-the-owl" >Developers Drawing The Owl</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://www.twilio.com/blog/news" >News</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://www.twilio.com/blog/stories-from-the-road" >Stories From The Road</a>
</li>
	<li class="cat-item cat-item-8"><a href="https://www.twilio.com/blog/inside-twilio" >The Owl’s Nest: Inside Twilio</a>
</li>
		</ul>
</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><div class="tagcloud "><a href="http://www.twilio.com/blog/feed" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.twilio.com/blog/feed', 'RSS Feed');">RSS Feed</a></div></div>
		</aside></div><!-- #secondary -->

		</div><!-- .row -->
	</div><!-- #content.container -->

<div class="" id="footer">
	<div class="container">
		<header>
			<div class="banner"></div>
			<div class="border"></div>
			<div class="stitching"></div>
		</header>
    <div class="row sitemap">
      <div class="row">
        <div class="col-md-2 col-md-offset-1">
          <h4><a href="http://www.twilio.com/company">Company</a></h4>
          <ul>
            <li><a href="http://www.twilio.com/company">About Twilio</a></li>
            <li><a href="http://www.twilio.com/company/nine-values">Our Nine Values</a></li>
            <li><a href="http://www.twilio.com/company/leadership-principles">Our Leadership Principles</a></li>
            <li><a href="http://www.twilio.com/company/management">The Team</a></li>
            <li><a href="http://www.twilio.com/press">Press &amp; Media</a></li>
            <li><a href="http://www.twilio.org/">Twilio.org</a></li>
            <li><a href="http://www.twilio.com/company/jobs">Careers</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4><a href="http://www.twilio.com/products">Products</a></h4>
          <ul>
            <li><a href="http://www.twilio.com/voice">Voice</a></li>
            <li><a href="http://www.twilio.com/video">Video</a></li>
            <li><a href="http://www.twilio.com/sms">SMS (Text Messaging)</a></li>
            <li><a href="http://www.twilio.com/mms">MMS (Picture Messaging)</a></li>
            <li><a href="http://www.twilio.com/sms/toll-free">Toll-Free SMS</a></li>
            <li><a href="http://www.twilio.com/sip-trunking">SIP Trunking</a></li>
            <li><a href="http://www.twilio.com/client/mobile">Client Mobile</a></li>
            <li><a href="http://www.twilio.com/webrtc">Client WebRTC</a></li>
            <li><a href="http://www.twilio.com/stun-turn">Network Traversal Service</a></li>
            <li><a href="http://www.twilio.com/taskrouter">TaskRouter</a></li>
            <li><a href="http://www.twilio.com/sms/phone-numbers">Phone Numbers</a></li>
            <li><a href="http://www.twilio.com/sms/shortcodes">Short Codes</a></li>
            <li><a href="http://www.twilio.com/support-plans">Support Plans</a></li>
            <li><a href="http://www.twilio.com/platform">Platform</a></li>
            <li><a href="http://www.twilio.com/lookup">Lookup</a></li>
            <li><a href="http://www.twilio.com/monitor">Monitor</a></li>
            <li><a href="http://www.twilio.com/copilot">Messaging Copilot</a></li>
            <li><a href="http://www.twilio.com/voice/conference">Global Conference</a></li>
            <li><a href="http://www.twilio.com/authy">Authy</a></li>
          </ul>
      </div>
      <div class="col-md-2">
        <h4><a href="http://www.twilio.com/pricing">Pricing</a></h4>
        <ul>
          <li><a href="http://www.twilio.com/voice/pricing">Voice Pricing</a></li>
          <li><a href="http://www.twilio.com/sms/pricing">Messaging Pricing</a></li>
          <li><a href="http://www.twilio.com/sip-trunking/pricing">SIP Trunking Pricing</a></li>
          <li><a href="http://www.twilio.com/client/pricing">Client Pricing</a></li>
          <li><a href="http://www.twilio.com/stun-turn/pricing">Network Traversal Pricing</a></li>
          <li><a href="http://www.twilio.com/taskrouter/pricing">TaskRouter</a></li>
          <li><a href="http://www.twilio.com/lookup#pricing">Lookup</a></li>
          <li><a href="http://www.twilio.com/international">International Coverage</a></li>
        </ul>
      </div>
      <div class="col-md-2">
          <h4><a href="http://www.twilio.com/use-cases">Use Cases</a></h4>
          <ul>
            <li><a href="http://www.twilio.com/customers">Customer Stories</a></li>
            <li><a href="http://www.twilio.com/showcase">Showcase</a></li>
            <li><a href="http://www.twilio.com/use-cases/two-factor-authentication">Two-Factor Authentication</a></li>
            <li><a href="http://www.twilio.com/use-cases/appointment-reminders">Appointment Reminders</a></li>
            <li><a href="http://www.twilio.com/use-cases/dispatch-notifications">Dispatch Notifications</a></li>
            <li><a href="http://www.twilio.com/use-cases/eta-alerts">ETA Alerts</a></li>
            <li><a href="http://www.twilio.com/use-cases/automated-surveys">Automated Surveys</a></li>
            <li><a href="http://www.twilio.com/use-cases/masked-phone-numbers">Masked Phone Numbers</a></li>
            <li><a href="http://www.twilio.com/use-cases/visual-estimates">Visual Estimates</a></li>
            <li><a href="http://www.twilio.com/doers">Developer Network</a></li>
            <li><a href="http://www.twilio.com/webinars">Webinars</a></li>
            <li><a href="http://www.twilio.com/white-papers">White Papers</a></li>
          </ul>
      </div>
      <div class="col-md-2">
          <h4><a href="http://www.twilio.com/api">Api &amp; Docs</a></h4>
          <ul>
            <li><a href="http://www.twilio.com/docs/api">API Documentation</a></li>
            <li><a href="http://www.twilio.com/docs/quickstart">Quickstarts</a></li>
            <li><a href="http://www.twilio.com/docs/howto">How Tos</a></li>
            <li><a href="http://www.twilio.com/docs/libraries">Helper Libraries</a></li>
            <li><a href="http://www.twilio.com/docs/security">Security</a></li>
          </ul>
      </div>
    </div>
		<div class="row clear">
			<footer><span>&copy; 2017 Twilio. All rights reserved. <aside>|</aside><a href="http://www.twilio.com/legal/tos">Terms of Service</a><aside>|</aside><a href="http://www.twilio.com/legal/privacy">Privacy Policy</a></span>
			</footer>
		</div>
	</div>
</div>


</div><!-- #page -->

<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201702'></script>







<script type="text/javascript" defer src="https://www.twilio.com/blog/wp-content/cache/autoptimize/js/autoptimize_30cf8936a215677503cd64ef48677239.js"></script></body>

<!-- Mirrored from www.twilio.com/blog/2016/08/writing-a-bot-for-ip-messaging-in-node-js.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:10:05 GMT -->
</html>
