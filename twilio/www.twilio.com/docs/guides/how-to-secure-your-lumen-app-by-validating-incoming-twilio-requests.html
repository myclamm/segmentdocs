


<!DOCTYPE html>
<html class="no-js">
  
<!-- Mirrored from www.twilio.com/docs/guides/how-to-secure-your-lumen-app-by-validating-incoming-twilio-requests by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:10:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
	<!-- Optimizely -->
	<script src="https://cdn.optimizely.com/js/6082066.js"></script>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">
    
    
    <meta name="description" content="Secure the routes in your Lumen application which accept incoming requests from Twilio. Use the Twilio PHP SDK&#39;s request validator utility to confirm incoming requests to your views genuinely originated from Twilio.">
    
    
    

    <title>
      How to secure your Lumen app by validating incoming Twilio requests - Twilio
    </title>

    <link rel="canonical" href="https://www.twilio.com/docs/guides/how-to-secure-your-lumen-app-by-validating-incoming-twilio-requests" />

    
    <link rel="shortcut icon" href="https://www.twilio.com/docs/static/img/favicons/favicon.db41f19ea294.ico"/>
    <link rel="apple-touch-icon" href="https://www.twilio.com/docs/static/img/favicons/favicon_57.98200b6899e6.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="https://www.twilio.com/docs/static/img/favicons/favicon_72.86ae17486256.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="https://www.twilio.com/docs/static/img/favicons/favicon_114.ee1859950ad4.png"/>

    
    <link rel="stylesheet" type="text/css" href="http://cloud.typography.com/6230892/752864/css/fonts.css">
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/font-awesome.min.295235b28b6e.css" />
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/twilio-icons.45de73e993f2.css" />
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/font-mfizz.818f36cb00cc.css" />

    
    
    <meta property="og:title" content="How to secure your Lumen app by validating incoming Twilio requests">
    
    
    <meta property="og:description" content="Secure the routes in your Lumen application which accept incoming requests from Twilio. Use the Twilio PHP SDK&#39;s request validator utility to confirm incoming requests to your views genuinely originated from Twilio.">
    
    
    <meta property="og:url" content="https://www.twilio.com/docs/guides/how-to-secure-your-lumen-app-by-validating-incoming-twilio-requests?utm_source=docs&utm_medium=social&utm_campaign=guides_tags">

    
    
    <meta name="twitter:title" content="How to secure your Lumen app by validating incoming Twilio requests">
    
    
    <meta name="twitter:description" content="Secure the routes in your Lumen application which accept incoming requests from Twilio. Use the Twilio PHP SDK&#39;s request validator utility to confirm incoming requests to your views genuinely originated from Twilio.">
    
    

    
    

    

    
      <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/docs.min.05ed18599e08.css" />
    

    
    

    
    <script>
  var twilio = twilio || {};
  twilio.realm = "prod";
  twilio.SWIFTYPE_ENGINE_KEY = "T68bXEBf7NaKzyRpvbnG";
</script>


<script>
  twilio.account = twilio.account || {};
  

  twilio.user = twilio.user || {};
  
  

</script>


    <script>
  
  window.userBetaFeatures = ["enable-video-rooms", "marketplace"];
</script>

  </head>

  <body class="
    
      guides
    
    
    
  ">

    

	
	<!-- Google Tag Manager -->
	<noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-MWRD6S"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window, document, 'script', 'dataLayer', 'GTM-MWRD6S');</script>
	<!-- End Google Tag Manager -->
	



    
    <div role="drawer" class="nav__drawer">
  <div role="drawer__wrapper" class="nav__drawer-wrapper">
    <div role="drawer__nav" class="nav__drawer-nav"><span class="nav__drawer-auth"><a href="https://www.twilio.com/login" class="nav__drawer-auth-link">Log In</a><a href="https://www.twilio.com/try-twilio" class="nav__drawer-auth-link">Sign Up</a></span><a href="#close" role="drawer__close" class="nav__drawer-close">Close</a></div>
    <div class="nav__drawer-menu">
      <div class="nav__drawer-container">
        <div class="nav__drawer-grid">
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Products</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://www.twilio.com/voice-video" class="nav__drawer-link nav__drawer-link--category">Voice &amp; Video</a></li>
                  <li><a href="https://www.twilio.com/voice" class="nav__drawer-link">Programmable Voice</a></li>
                  <li><a href="https://www.twilio.com/video" class="nav__drawer-link">Programmable Video</a></li>
                  <li><a href="https://www.twilio.com/sip-trunking" class="nav__drawer-link">Elastic SIP Trunking</a></li>
                  <li><a href="https://www.twilio.com/taskrouter" class="nav__drawer-link">TaskRouter</a></li>
                  <li><a href="https://www.twilio.com/stun-turn" class="nav__drawer-link">Network Traversal</a></li>
                </ul>
                <ul>
                  <li><a href="https://www.twilio.com/messaging" class="nav__drawer-link nav__drawer-link--category">Messaging</a></li>
                  <li><a href="https://www.twilio.com/sms" class="nav__drawer-link">Programmable SMS</a></li>
                  <li><a href="https://www.twilio.com/chat" class="nav__drawer-link">Programmable Chat</a></li>
                  <li><a href="https://www.twilio.com/notify" class="nav__drawer-link">Notify</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Authentication</div>
                  </li>
                  <li><a href="https://www.twilio.com/authy" class="nav__drawer-link">Authy</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Connectivity</div>
                  </li>
                  <li><a href="https://www.twilio.com/lookup" class="nav__drawer-link">Lookup</a></li>
                  <li><a href="https://www.twilio.com/phone-numbers" class="nav__drawer-link">Phone Numbers</a></li>
                  <li><a href="https://www.twilio.com/wireless" class="nav__drawer-link">Programmable Wireless</a></li>
                  <li><a href="https://www.twilio.com/sync" class="nav__drawer-link">Sync</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Marketplace</div>
                  </li>
                  <li><a href="https://www.twilio.com/marketplace/add-ons" class="nav__drawer-link">Add-ons</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Platform</div>
                  </li>
                  <li><a href="https://www.twilio.com/enterprise" class="nav__drawer-link">Enterprise Plan</a></li>
                  <li><a href="https://www.twilio.com/interconnect" class="nav__drawer-link">Interconnect</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Use Cases</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <ul>
                <li><a href="https://www.twilio.com/use-cases/access-security" class="nav__drawer-link nav__drawer-link--category">Access Security</a></li>
                <li><a href="https://www.twilio.com/use-cases/call-and-text-marketing" class="nav__drawer-link nav__drawer-link--category">Call &amp; Text Marketing</a></li>
                <li><a href="https://www.twilio.com/use-cases/collaboration" class="nav__drawer-link nav__drawer-link--category">Collaboration</a></li>
                <li><a href="https://www.twilio.com/use-cases/commerce-communications" class="nav__drawer-link nav__drawer-link--category">Commerce Communications</a></li>
                <li><a href="https://www.twilio.com/use-cases/contact-center" class="nav__drawer-link nav__drawer-link--category">Contact Center</a></li>
              </ul>
              <hr>
            </div>
            <div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://customers.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Customer Stories</a></li>
                  <li><a href="https://www.twilio.com/showcase" class="nav__drawer-link nav__drawer-link--small">Partner Showcase</a></li>
                  <li><a href="https://www.twilio.com/what-is-cloud-communications?" class="nav__drawer-link nav__drawer-link--small">Why Twilio?</a></li>
                  <li><a href="https://www.twilio.com/support-plans" class="nav__drawer-link nav__drawer-link--small">Support Plans</a></li>
                  <li><a href="http://status.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Status</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://www.twilio.com/docs" class="nav__drawer-link nav__drawer-link--small">API &amp; Docs</a></li>
                  <li><a href="https://www.twilio.com/blog" class="nav__drawer-link nav__drawer-link--small">Blog</a></li>
                  <li><a href="https://www.twilio.com/help" class="nav__drawer-link nav__drawer-link--small">Help</a></li>
                  <li><a href="https://www.twilio.com/company/jobs" class="nav__drawer-link nav__drawer-link--small">Jobs at Twilio</a></li>
                </ul>
              </div>
            </div>
            <div class="nav__sales"><a href="https://www.twilio.com/help/sales" class="nav__sales-button">Talk to Sales</a></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div role="nav" class="nav nav--subnav nav--inverted nav--transparent " data-subnav-length="40">
  <div role="nav__menu" class="nav__header">
    <div class="nav__title"><a href="https://www.twilio.com/" class="nav__logo">Twilio</a></div>
    <nav class="nav__menu">
      <ul class="nav__menu-items">
        <li class="nav__menu-item"></li>
        
        <li class="nav__menu-item">
          <a href="https://www.twilio.com/login" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="10.2" height="13.5" viewBox="0 0 10.2 13.5">
              <circle fill="none" stroke="#F22F46" stroke-miterlimit="10" cx="5.1" cy="3" r="2.5"></circle>
              <path fill="none" stroke="#F22F46" stroke-miterlimit="10" d="M.5 13.5c0-2.5 2.1-4.6 4.6-4.6s4.6 2.1 4.6 4.6"></path>
            </svg>
            Log In
          </a>
        </li>
        <li class="nav__menu-item">
          <a href="https://www.twilio.com/try-twilio" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13">
              <path d="M0 6.5h13M6.5 0v13" fill="none" stroke="#F22F46" stroke-miterlimit="10"></path>
            </svg>
            Sign Up
          </a>
        </li>
        
        <li class="nav__menu-item"><a href="#menu" role="nav__activate" class="nav__menu-link nav__menu-activate"><span></span>Menu &amp; Products</a></li>
      </ul>
    </nav>
    <nav role="subnav" class="nav__subnav">
      <header class="nav__subnav-header">
        <a href="https://www.twilio.com/docs" class="nav__subnav-header-link">Docs</a>
        
          <a href="https://www.twilio.com/docs/guides" role="subnav__dropdown" 
            class="nav__subnav-link nav__subnav-current">Guides</a>
        
      </header>
      <ul role="subnav__items" class="nav__subnav-items">
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/quickstart" class="nav__subnav-link">Quickstart</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/guides" class="nav__subnav-link">Guides</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/tutorials" class="nav__subnav-link">Tutorials</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/api" class="nav__subnav-link">API Reference</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/libraries" class="nav__subnav-link">SDKs</a>
        </li>
      </ul>
    </nav>
  </div>
</div>



    
    
      

<div class="docs__pagenav">
  <div class="uk-container uk-container-center">
    <div class="uk-grid">
      <div class="uk-width-3-4 uk-hidden-small">
      
      
        <div class="breadcrumbs">
          
            
          
            
          
            
              <a href="https://www.twilio.com/docs/guides">Guides</a> &gt;
            
          
          <span>Secure your PHP/Lumen app by validating incoming Twilio requests</span>
        </div>
      
      </div>

      
      <div class="uk-width-1-1 uk-width-medium-1-4">
  <div class="search">
    <form action="https://www.twilio.com/docs/search" method="GET">
      <div class="wrapper">
        <input id="search-box" name="q" type="text" value=""/>
      </div>
      <button type="submit">
        <i class="fa fa-fw fa-search"></i>
      </button>
    </form>
  </div>
</div>

    </div>
  </div>
</div>

    

    <div class="docs-container">
      <div class="uk-container">
        
        
  <div class="coderail-container">

    <div class="sidenav-column">
      <div class="theme-switcher uk-hidden-small">
  <div class="theme-wrapper">
    <a data-theme="light" class="selected">
      <i class="fa fa-fw fa-sun-o"></i>
    </a>
    <a data-theme="dark" >
      <i class="fa fa-fw fa-moon-o"></i>
    </a>
  </div>
</div>
      
        <div class="sidenav" data-uk-sticky="{boundary: true}">
          

<ul id="doc_menu" class="sidenav__section" data-swiftype-index="false">

  <!-- Page entries -->
  
    <li id="dynamic-menu">
      <ul>
        
          
          



  <li 
    >
      <a href="https://www.twilio.com/docs/guides">
          Twilio Guides
      </a>
  </li>



        
          
            
<li class="menu-title expanded" role="menu-title" id="doc-navigation-parent">
  Secure your PHP/Lumen app by validating incoming Twilio requests
</li>
<ul class="menu-accordion expanded" role="menu-accordion" id="doc-navigation"></ul>

          
          
<li class="menu-title" role="menu-title">

    <span class="heading">Learn more in PHP</span>
</li>


<ul class="menu-accordion" role="menu-accordion">

    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/guides/sms/how-to-receive-and-reply-in-php">
          Receive and Reply to SMS and MMS Messages
      </a>
  </li>



    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/guides/voice/how-to-respond-to-incoming-phone-calls-in-php">
          Respond to Incoming Phone Calls
      </a>
  </li>



    
        <li>
    <a href="https://www.twilio.com/docs/tutorials/walkthrough/call-tracking/php/laravel" >
        Build Call Tracking with PHP and Laravel

        
    </a>
</li>

    
        <li>
    <a href="https://www.twilio.com/docs/tutorials?filter-language=php" >
        More PHP sample apps and tutorials

        
    </a>
</li>

    
</ul>

        
        
      </ul>
    </li>
  
</ul>

        </div>
      
    </div>

    <div class="primary-column 
        ">
      <div class="docs-prose">
        
  
    
    <h1 class="page-title ">
      Secure your PHP/Lumen app by validating incoming Twilio requests
    </h1>
    
      
<div class="authors">
  <div class="authors-body">
    <div class="author">
      <img src="https://www.gravatar.com/avatar/4fea4ab92cf1693ee648527ff7b4b099?d=mm&amp;s=50" title="Jose Oliveros" alt="Jose Oliveros" />
      Jose Oliveros
    </div>
  </div>
  <div class="authors-footer"></div>
</div>


    
  
  
    <div class="block-markdown ">
      
        

<div>
    <p>In this guide we’ll cover how to secure your <a href="https://lumen.laravel.com/docs/5.3">Lumen</a> application by validating incoming requests to your Twilio webhooks are, in fact, from Twilio.</p>
<p>With a few lines of code we’ll write a custom middleware for our Lumen app that uses the <a href="https://www.twilio.com/docs/libraries/php">Twilio PHP SDK’s</a> <a href="https://github.com/twilio/twilio-php/blob/4.11.0/Services/Twilio/RequestValidator.php"><code>RequestValidator</code></a> utility. We can then use that middleware on our Lumen routes which accept Twilio webhooks to confirm that incoming requests genuinely originated from Twilio.</p>
<p>Let’s get started!</p>
</div>

      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <h2 id="create-custom-middleware"><a class="toclink" href="#create-custom-middleware">Create custom middleware</a></h2>
<p>The Twilio PHP SDK includes a <code>RequestValidator</code> utility which we can use to validate incoming requests.</p>
<p>We could include our request validation code as part of each Lumen route, but this is a perfect opportunity to write Lumen middleware. This way we can reuse our validation logic across all our routes which accept incoming requests from Twilio.</p>
<p>To validate an incoming request genuinely originated from Twilio, we need to call the <code>$requestValidator-&gt;validate(...)</code>. That method will return true if the request is valid or false if it isn’t. Our middleware then either continues processing the view or returns a 403 HTTP response for unauthorized requests.</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-create-lumen-middleware-to-handle-and-validate-requests" 
  data-title="Create Lumen middleware to handle and validate requests" data-pref="server">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-create-lumen-middleware-to-handle-and-validate-requests">Create Lumen middleware to handle and validate requests</a>
        <ul style="visibility:hidden" >
          
            <li class="sample-tab active" 
              data-ext="php">PHP</li>
          
        </ul>
      </div>

      
        
      
          
      
        <pre data-ext="php" data-version="default" class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Security\RequestValidator</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">class</span> <span class="nc">TwilioRequestValidator</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="sd">/**</span>
</span><span class="code-line"><span class="sd">     * Handle an incoming request.</span>
</span><span class="code-line"><span class="sd">     *</span>
</span><span class="code-line"><span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
</span><span class="code-line"><span class="sd">     * @param  \Closure  $next</span>
</span><span class="code-line"><span class="sd">     * @return mixed</span>
</span><span class="code-line"><span class="sd">     */</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">      <span class="c1">// Be sure TWILIO_APP_TOKEN is set in your .env file.</span>
</span><span class="code-line">      <span class="c1">// You can get your app token in your twilio console https://www.twilio.com/console</span>
</span><span class="code-line">      <span class="nv">$requestValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestValidator</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TWILIO_APP_TOKEN&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="nv">$isValid</span> <span class="o">=</span> <span class="nv">$requestValidator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Twilio-Signature&#39;</span><span class="p">),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span><span class="code-line">      <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;You are not Twilio :(&#39;</span><span class="p">,</span> <span class="mi">403</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Create Lumen middleware to handle and validate requests
    </h5>
    
      <p>Use Twilio SDK `RequestValidator` to validate webhook requests.</p>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <h2 id="apply-the-request-validation-middleware-to-webhooks"><a class="toclink" href="#apply-the-request-validation-middleware-to-webhooks">Apply the request validation middleware to webhooks</a></h2>
<p>Apply a custom Twilio request validation middleware to all Lumen routes used for Twilio webhooks.</p>
<p>To use the middleware with your routes, first, you must add the middleware to <code>bootstrap/app.php</code> in the <em>Register Middleware</em> section:</p>
<div class="codehilite"><pre><span class="code-line"><span class="x">$app-&gt;routeMiddleware([</span>
</span><span class="code-line"><span class="x">  &#39;TwilioRequestValidator&#39; =&gt; App\Http\Middleware\TwilioRequestValidator::class,</span>
</span><span class="code-line"><span class="x">]);</span>
</span></pre></div>

<p>Then you must add the middleware to each route as shown here.</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-create-lumen-routes-to-handle-twilio-requests" 
  data-title="Create Lumen routes to handle Twilio requests." data-pref="server">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-create-lumen-routes-to-handle-twilio-requests">Create Lumen routes to handle Twilio requests.</a>
        <ul style="visibility:hidden" >
          
            <li class="sample-tab active" 
              data-ext="php">PHP</li>
          
        </ul>
      </div>

      
        
      
          
      
        <pre data-ext="php" data-version="default" class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Twiml</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;voice&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TwilioRequestValidator&#39;</span><span class="p">,</span>
</span><span class="code-line">  <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nv">$twiml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twiml</span><span class="p">();</span>
</span><span class="code-line">    <span class="nv">$twiml</span><span class="o">-&gt;</span><span class="na">say</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$twiml</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">]);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TwilioRequestValidator&#39;</span><span class="p">,</span>
</span><span class="code-line">  <span class="k">function</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nv">$bodyLength</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;Body&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="nv">$twiml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twiml</span><span class="p">();</span>
</span><span class="code-line">    <span class="nv">$twiml</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">(</span><span class="s2">&quot;Your text to me was </span><span class="si">$bodyLength</span><span class="s2"> characters long. &quot;</span><span class="o">.</span>
</span><span class="code-line">                    <span class="s2">&quot;Webhooks are neat :)&quot;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$twiml</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">]);</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Create Lumen routes to handle Twilio requests.
    </h5>
    
      <p>Creates a route for /voice and /message to handle the respective webhooks.</p>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <h2 id="use-a-tunnel-for-your-local-development-environment-in-order-to-use-live-twilio-webhooks"><a class="toclink" href="#use-a-tunnel-for-your-local-development-environment-in-order-to-use-live-twilio-webhooks">Use a tunnel for your local development environment in order to use live Twilio webhooks</a></h2>
<p>If your Twilio webhook URLs start with <code>https://</code> instead of <code>http://</code>, your request validator may fail locally when you use <a href="https://www.npmjs.com/package/ngrok">ngrok</a> or in production if your stack terminates SSL connections upstream from your app. This is because the request URL that your Express application sees does not match the URL Twilio used to reach your application.</p>
<p>To fix this for local development with <code>ngrok</code>, use <code>ngrok http 3000</code> to accept requests on your webhooks instead of <code>ngrok https 3000</code>.</p>
</div>

      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <h2 id="disable-request-validation-during-testing"><a class="toclink" href="#disable-request-validation-during-testing">Disable request validation during testing</a></h2>
<p>If you write tests for your Lumen routes those tests may fail for routes where you use your Twilio request validation middleware. Any requests your test suite sends to those routes will fail the middleware validation check.</p>
<p>To fix this problem we recommend adding an extra check in your middleware, like shown here, telling it to only reject incoming requests if your app is running in production.</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-disable-twilio-request-validation-when-testing" 
  data-title="Disable Twilio request validation when testing" data-pref="server">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-disable-twilio-request-validation-when-testing">Disable Twilio request validation when testing</a>
        <ul style="visibility:hidden" >
          
            <li class="sample-tab active" 
              data-ext="php">PHP</li>
          
        </ul>
      </div>

      
        
      
          
      
        <pre data-ext="php" data-version="default" class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Security\RequestValidator</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">class</span> <span class="nc">TwilioRequestValidator</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="sd">/**</span>
</span><span class="code-line"><span class="sd">     * Handle an incoming request.</span>
</span><span class="code-line"><span class="sd">     *</span>
</span><span class="code-line"><span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
</span><span class="code-line"><span class="sd">     * @param  \Closure  $next</span>
</span><span class="code-line"><span class="sd">     * @return mixed</span>
</span><span class="code-line"><span class="sd">     */</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Be sure TWILIO_APP_TOKEN is set in your .env file.</span>
</span><span class="code-line">      <span class="c1">// You can get your app token in your twilio console https://www.twilio.com/console</span>
</span><span class="code-line">      <span class="nv">$requestValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestValidator</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TWILIO_APP_TOKEN&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="nv">$isValid</span> <span class="o">=</span> <span class="nv">$requestValidator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Twilio-Signature&#39;</span><span class="p">),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span><span class="code-line">      <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;You are not Twilio :(&#39;</span><span class="p">,</span> <span class="mi">403</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Disable Twilio request validation when testing
    </h5>
    
      <p>Use `APP_ENV` environment variable to disable request validation.</p>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <h2 id="whats-next"><a class="toclink" href="#whats-next">What’s next?</a></h2>
<p>Validating requests to your Twilio webhooks is a great first step for securing your Twilio application. We recommend reading over our full security documentation for more advice on protecting your app, and the <a href="https://www.twilio.com/docs/api/security/anti-fraud">Anti-Fraud Developer’s Guide</a> in particular.</p>
<p>Learn more about <a href="https://www.twilio.com/docs/guides/how-to-set-up-your-php-development-environment">setting up your php development environment</a>.</p>
<p>To learn more about securing your Lumen application in general, check out the security considerations page in the <a href="https://lumen.laravel.com/docs/5.2/authentication">official Lumen docs</a>.</p>
</div>

      
    </div>
  

    
      
<div class="contributors">
  <div class="contributors-body">
  
    <div class="contributor">
      
        <label>Contributors:</label>
      
      <img src="https://www.gravatar.com/avatar/4fea4ab92cf1693ee648527ff7b4b099?d=mm&amp;s=50" title="Jose Oliveros" alt="Jose Oliveros" />
    </div>
  
    <div class="contributor">
      
      <img src="https://www.gravatar.com/avatar/7ff74e11de7b63c4ec66966b9cb75f63?d=mm&amp;s=50" title="Andrew Baker" alt="Andrew Baker" />
    </div>
  
    <div class="contributor">
      
      <img src="https://www.gravatar.com/avatar/bbf0ef8570078f3b334e386c4f9dd8bf?d=mm&amp;s=50" title="Agustin Camino" alt="Agustin Camino" />
    </div>
  
    <div class="contributor">
      
      <img src="https://www.gravatar.com/avatar/4786cf28e0f5886c4b006f7487333845?d=mm&amp;s=50" title="Kevin Whinnery" alt="Kevin Whinnery" />
    </div>
  
  </div>
  <div class="contributors-footer"></div>
</div>


    

        
          
<div id="disqus_thread"></div>


<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

// Unique identifiers
PAGE_URL = "https://www.twilio.com/docs/guides/how-to-secure-your-lumen-app-by-validating-incoming-twilio-requests";

var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'http://twiliodocumentation.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


        
      </div>
    </div>

    <div class="code-column">
      
  <div id="coderail" class="code-rail" data-uk-sticky="{boundary: true}">

  <div class="rail-placeholder"></div>

  <div class="rail-header uk-hidden">

    <div class="rail-header-wrapper">

      <div class="rail-navigation">
        <div class="inner">
          <a href="#previous" class="inactive" data-previous>
            <i class="fa fa-fw fa-arrow-left left"></i>
          </a>
        </div>
        <div class="inner">
          <span>
            <span class="current-index">1</span>
            <span>/</span>
            <span class="snippet-total">1</span>
          </span>
        </div>
        <div class="inner">
          <a href="#next" data-next>
            <i class="fa fa-fw fa-arrow-right"></i>
          </a>
        </div>
      </div>

      <div class="rail-title">
        <div class="title-content inner">
          <span>Loading Code Samples...</span>
          <i class="fa fa-fw fa-chevron-down"></i>
        </div>
      </div>

    </div>

  </div>

  <div class="rail-toolbar uk-hidden">

    <div class="rail-current-language">
      <div class="inner">
        <span>Language</span>
        <i class="fa fa-fw fa-chevron-down"></i>
      </div>
    </div>

    <div class="toolbar">
      <a href="#code" class="uk-hidden tab" data-code>Code</a>
      <a href="#output" class="uk-hidden inactive" data-output>Output</a>

      <span class="separator"></span>

      <a id="download" class="uk-hidden">
        <i class="fa fa-fw fa-download"></i>
        <span>Download Project</span>
      </a>

      <a id="github" class="uk-hidden" target="_blank">
        <i class="fa fa-fw fa-github-square"></i>
        <span>View on GitHub</span>
      </a>

      <a id="defrosty" class="fr-on" href="#defrosty">
        <i class="fa fa-fw fa-eye"></i>
        <span class="wider-tooltip">Toggle Highlighted Lines</span>
      </a>

      <a id="clippy" href="#copy">
        <i class="fa fa-fw fa-copy"></i>
        <span>Copy to Clipboard</span>
      </a>

      <a id="linkcode" href="#linkcode">
        <i class="fa fa-fw fa-link"></i>
        <span>Link to this Code</span>
      </a>

      <a href="#expand" data-expand>
        <i class="fa fa-fw fa-arrows-alt"></i>
        <span>Full Screen</span>
      </a>
      <a href="#collapse" class="uk-hidden" data-collapse>
        <i class="fa fa-fw fa-compress"></i>
        <span>Normal Size</span>
      </a>
    </div>
  </div>

  <div class="rail-samples">
    <ul>
      
        <li>
          <a href="#code-create-lumen-middleware-to-handle-and-validate-requests">
            Create Lumen middleware to handle and validate requests
          </a>
        </li>
      
        <li>
          <a href="#code-create-lumen-routes-to-handle-twilio-requests">
            Create Lumen routes to handle Twilio requests.
          </a>
        </li>
      
        <li>
          <a href="#code-disable-twilio-request-validation-when-testing">
            Disable Twilio request validation when testing
          </a>
        </li>
      
    </ul>
  </div>

  <div class="rail-languages"></div>

  <div class="rail-content">
    <div class="rail-content-inner">
      
        
        <div data-sample-title="Create Lumen middleware to handle and validate requests"
            data-sample="code-create-lumen-middleware-to-handle-and-validate-requests" 
            data-pref="server"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/guides/request-validation-php-lumen/example-1/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="php">PHP</option>
              
            </select>
          </div>

          
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="php" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/guides/example-1.5.x.php"
                class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Security\RequestValidator</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">class</span> <span class="nc">TwilioRequestValidator</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="sd">/**</span>
</span><span class="code-line"><span class="sd">     * Handle an incoming request.</span>
</span><span class="code-line"><span class="sd">     *</span>
</span><span class="code-line"><span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
</span><span class="code-line"><span class="sd">     * @param  \Closure  $next</span>
</span><span class="code-line"><span class="sd">     * @return mixed</span>
</span><span class="code-line"><span class="sd">     */</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">      <span class="c1">// Be sure TWILIO_APP_TOKEN is set in your .env file.</span>
</span><span class="code-line">      <span class="c1">// You can get your app token in your twilio console https://www.twilio.com/console</span>
</span><span class="code-line">      <span class="nv">$requestValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestValidator</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TWILIO_APP_TOKEN&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="nv">$isValid</span> <span class="o">=</span> <span class="nv">$requestValidator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Twilio-Signature&#39;</span><span class="p">),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span><span class="code-line">      <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;You are not Twilio :(&#39;</span><span class="p">,</span> <span class="mi">403</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
        
        <div data-sample-title="Create Lumen routes to handle Twilio requests."
            data-sample="code-create-lumen-routes-to-handle-twilio-requests" 
            data-pref="server"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/guides/request-validation-php-lumen/example-2/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="php">PHP</option>
              
            </select>
          </div>

          
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="php" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/guides/example-2.5.x.php"
                class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Twiml</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;voice&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TwilioRequestValidator&#39;</span><span class="p">,</span>
</span><span class="code-line">  <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nv">$twiml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twiml</span><span class="p">();</span>
</span><span class="code-line">    <span class="nv">$twiml</span><span class="o">-&gt;</span><span class="na">say</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$twiml</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">]);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TwilioRequestValidator&#39;</span><span class="p">,</span>
</span><span class="code-line">  <span class="k">function</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nv">$bodyLength</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;Body&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="nv">$twiml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twiml</span><span class="p">();</span>
</span><span class="code-line">    <span class="nv">$twiml</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">(</span><span class="s2">&quot;Your text to me was </span><span class="si">$bodyLength</span><span class="s2"> characters long. &quot;</span><span class="o">.</span>
</span><span class="code-line">                    <span class="s2">&quot;Webhooks are neat :)&quot;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$twiml</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">]);</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
        
        <div data-sample-title="Disable Twilio request validation when testing"
            data-sample="code-disable-twilio-request-validation-when-testing" 
            data-pref="server"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/guides/request-validation-php-lumen/example-3/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="php">PHP</option>
              
            </select>
          </div>

          
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="php" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/guides/example-3.5.x.php"
                class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Security\RequestValidator</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">class</span> <span class="nc">TwilioRequestValidator</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="sd">/**</span>
</span><span class="code-line"><span class="sd">     * Handle an incoming request.</span>
</span><span class="code-line"><span class="sd">     *</span>
</span><span class="code-line"><span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
</span><span class="code-line"><span class="sd">     * @param  \Closure  $next</span>
</span><span class="code-line"><span class="sd">     * @return mixed</span>
</span><span class="code-line"><span class="sd">     */</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Be sure TWILIO_APP_TOKEN is set in your .env file.</span>
</span><span class="code-line">      <span class="c1">// You can get your app token in your twilio console https://www.twilio.com/console</span>
</span><span class="code-line">      <span class="nv">$requestValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestValidator</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TWILIO_APP_TOKEN&#39;</span><span class="p">));</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="nv">$isValid</span> <span class="o">=</span> <span class="nv">$requestValidator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Twilio-Signature&#39;</span><span class="p">),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
</span><span class="code-line">        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span><span class="code-line">      <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="code-line">        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;You are not Twilio :(&#39;</span><span class="p">,</span> <span class="mi">403</span><span class="p">);</span>
</span><span class="code-line">      <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
    </div>
  </div>
</div>


    </div>

  </div>

      </div>
    </div>

    
    


<div class="footer" data-swiftype-index="false">
  <div class="uk-container uk-container-center">
    <div class="footer__statement">We can’t wait to see what you build.</div>
    <div class="uk-grid">
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Products</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/voice-video" class="footer__link">Voice &amp; Video</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/messaging" class="footer__link">Messaging</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/authy" class="footer__link">Authentication</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/wireless" class="footer__link">Connected Devices</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Use Cases</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/access-security" class="footer__link">Access Security</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/contextual-call-center" class="footer__link">Contextual Call Center</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/marketplace-communications" class="footer__link">Marketplace Communications</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/mobile-messaging" class="footer__link">Mobile Messaging</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">About</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/what-is-cloud-communications?" class="footer__link">What is Twilio?</a>
            </li>
            <li class="footer__list-item">
              <a href="https://customers.twilio.com/" class="footer__link">Customers</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/help" class="footer__link">Get Help</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/help/sales" class="footer__link">Talk to Sales</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-medium-2-5">
        <section class="footer__section">
  <header class="footer__header">Hits From The Blog</header>
  <ul class="footer__list footer__list">
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/building-an-ivr-with-no-code-by-using-taskrouter-as-a-state-machine.html" class="footer__link">Building an IVR with no code by using TaskRouter as a state machine</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/logrole-gives-you-permissions-based-granular-searching-for-twilio-logs.html" class="footer__link">Logrole Gives You Permissions Based, Granular Searching For Twilio Logs</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/build-callbacks-with-stamplay-twilio-and-unbounce.html" class="footer__link">Build Callbacks With Stamplay, Twilio and Unbounce</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/build-a-basic-call-center-in-just-a-few-minutes-with-twilio.html" class="footer__link">Build a Basic Call Center in Just a Few Minutes with Twilio</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/redact-delete-sms-messages-node-js.html" class="footer__link">Redact or Delete SMS Messages as They Arrive with Node.js</a>
    </li>
    
  </ul>

</section>
      </div>
    </div>
    <footer class="footer__footer">
      <div class="footer__logo" title="Twilio">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
          <path d="M15 0C6.7 0 0 6.7 0 15s6.7 15 15 15 15-6.7 15-15S23.3 0 15 0zm0 26C8.9 26 4 21.1 4 15S8.9 4 15 4s11 4.9 11 11-4.9 11-11 11z"/>
          <circle cx="18.7" cy="11.3" r="3.1"/>
          <circle cx="18.7" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="11.3" r="3.1"/>
        </svg>
      </div>
      <ul class="legal__list">
        <li class="legal__list-item">
          <a href="https://www.twilio.com/company" class="legal__link">About Twilio</a>
        </li>
        <li class="legal__list-item">
          <a href="https://www.twilio.com/legal" class="legal__link">Legal</a>
        </li>
        <li class="legal__list-item">Copyright &copy; 2016 Twilio, Inc. 
          <br class="uk-visible-small">All Rights Reserved.
        </li>
      </ul>
    </footer>
  </div>
</div>


    
    <script src="https://www.twilio.com/docs/static/js/vendor.min.16abf41c42de.js"></script>
    

  

  <!-- Mixpanel -->
  <script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
  typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,
    e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
    mixpanel.init("f71c19735fa6ecc5225ff563285e1794");
    </script>
  

  
    <!-- Heap -->
    <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var n=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(n?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o);for(var r=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=r(p[c])};
    heap.load('1541905715');
    </script>
  

  
    <!-- GA -->
    <script type="text/javascript">
    try {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2900316-1']);
      _gaq.push(['_setSiteSpeedSampleRate', 50]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    } catch(err) {}

    var _kmq = _kmq || [];
    </script>
  

  
    <!-- Eloqua -->
    <script type="text/javascript">
    var _elqQ = _elqQ || [];
    _elqQ.push(['elqSetSiteId', '815114181']);
    _elqQ.push(['elqTrackPageView']);
    _elqQ.push(['elqUseFirstPartyCookie', 'www.twilio.com']);

    (function () {
      function async_load() {
        var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
        s.src = 'http://img03.en25.com/i/elqCfg.min.js';
        var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
      }
      if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
      else if (window.attachEvent) window.attachEvent('onload', async_load);
    })();
    </script>
  

  
    <!-- Transifex -->
    <script type="text/javascript">
    window.liveSettings = {
      api_key: '4c06c1c5a6b341e591d969476fe2675f'
    };
    </script>
    <script type="text/javascript" src="http://cdn.transifex.com/live.js"></script>
    <style>
    .txlive-langselector { display: none; }
    </style>
  

  



    
      <script src="https://www.twilio.com/docs/static/js/docs.min.0c5bb1abb16f.js"></script>
    

    
    



    

  </body>

<!-- Mirrored from www.twilio.com/docs/guides/how-to-secure-your-lumen-app-by-validating-incoming-twilio-requests by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:10:04 GMT -->
</html>
