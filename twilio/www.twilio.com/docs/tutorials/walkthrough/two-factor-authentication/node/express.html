


<!DOCTYPE html>
<html class="no-js">
  
<!-- Mirrored from www.twilio.com/docs/tutorials/walkthrough/two-factor-authentication/node/express by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:02:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
	<!-- Optimizely -->
	<script src="https://cdn.optimizely.com/js/6082066.js"></script>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">
    
<meta name="description" content="Two Factor Authentication (2FA) helps keep you user accounts secure by validating two &quot;factors&quot; of identity. Most login systems only validate something your user knows, like a password. You can make it harder for evildoers to compromise a user account by also validating something a user has, like a mobile phone.
In this tutorial, we will show you how to validate both of these factors in a simple token-based login system. To make everything a bit simpler, we&#39;ll also be using Twilio-powered Authy. Authy helps handle all the moving parts associated with 2FA, including sending one-time passwords via text message to your users.">

    

    <title>
      Two-Factor Authentication with Authy - Node.js / Express Tutorial - Twilio
    </title>

    <link rel="canonical" href="express.html" />

    
    <link rel="shortcut icon" href="../../../../static/img/favicons/favicon.db41f19ea294.ico"/>
    <link rel="apple-touch-icon" href="../../../../static/img/favicons/favicon_57.98200b6899e6.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../static/img/favicons/favicon_72.86ae17486256.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../../../../static/img/favicons/favicon_114.ee1859950ad4.png"/>

    
    <link rel="stylesheet" type="text/css" href="http://cloud.typography.com/6230892/752864/css/fonts.css">
    <link rel="stylesheet" href="../../../../static/css/font-awesome.min.295235b28b6e.css" />
    <link rel="stylesheet" href="../../../../static/css/twilio-icons.45de73e993f2.css" />
    <link rel="stylesheet" href="../../../../static/css/font-mfizz.818f36cb00cc.css" />

    
    
    
    
    <meta property="og:url" content="https://www.twilio.com?utm_source=docs&utm_medium=social&utm_campaign=guides_tags">

    
    
    
    

    
    

    

    
      <link rel="stylesheet" href="../../../../static/css/docs.min.05ed18599e08.css" />
    

    
    
<link rel="stylesheet" href="../../../../static/legacy/walkthrough.css" />


    
    <script>
  var twilio = twilio || {};
  twilio.realm = "prod";
  twilio.SWIFTYPE_ENGINE_KEY = "T68bXEBf7NaKzyRpvbnG";
</script>


<script>
  twilio.account = twilio.account || {};
  

  twilio.user = twilio.user || {};
  
  

</script>


    <script>
  
  window.userBetaFeatures = ["marketplace", "enable-video-rooms"];
</script>

  </head>

  <body class="
    
      tutorials
    
    
    
  ">

    

	
	<!-- Google Tag Manager -->
	<noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-MWRD6S"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window, document, 'script', 'dataLayer', 'GTM-MWRD6S');</script>
	<!-- End Google Tag Manager -->
	



    
    <div role="drawer" class="nav__drawer">
  <div role="drawer__wrapper" class="nav__drawer-wrapper">
    <div role="drawer__nav" class="nav__drawer-nav"><span class="nav__drawer-auth"><a href="../../../../../login.html" class="nav__drawer-auth-link">Log In</a><a href="../../../../../try-twilio.html" class="nav__drawer-auth-link">Sign Up</a></span><a href="#close" role="drawer__close" class="nav__drawer-close">Close</a></div>
    <div class="nav__drawer-menu">
      <div class="nav__drawer-container">
        <div class="nav__drawer-grid">
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Products</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="../../../../../voice-video.html" class="nav__drawer-link nav__drawer-link--category">Voice &amp; Video</a></li>
                  <li><a href="../../../../../voice.html" class="nav__drawer-link">Programmable Voice</a></li>
                  <li><a href="../../../../../video.html" class="nav__drawer-link">Programmable Video</a></li>
                  <li><a href="../../../../../sip-trunking.html" class="nav__drawer-link">Elastic SIP Trunking</a></li>
                  <li><a href="../../../../../taskrouter.html" class="nav__drawer-link">TaskRouter</a></li>
                  <li><a href="../../../../../stun-turn.html" class="nav__drawer-link">Network Traversal</a></li>
                </ul>
                <ul>
                  <li><a href="../../../../../messaging.html" class="nav__drawer-link nav__drawer-link--category">Messaging</a></li>
                  <li><a href="../../../../../sms.html" class="nav__drawer-link">Programmable SMS</a></li>
                  <li><a href="../../../../../chat.html" class="nav__drawer-link">Programmable Chat</a></li>
                  <li><a href="../../../../../notify.html" class="nav__drawer-link">Notify</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Authentication</div>
                  </li>
                  <li><a href="../../../../../authy.html" class="nav__drawer-link">Authy</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Connectivity</div>
                  </li>
                  <li><a href="../../../../../lookup.html" class="nav__drawer-link">Lookup</a></li>
                  <li><a href="../../../../../phone-numbers.html" class="nav__drawer-link">Phone Numbers</a></li>
                  <li><a href="../../../../../wireless.html" class="nav__drawer-link">Programmable Wireless</a></li>
                  <li><a href="../../../../../sync.html" class="nav__drawer-link">Sync</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Marketplace</div>
                  </li>
                  <li><a href="../../../../../marketplace/add-ons.html" class="nav__drawer-link">Add-ons</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Platform</div>
                  </li>
                  <li><a href="../../../../../enterprise.html" class="nav__drawer-link">Enterprise Plan</a></li>
                  <li><a href="../../../../../interconnect.html" class="nav__drawer-link">Interconnect</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Use Cases</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <ul>
                <li><a href="../../../../../use-cases/access-security.html" class="nav__drawer-link nav__drawer-link--category">Access Security</a></li>
                <li><a href="../../../../../use-cases/call-and-text-marketing.html" class="nav__drawer-link nav__drawer-link--category">Call &amp; Text Marketing</a></li>
                <li><a href="../../../../../use-cases/collaboration.html" class="nav__drawer-link nav__drawer-link--category">Collaboration</a></li>
                <li><a href="../../../../../use-cases/commerce-communications.html" class="nav__drawer-link nav__drawer-link--category">Commerce Communications</a></li>
                <li><a href="../../../../../use-cases/contact-center.html" class="nav__drawer-link nav__drawer-link--category">Contact Center</a></li>
              </ul>
              <hr>
            </div>
            <div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://customers.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Customer Stories</a></li>
                  <li><a href="../../../../../showcase.html" class="nav__drawer-link nav__drawer-link--small">Partner Showcase</a></li>
                  <li><a href="../../../../../what-is-cloud-communicationsd41d.html?" class="nav__drawer-link nav__drawer-link--small">Why Twilio?</a></li>
                  <li><a href="../../../../../support-plans.html" class="nav__drawer-link nav__drawer-link--small">Support Plans</a></li>
                  <li><a href="http://status.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Status</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="../../../../index.html" class="nav__drawer-link nav__drawer-link--small">API &amp; Docs</a></li>
                  <li><a href="../../../../../blog.html" class="nav__drawer-link nav__drawer-link--small">Blog</a></li>
                  <li><a href="https://support.twilio.com/hc/en-us" class="nav__drawer-link nav__drawer-link--small">Help</a></li>
                  <li><a href="../../../../../company/jobs.html" class="nav__drawer-link nav__drawer-link--small">Jobs at Twilio</a></li>
                </ul>
              </div>
            </div>
            <div class="nav__sales"><a href="../../../../../help/sales.html" class="nav__sales-button">Talk to Sales</a></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div role="nav" class="nav nav--subnav nav--inverted nav--transparent " data-subnav-length="40">
  <div role="nav__menu" class="nav__header">
    <div class="nav__title"><a href="../../../../../index.html" class="nav__logo">Twilio</a></div>
    <nav class="nav__menu">
      <ul class="nav__menu-items">
        <li class="nav__menu-item"></li>
        
        <li class="nav__menu-item">
          <a href="../../../../../login.html" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="10.2" height="13.5" viewBox="0 0 10.2 13.5">
              <circle fill="none" stroke="#F22F46" stroke-miterlimit="10" cx="5.1" cy="3" r="2.5"></circle>
              <path fill="none" stroke="#F22F46" stroke-miterlimit="10" d="M.5 13.5c0-2.5 2.1-4.6 4.6-4.6s4.6 2.1 4.6 4.6"></path>
            </svg>
            Log In
          </a>
        </li>
        <li class="nav__menu-item">
          <a href="../../../../../try-twilio.html" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13">
              <path d="M0 6.5h13M6.5 0v13" fill="none" stroke="#F22F46" stroke-miterlimit="10"></path>
            </svg>
            Sign Up
          </a>
        </li>
        
        <li class="nav__menu-item"><a href="#menu" role="nav__activate" class="nav__menu-link nav__menu-activate"><span></span>Menu &amp; Products</a></li>
      </ul>
    </nav>
    <nav role="subnav" class="nav__subnav">
      <header class="nav__subnav-header">
        <a href="../../../../index.html" class="nav__subnav-header-link">Docs</a>
        
          <a href="../../../../tutorials.html" role="subnav__dropdown" 
            class="nav__subnav-link nav__subnav-current">Tutorials</a>
        
      </header>
      <ul role="subnav__items" class="nav__subnav-items">
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="../../../../quickstart.html" class="nav__subnav-link">Quickstart</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="../../../../guides.html" class="nav__subnav-link">Guides</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="../../../../tutorials.html" class="nav__subnav-link">Tutorials</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="../../../../api.html" class="nav__subnav-link">API Reference</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="../../../../libraries.html" class="nav__subnav-link">SDKs</a>
        </li>
      </ul>
    </nav>
  </div>
</div>



    
    

<div class="docs__pagenav">
  <div class="uk-container uk-container-center">
    <div class="uk-grid">

      <div class="uk-width-3-4 uk-hidden-small">
        <div class="breadcrumbs">
          <a href="../../../../tutorials.html">Tutorials</a> &gt;
          <span>
            Two-Factor Authentication with Authy (Node.js |
            Express)
          </span>
          <span class="get-the-code">
            <a target="_blank" title="Download Source Code" data-metric="download_source" 
               href="https://github.com/TwilioDevEd/authy2fa-node/archive/master.zip">
              <i class="fa fa-download"></i>
            </a>
            <a target="_blank" title="Visit at GitHub" data-metric="view_source" 
               href="https://github.com/TwilioDevEd/authy2fa-node/tree/master">
              <i class="fa fa-github"></i>
            </a>
          </span>
        </div>
      </div>

      <div class="uk-width-1-1 uk-width-medium-1-4">
        <div class="search">
          <form action="https://www.twilio.com/docs/search" method="GET">
            <div class="wrapper">
              <input id="search-box" name="q" type="text" value="">
            </div>
            <button type="submit">
              <i class="fa fa-fw fa-search"></i>
            </button>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>



    <div class="docs-container">
      <div class="uk-container">
        
        
<div class="viewsaurus-container">
	<div id="viewsaurus" data-title="Two-Factor Authentication with Authy">
  <div class="saurus-panes">
    <div class="saurus-prose">
      <div class="saurus-prose-header">
        <div class="title-outer"><span class="step-title">Two-Factor Authentication with Authy</span></div>
      </div>
      <div class="saurus-nav-buttons">
        <div class="saurus-nav-button nav-overview">
          <div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div>
          <div class="nav-divider"></div>
        </div>
        <div class="saurus-nav-button nav-previous">
          <div class="saurus-nav-button-inner"><a href="#"> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div>
          <div class="nav-divider"></div>
        </div>
        <div class="saurus-nav-button nav-next clickable">
          <div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div>
        </div>
        <div class="saurus-next-title"><span class="next-title-inner"></span></div>
      </div>
      <div class="saurus-progress-bar"></div>
      <div class="saurus-start">
        <p>Learn to implement two-factor authentication (2FA) in your web app with Twilio-powered Authy. 2FA helps further secure your users' data by validating more than just a password. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a>
      </div>
      <div class="saurus-content">
<div data-file="api/onetouch.js" data-highlight="" class="step"><h2 id="about-this-application">About this application</h2>
<p>This <a href="http://expressjs.com/">Express.js</a> sample application
demonstrates how to build a login system that uses two factors of authentication to login users.
Head to the <a href="https://github.com/TwilioDevEd/2fa-node">application&#39;s
README.md</a>
to see how to run the application locally.</p>
<p>Adding two-factor authentication (2FA) to your web application increases the
security of your user&#39;s data. <a href="http://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a>
determines the identity of a user by validating first by logging into the app,
and second by validating their mobile device.</p>
<p>For the second factor, we will validate that the user has their mobile phone by either:</p>
<ul>
<li>Sending them a OneTouch push notification to their mobile Authy app</li>
<li>Sending them a token through their mobile Authy app</li>
<li>Sending them a one-time token in a text message <a href="http://www.authy.com/">sent with Authy via Twilio</a>. Here&#39;s how this works at a high level:</li>
</ul>
<p><img src="http://s3.amazonaws.com/howtodocs/2fa-high-level.png" alt="2FA High Level"></p>
<p>Let&#39;s get started! Click the right arrow above to move to the next step
  of the tutorial.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://expressjs.com/starter/hello-world.html">Getting started with Express.js</a></li>
<li><a href="https://github.com/evilpacket/node-authy">node-authy library</a></li>
</ul>

</div>
<div data-file="config.js" class="step"><h2 id="configuring-authy">Configuring Authy</h2>
<p>If you haven&#39;t done so already, now is the time to <a href="https://dashboard.authy.com/signup">sign up for Authy</a>.
Create your first application, naming it whatever you wish. After you create your application,
your &quot;production&quot; API key will be visible on your <a href="https://dashboard.authy.com/">dashboard</a>:</p>
<p><img src="http://s3.amazonaws.com/howtodocs/2fa-authy-dashboard.png" alt="Authy Dashboard"></p>
<p>Once we have an Authy API key, we store it in this initializer file.</p>
<p>Now that we&#39;ve configured our Express app, let&#39;s take a look at how we
register a user with Authy.</p>

</div>
<div data-file="models/User.js" data-highlight="64-77" class="step"><h2 id="registering-a-user-with-authy">Registering a User with Authy</h2>
<p>When a new User is created we also register the User with Authy.</p>
<p>All Authy needs to get a user set up for your application is its email,
phone number and country code. We need to make sure this information is
required when the user is signing up.</p>
<p>Once we register the User with Authy we get an <code>id</code> back that we will
store as the user&#39;s <code>authyId</code>. This is very important since it&#39;s how we
will verify the identity of our User with Authy.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://docs.authy.com/#section-Enabling_two-
factor_on_a_user">Enabling a User with Authy</a></li>
<li><a href="http://mongoosejs.com/docs/guide.html">Getting started with Mongoose</a></li>
<li><a href="http://mongoosejs.com/docs/middleware.html">Mongoose Middleware</a></li>
</ul>

</div>
<div data-file="api/sessions.js" data-highlight="7-44" class="step"><h2 id="logging-in-with-authy-onetouch">Logging in with Authy OneTouch</h2>
<p>When a User attempts to login to our website, a second form of identification
 will be needed. Let&#39;s take a look at Authy&#39;s OneTouch verification first.</p>
<p><img src="http://howtodocs.s3.amazonaws.com/onetouch-approved.gif" alt="Authy OneTouch Approval"></p>
<p>OneTouch works like so:</p>
<ul>
<li>We attempt to send a User a <em>OneTouch Approval Request</em></li>
<li>If the User has OneTouch enabled, we will get a <code>success</code> message back</li>
<li>The User hits &#39;Approve&#39; in their Authy app</li>
<li>Authy makes a POST request to our app with an &#39;Approved&#39; status</li>
<li>We log the User in</li>
</ul>
<p>In the next steps we&#39;ll look at how we handle cases where the User does not
have OneTouch, or denies the login request.</p>

</div>
<div data-file="models/User.js" data-highlight="89-105" class="step"><h2 id="sending-the-onetouch-request">Sending the OneTouch Request</h2>
<p>When our User logs in we immediately attempt to verify their identity with
OneTouch. We will fallback gracefully if they don&#39;t have a OneTouch device,
but we don&#39;t know until we try.</p>
<p>Authy lets us pass details with our OneTouch request. These can be messages,
logos and any other details we want to send. We could easily send any
number of details by appending <code>details[&#39;some_detail&#39;]</code>. You could imagine a
scenario where we send a OneTouch request to approve a money transfer:</p>
<pre><code class="cm-s-monokai lang-js"><span class="cm-variable">details</span> <span class="cm-operator">=</span> {
  <span class="cm-property">message</span>: <span class="cm-string">&quot;Request to send money to Jarod&#39;s vault&quot;</span>,
  <span class="cm-property">from</span>: <span class="cm-string">&quot;Jarod&quot;</span>,
  <span class="cm-property">amount</span>: <span class="cm-string">&quot;1,000,000&quot;</span>,
  <span class="cm-property">currency</span>: <span class="cm-string">&quot;Galleons&quot;</span>
},
</code></pre>
<p><em>Note: We need some way to check the status of the user&#39;s two-factor process, in this case we do so by updating the <code>User.authyStatus</code> attribute. It&#39;s important we reset this before we log the user in.</em></p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://docs.authy.com/new_doc/authy_onetouch_api#create-an-approval-request-to-be-sent-to-user">Create Approval Requests with Authy</a></li>
<li><a href="http://docs.authy.com/new_doc/authy_onetouch_api#getting-approval-request-info">Getting Approval Request info</a></li>
</ul>

</div>
<div data-file="api/sessions.js" data-highlight="57-70" class="step"><h2 id="configuring-the-onetouch-callback">Configuring the OneTouch callback</h2>
<p>In order for our app to know what the User did after we sent the OneTouch
request, we need to register a callback endpoint with Authy.</p>
<p><img src="http://howtodocs.s3.amazonaws.com/onetouch-callback-endpoint.png" alt="Authy OneTouch Callback"></p>
<p>Here in our callback, we look up the user using the <code>authy_id</code> sent with the Authy POST request. Ideally at this point we would probably use a websocket to let our client know that we received a response from Authy. However for this version we&#39;re going to keep it simple and just update the <code>authyStatus</code> on the User. Then all our client-side code needs to do is check for <code>user.authyStatus.approved</code> before logging him/her in.</p>
<p>Let&#39;s take a look at the client-side code that will be handling this.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://mongoosejs.com/docs/queries.html">Mongoose findOne Query</a></li>
<li><a href="http://github.com/expressjs/body-parser#bodyparserjsonoptions">Using BodyParser for JSON</a></li>
</ul>

</div>
<div data-file="public/app/views/Login.js" class="step"><h2 id="handling-two-factor-asyncronously">Handling Two-Factor Asyncronously</h2>
<p><em>Our user interface for this example is a <a href="http://en.wikipedia.org/wiki/Single-page_application">single page application</a> written using <a href="http://backbonejs.org/">Backbone</a> and <a href="http://jquery.com/">jQuery</a>.</em></p>
<p>We&#39;ve already taken a look at what&#39;s happening on the server side, so
let&#39;s step in front of the cameras now and see how our JavaScript is
interacting with those server endpoints.</p>
<p>First we hijack the login form submitted and pass the data to our
<code>/session</code> controller using Ajax. Depending on how that endpoint
responds we will either ask the User for a token or await their OneTouch
response.</p>
<p>If we expect a OneTouch response, we will begin polling <code>/authy/status</code>
until we either see OneTouch login was either approved or denied. Let&#39;s
take a look at this controller and see what is happening.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="http://api.jquery.com/jquery.post/">jQuery Post method</a></li>
</ul>

</div>
<div data-file="api/sessions.js" data-highlight="72-87" class="step"><h2 id="falling-back-to-token">Falling back to Token</h2>
<p>Here is the endpoint that our javascript is polling. It is waiting for the
user status to be either &#39;Approved&#39; or &#39;Denied&#39;. If the User has approved
the OneTouch request, we will save their session as <code>confirmed</code>, which
officially logs them in.</p>
<p>If the request was denied we render the <code>/verify</code> page and ask the User to log in with a Token.</p>
<p>Now let&#39;s take a look at how we handle two-factor with tokens.</p>

</div>
<div data-file="models/User.js" data-highlight="107-122" class="step"><h2 id="sending-a-2fa-token">Sending a 2FA Token</h2>
<p><img src="http://s3.amazonaws.com/howtodocs/2fa-flow5.png" alt="2FA Flow Chart Step 5"></p>
<p>Once there is an Authy user ID associated with our user model, we can request that an SMS verification token be sent out to the user&#39;s phone. Authy supports token validation in their mobile app as well, so if our user has the app it will default to sending a push notification instead of an SMS.</p>
<p>We can call this method on the user instance multiple times if needed. This is what happens every time the user clicks &quot;Resend Code&quot; on the web form we will take a look at next.</p>

</div>
<div data-file="api/sessions.js" data-highlight="89-112" class="step"><h2 id="validating-the-code">Validating the Code</h2>
<p><img src="http://s3.amazonaws.com/howtodocs/2fa-flow8.png" alt="2FA Flow Chart Step 8"></p>
<p>Our Express route handler, will grab the code submitted on the form in order to validate it. <a href="http://stephensugden.com/middleware_guide/">Connect middleware</a> function executes before this handler and adds a <code>user</code> property to the <code>request</code> object that contains a Mongoose model instance representing the user associated with this session. We use <code>verifyAuthyToken</code> on the <code>User</code> model to check if the code submitted by the user is legit.</p>

</div>
<div data-file="models/Session.js" class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented two-factor authentication using three different methods and the latest in Authy technology.</p>
<p>If you&#39;re a Node.js developer working with Twilio, you might want to
check out these other tutorials.</p>
<p><a href="../../account-verification/node/express.html"><strong>Account Verification</strong></a></p>
<p>Increase the security of your login system by verifying a user&#39;s mobile
phone.</p>
<p><a href="../../server-notifications/node/express.html"><strong>Server
Notifications via SMS</strong></a></p>
<p>Faster than e-mail and less likely to get blocked, text messages are great for timed alerts and notifications. Learn how to send out SMS (and MMS) notifications to a list of server administrators.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking this tutorial out! If you have any feedback to share
with us, we&#39;d love to hear it. <a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a> to let us know what you think.</p>

</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="api/onetouch.js" data-mode="javascript">dmFyIGNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZycpOwp2YXIgcXVlcnlzdHJpbmcgPSByZXF1aXJlKCJxdWVyeXN0cmluZyIpOwovLyBDcmVhdGUgYXV0aGVudGljYXRlZCBBdXRoeSBBUEkgY2xpZW50CnZhciBhdXRoeSA9IHJlcXVpcmUoJ2F1dGh5JykoY29uZmlnLmF1dGh5QXBpS2V5KTsKCi8vIEV4dGVuZCB0aGUgQXV0aHkgbW9kdWxlIHRvIHNlbmRfYXBwcm92YWxfcmVxdWVzdApleHBvcnRzLnNlbmRfYXBwcm92YWxfcmVxdWVzdCA9IGZ1bmN0aW9uIChpZCxkZXRhaWxzLGNhbGxiYWNrKXsKICAgIHZhciB1cmw9Ii9vbmV0b3VjaC9qc29uL3VzZXJzLyIrcXVlcnlzdHJpbmcuZXNjYXBlKGlkKSsiL2FwcHJvdmFsX3JlcXVlc3RzIjsgICAKICAgIGF1dGh5Ll9yZXF1ZXN0KCJwb3N0IiwgIi9vbmV0b3VjaC9qc29uL3VzZXJzLyIrcXVlcnlzdHJpbmcuZXNjYXBlKGlkKSsiL2FwcHJvdmFsX3JlcXVlc3RzIiwgewogICAgICAgICJkZXRhaWxzW0VtYWlsIEFkZHJlc3NdIjogZGV0YWlscy5lbWFpbCwKICAgICAgICAibWVzc2FnZSI6ZGV0YWlscy5tZXNzYWdlCiAgICB9LCBjYWxsYmFjayk7Cn07</textarea>
<textarea class="saurus-file" data-file="config.js" data-mode="javascript">bW9kdWxlLmV4cG9ydHMgPSB7CiAgICAvLyBIVFRQIHBvcnQKICAgIHBvcnQ6IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMCwKICAgIAogICAgLy8gUHJvZHVjdGlvbiBBdXRoeSBBUEkga2V5CiAgICBhdXRoeUFwaUtleTogcHJvY2Vzcy5lbnYuQVVUSFlfQVBJX0tFWSwKCiAgICAvLyBNb25nb0RCIGNvbm5lY3Rpb24gc3RyaW5nIC0gTU9OR09fVVJMIGlzIGZvciBsb2NhbCBkZXYsCiAgICAvLyBNT05HT0xBQl9VUkkgaXMgZm9yIHRoZSBNb25nb0xhYiBhZGQtb24gZm9yIEhlcm9rdSBkZXBsb3ltZW50CiAgICBtb25nb1VybDogcHJvY2Vzcy5lbnYuTU9OR09MQUJfVVJJIHx8IHByb2Nlc3MuZW52Lk1PTkdPX1VSTAp9Ow==</textarea>
<textarea class="saurus-file" data-file="models/User.js" data-mode="javascript">dmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKdmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpOwp2YXIgY29uZmlnID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7CnZhciBvbmV0b3VjaCA9IHJlcXVpcmUoJy4uL2FwaS9vbmV0b3VjaCcpOwoKLy8gQ3JlYXRlIGF1dGhlbnRpY2F0ZWQgQXV0aHkgQVBJIGNsaWVudAp2YXIgYXV0aHkgPSByZXF1aXJlKCdhdXRoeScpKGNvbmZpZy5hdXRoeUFwaUtleSk7CgovLyBVc2VkIHRvIGdlbmVyYXRlIHBhc3N3b3JkIGhhc2gKdmFyIFNBTFRfV09SS19GQUNUT1IgPSAxMDsKCi8vIERlZmluZSB1c2VyIG1vZGVsIHNjaGVtYQp2YXIgVXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgZnVsbE5hbWU6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBjb3VudHJ5Q29kZTogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIHBob25lOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgYXV0aHlJZDogU3RyaW5nLAogICAgZW1haWw6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdW5pcXVlOiB0cnVlCiAgICB9LAogICAgcGFzc3dvcmQ6IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBhdXRoeVN0YXR1czogewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICBkZWZhdWx0OiAndW52ZXJpZmllZCcKICAgIH0KfSk7CgovLyBNaWRkbGV3YXJlIGV4ZWN1dGVkIGJlZm9yZSBzYXZlIC0gaGFzaCB0aGUgdXNlcidzIHBhc3N3b3JkClVzZXJTY2hlbWEucHJlKCdzYXZlJywgZnVuY3Rpb24obmV4dCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8vIG9ubHkgaGFzaCB0aGUgcGFzc3dvcmQgaWYgaXQgaGFzIGJlZW4gbW9kaWZpZWQgKG9yIGlzIG5ldykKICAgIGlmICghc2VsZi5pc01vZGlmaWVkKCdwYXNzd29yZCcpKSByZXR1cm4gbmV4dCgpOwoKICAgIC8vIGdlbmVyYXRlIGEgc2FsdAogICAgYmNyeXB0LmdlblNhbHQoU0FMVF9XT1JLX0ZBQ1RPUiwgZnVuY3Rpb24oZXJyLCBzYWx0KSB7CiAgICAgICAgaWYgKGVycikgcmV0dXJuIG5leHQoZXJyKTsKCiAgICAgICAgLy8gaGFzaCB0aGUgcGFzc3dvcmQgdXNpbmcgb3VyIG5ldyBzYWx0CiAgICAgICAgYmNyeXB0Lmhhc2goc2VsZi5wYXNzd29yZCwgc2FsdCwgZnVuY3Rpb24oZXJyLCBoYXNoKSB7CiAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycik7CgogICAgICAgICAgICAvLyBvdmVycmlkZSB0aGUgY2xlYXJ0ZXh0IHBhc3N3b3JkIHdpdGggdGhlIGhhc2hlZCBvbmUKICAgICAgICAgICAgc2VsZi5wYXNzd29yZCA9IGhhc2g7CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgIGlmICghc2VsZi5hdXRoeUlkKSB7CiAgICAgICAgLy8gUmVnaXN0ZXIgdGhpcyB1c2VyIGlmIGl0J3MgYSBuZXcgdXNlcgogICAgICAgIGF1dGh5LnJlZ2lzdGVyX3VzZXIoc2VsZi5lbWFpbCwgc2VsZi5waG9uZSwgc2VsZi5jb3VudHJ5Q29kZSwgCiAgICAgICAgICAgIGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYoZXJyKXsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oZXJyKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLmF1dGh5SWQgPSByZXNwb25zZS51c2VyLmlkOwogICAgICAgICAgICBzZWxmLnNhdmUoZnVuY3Rpb24oZXJyLCBkb2MpIHsKICAgICAgICAgICAgICAgIGlmIChlcnIgfHwgIWRvYykgcmV0dXJuIG5leHQoZXJyKTsKICAgICAgICAgICAgICAgIHNlbGYgPSBkb2M7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKfSk7CgovLyBUZXN0IGNhbmRpZGF0ZSBwYXNzd29yZApVc2VyU2NoZW1hLm1ldGhvZHMuY29tcGFyZVBhc3N3b3JkID0gZnVuY3Rpb24oY2FuZGlkYXRlUGFzc3dvcmQsIGNiKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBiY3J5cHQuY29tcGFyZShjYW5kaWRhdGVQYXNzd29yZCwgc2VsZi5wYXNzd29yZCwgZnVuY3Rpb24oZXJyLCBpc01hdGNoKSB7CiAgICAgICAgaWYgKGVycikgcmV0dXJuIGNiKGVycik7CiAgICAgICAgY2IobnVsbCwgaXNNYXRjaCk7CiAgICB9KTsKfTsKCi8vIFNlbmQgYSBPbmVUb3VjaCByZXF1ZXN0IHRvIHRoaXMgdXNlcgpVc2VyU2NoZW1hLm1ldGhvZHMuc2VuZE9uZVRvdWNoID0gZnVuY3Rpb24oY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYuYXV0aHlTdGF0dXMgPSAndW52ZXJpZmllZCc7CiAgICBzZWxmLnNhdmUoKTsKCiAgICBvbmV0b3VjaC5zZW5kX2FwcHJvdmFsX3JlcXVlc3Qoc2VsZi5hdXRoeUlkLCB7CiAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgdG8gTG9naW4gdG8gVHdpbGlvIGRlbW8gYXBwJywKICAgICAgICBlbWFpbDogc2VsZi5lbWFpbAogICAgfSwgZnVuY3Rpb24oZXJyLCBhdXRoeXJlcyl7CiAgICAgICAgaWYgKGVyciAmJiBlcnIuc3VjY2VzcyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgYXV0aHlyZXMgPSBlcnI7CiAgICAgICAgICAgIGVyciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGNiLmNhbGwoc2VsZiwgZXJyLCBhdXRoeXJlcyk7CiAgICB9KTsKfTsKCi8vIFNlbmQgYSAyRkEgdG9rZW4gdG8gdGhpcyB1c2VyClVzZXJTY2hlbWEubWV0aG9kcy5zZW5kQXV0aHlUb2tlbiA9IGZ1bmN0aW9uKGNiKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgYXV0aHkucmVxdWVzdF9zbXMoc2VsZi5hdXRoeUlkLCBmdW5jdGlvbihlcnIsIHJlc3BvbnNlKSB7CiAgICAgICAgY2IuY2FsbChzZWxmLCBlcnIpOwogICAgfSk7Cn07CgovLyBUZXN0IGEgMkZBIHRva2VuClVzZXJTY2hlbWEubWV0aG9kcy52ZXJpZnlBdXRoeVRva2VuID0gZnVuY3Rpb24ob3RwLCBjYikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgYXV0aHkudmVyaWZ5KHNlbGYuYXV0aHlJZCwgb3RwLCBmdW5jdGlvbihlcnIsIHJlc3BvbnNlKSB7CiAgICAgICAgY2IuY2FsbChzZWxmLCBlcnIsIHJlc3BvbnNlKTsKICAgIH0pOwp9OwoKLy8gRXhwb3J0IHVzZXIgbW9kZWwKbW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnVXNlcicsIFVzZXJTY2hlbWEpOwo=</textarea>
<textarea class="saurus-file" data-file="api/sessions.js" data-mode="javascript">dmFyIFNlc3Npb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvU2Vzc2lvbicpOwp2YXIgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7CnZhciBlcnJvciA9IHJlcXVpcmUoJy4vcmVzcG9uc2VfdXRpbHMnKS5lcnJvcjsKdmFyIG9rID0gcmVxdWlyZSgnLi9yZXNwb25zZV91dGlscycpLm9rOwoKLy8gQ3JlYXRlIGEgbmV3IHNlc3Npb24sIGZpcnN0IHRlc3RpbmcgdXNlcm5hbWUvcGFzc3dvcmQgY29tYm8KZXhwb3J0cy5jcmVhdGUgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIGVtYWlsID0gcmVxdWVzdC5ib2R5LmVtYWlsOwogICAgdmFyIGNhbmRpZGF0ZVBhc3N3b3JkID0gcmVxdWVzdC5ib2R5LnBhc3N3b3JkOwoKICAgIC8vIExvb2sgZm9yIGEgdXNlciBieSB0aGUgZ2l2ZW4gdXNlcm5hbWUKICAgIFVzZXIuZmluZE9uZSh7CiAgICAgICAgZW1haWw6IGVtYWlsCiAgICB9LCBmdW5jdGlvbihlcnIsIHVzZXIpIHsKICAgICAgICBpZiAoZXJyIHx8ICF1c2VyKSByZXR1cm4gaW52YWxpZCgpOwoKICAgICAgICAvLyBXZSBoYXZlIGEgdXNlciBmb3IgdGhhdCB1c2VybmFtZSwgdGVzdCBwYXNzd29yZAogICAgICAgIHVzZXIuY29tcGFyZVBhc3N3b3JkKGNhbmRpZGF0ZVBhc3N3b3JkLCBmdW5jdGlvbihlcnIsIG1hdGNoKSB7CiAgICAgICAgICAgIGlmIChlcnIgfHwgIW1hdGNoKSByZXR1cm4gaW52YWxpZCgpOwogICAgICAgICAgICByZXR1cm4gdmFsaWQodXNlcik7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyByZXNwb25kIHdpdGggYSA0MDMgZm9yIGEgbG9naW4gZXJyb3IKICAgIGZ1bmN0aW9uIGludmFsaWQoKSB7CiAgICAgICAgZXJyb3IocmVzcG9uc2UsIDQwMywgJ0ludmFsaWQgdXNlcm5hbWUvcGFzc3dvcmQgY29tYmluYXRpb24uJyk7CiAgICB9CgogICAgLy8gcmVzcG9uZCB3aXRoIGEgbmV3IHNlc3Npb24gZm9yIGEgdmFsaWQgcGFzc3dvcmQsIGFuZCBzZW5kIGEgT25lVG91Y2ggcmVxdWVzdAogICAgZnVuY3Rpb24gdmFsaWQodXNlcikgewogICAgICAgIFNlc3Npb24uY3JlYXRlU2Vzc2lvbkZvclVzZXIodXNlciwgZmFsc2UsIGZ1bmN0aW9uKGVyciwgc2VzcywgYXV0aHlSZXNwb25zZSkgewogICAgICAgICAgICBpZiAoZXJyIHx8ICFzZXNzKSB7CiAgICAgICAgICAgICAgICBlcnJvcihyZXNwb25zZSwgNTAwLCAKICAgICAgICAgICAgICAgICAgICAnRXJyb3IgY3JlYXRpbmcgc2Vzc2lvbiAtIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBTZW5kIHRoZSB1bmlxdWUgdG9rZW4gZm9yIHRoaXMgc2Vzc2lvbiBhbmQgdGhlIG9uZXRvdWNoIHJlc3BvbnNlCiAgICAgICAgICAgICAgICByZXNwb25zZS5zZW5kKHsKICAgICAgICAgICAgICAgICAgICB0b2tlbjogc2Vzcy50b2tlbiwKICAgICAgICAgICAgICAgICAgICBhdXRoeVJlc3BvbnNlOiBhdXRoeVJlc3BvbnNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9OwoKLy8gRGVzdHJveSB0aGUgZ2l2ZW4gc2Vzc2lvbiAobG9nIG91dCkKZXhwb3J0cy5kZXN0cm95ID0gZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIHJlcXVlc3Quc2Vzc2lvbiAmJiByZXF1ZXN0LnNlc3Npb24ucmVtb3ZlKGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBlcnJvcihyZXNwb25zZSwgNTAwLCAnVGhlcmUgd2FzIGEgcHJvYmxlbSBsb2dnaW5nIHlvdSBvdXQgLSBwbGVhc2UgcmV0cnkuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb2socmVzcG9uc2UpOwogICAgICAgIH0KICAgIH0pOwp9OwoKLy8gUHVibGljIHdlYmhvb2sgZm9yIEF1dGh5IHRvIFBPU1QgdG8KZXhwb3J0cy5hdXRoeUNhbGxiYWNrID0gZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIHZhciBhdXRoeUlkID0gcmVxdWVzdC5ib2R5LmF1dGh5X2lkOwoKICAgIC8vIExvb2sgZm9yIGEgdXNlciB3aXRoIHRoZSBhdXRoeV9pZCBzdXBwbGllcwogICAgVXNlci5maW5kT25lKHsKICAgICAgICBhdXRoeUlkOiBhdXRoeUlkCiAgICB9LCBmdW5jdGlvbihlcnIsIHVzZXIpIHsKICAgICAgICBpZiAoZXJyIHx8ICF1c2VyKSByZXR1cm4gaW52YWxpZCgpOwogICAgICAgIHVzZXIuYXV0aHlTdGF0dXMgPSByZXF1ZXN0LmJvZHkuc3RhdHVzOwogICAgICAgIHVzZXIuc2F2ZSgpOwogICAgfSk7CiAgICByZXNwb25zZS5lbmQoKTsKfTsKCi8vIEludGVybmFsIGVuZHBvaW50IGZvciBjaGVja2luZyB0aGUgc3RhdHVzIG9mIE9uZVRvdWNoCmV4cG9ydHMuYXV0aHlTdGF0dXMgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIHN0YXR1cyA9IChyZXF1ZXN0LnVzZXIpID8gcmVxdWVzdC51c2VyLmF1dGh5U3RhdHVzIDogJ3VudmVyaWZpZWQnOwogICAgaWYgKHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgcmVxdWVzdC5zZXNzaW9uLmNvbmZpcm1lZCA9IHRydWU7CiAgICAgICAgcmVxdWVzdC5zZXNzaW9uLnNhdmUoZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiBlcnJvcihyZXNwb25zZSwgNTAwLCAKICAgICAgICAgICAgICAgICdUaGVyZSB3YXMgYW4gZXJyb3IgdmFsaWRhdGluZyB5b3VyIHNlc3Npb24uJyk7CiAgICAgICAgfSk7CiAgICB9CiAgICBpZiAoIXJlcXVlc3Quc2Vzc2lvbikgewogICAgICAgIHJldHVybiBlcnJvcihyZXNwb25zZSwgNDA0LCAnTm8gdmFsaWQgc2Vzc2lvbiBmb3VuZCBmb3IgdGhpcyB1c2VyLicpOwogICAgfSBlbHNlIHsKICAgICAgICByZXNwb25zZS5zZW5kKHsgc3RhdHVzOiBzdGF0dXMgfSk7CiAgICB9ICAgCn07CgovLyBWYWxpZGF0ZSBhIDJGQSB0b2tlbiAKZXhwb3J0cy52ZXJpZnkgPSBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIG9uZVRpbWVDb2RlID0gcmVxdWVzdC5ib2R5LmNvZGU7CgogICAgaWYgKCFyZXF1ZXN0LnNlc3Npb24gfHwgIXJlcXVlc3QudXNlcikgewogICAgICAgIHJldHVybiBlcnJvcihyZXNwb25zZSwgNDA0LCAnTm8gdmFsaWQgc2Vzc2lvbiBmb3VuZCBmb3IgdGhpcyB0b2tlbi4nKTsKICAgIH0KCiAgICAvLyB2ZXJpZnkgZW50ZXJlZCBhdXRoeSBjb2RlCiAgICByZXF1ZXN0LnVzZXIudmVyaWZ5QXV0aHlUb2tlbihvbmVUaW1lQ29kZSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgaWYgKGVycikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA0MDEsICdJbnZhbGlkIGNvbmZpcm1hdGlvbiBjb2RlLicpOwoKICAgICAgICAvLyBvdGhlcndpc2Ugd2UncmUgZ29vZCEgVmFsaWRhdGUgdGhlIHNlc3Npb24KICAgICAgICByZXF1ZXN0LnNlc3Npb24uY29uZmlybWVkID0gdHJ1ZTsKICAgICAgICByZXF1ZXN0LnNlc3Npb24uc2F2ZShmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA1MDAsIAogICAgICAgICAgICAgICAgJ1RoZXJlIHdhcyBhbiBlcnJvciB2YWxpZGF0aW5nIHlvdXIgc2Vzc2lvbi4nKTsKCiAgICAgICAgICAgIHJlc3BvbnNlLnNlbmQoewogICAgICAgICAgICAgICAgdG9rZW46IHJlcXVlc3Quc2Vzc2lvbi50b2tlbgogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0pOwp9OwoKLy8gUmVzZW5kIHZhbGlkYXRpb24gY29kZQpleHBvcnRzLnJlc2VuZCA9IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICBpZiAoIXJlcXVlc3QudXNlcikgcmV0dXJuIGVycm9yKHJlc3BvbnNlLCA0MDQsIAogICAgICAgICdObyB1c2VyIGZvdW5kIGZvciB0aGlzIHNlc3Npb24sIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CgogICAgLy8gT3RoZXJ3aXNlIHJlc2VuZCB0aGUgY29kZQogICAgcmVxdWVzdC51c2VyLnNlbmRBdXRoeVRva2VuKGZ1bmN0aW9uKGVycikgewogICAgICAgIGlmICghcmVxdWVzdC51c2VyKSByZXR1cm4gZXJyb3IocmVzcG9uc2UsIDUwMCwgCiAgICAgICAgICAgICdObyB1c2VyIGZvdW5kIGZvciB0aGlzIHNlc3Npb24sIHBsZWFzZSBsb2cgaW4gYWdhaW4uJyk7CgogICAgICAgIG9rKHJlc3BvbnNlKTsKICAgIH0pOwp9Ow==</textarea>
<textarea class="saurus-file" data-file="public/app/views/Login.js" data-mode="javascript">KGZ1bmN0aW9uKCkgewogICAgYXBwLnZpZXdzLkxvZ2luVmlldyA9IGFwcC52aWV3cy5CYXNlVmlldy5leHRlbmQoewogICAgICAgIC8vIG5hbWUgb2YgdGhlIHRlbXBsYXRlIGZpbGUgdG8gbG9hZCBmcm9tIHRoZSBzZXJ2ZXIKICAgICAgICB0ZW1wbGF0ZU5hbWU6ICdsb2dpbicsCgogICAgICAgIC8vIFVJIGV2ZW50cwogICAgICAgIGV2ZW50czogewogICAgICAgICAgICAnc3VibWl0ICNsb2dpbkZvcm0nOiAnbG9naW4nCiAgICAgICAgfSwKCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gZGVmYXVsdCBiZWhhdmlvciwgcmVuZGVyIHBhZ2UgaW50byAjcGFnZSBzZWN0aW9uCiAgICAgICAgICAgIGFwcC5yb3V0ZXIub24oJ3JvdXRlOmxvZ2luJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvLyBIaXQgbG9naW4gc2VydmljZQogICAgICAgIGxvZ2luOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgYXBwLnNldCgnbWVzc2FnZScsIG51bGwpOwogICAgICAgICAgICAkLmFqYXgoJy9zZXNzaW9uJywgewogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHNlbGYuJCgnI2VtYWlsJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlbGYuJCgnI3Bhc3N3b3JkJykudmFsKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBzZXNzaW9uIHJldHVybnMgb25lVG91Y2ggc3RhdHVzLnN1Y2Nlc3Mgd2FpdCBmb3Igb25lU3RhdHVzIGFwcHJvdmFsCiAgICAgICAgICAgICAgICBhcHAuc2V0KCd0b2tlbicsIGRhdGEudG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKGRhdGEuYXV0aHlSZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwLnNldCgnb25ldG91Y2gnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBhcHAuc2V0KCdtZXNzYWdlJywgewogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdBd2FpdGluZyBPbmUgVG91Y2ggYXBwcm92YWwuJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hlY2tPbmVUb3VjaFN0YXR1cygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhcHAucm91dGVyLm5hdmlnYXRlKCd2ZXJpZnknLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgICAgIGFwcC5zZXQoJ21lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyLnJlc3BvbnNlSlNPTi5tZXNzYWdlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICdTb3JyeSwgYW4gZXJyb3Igb2NjdXJyZWQsIHBsZWFzZSBsb2cgaW4gYWdhaW4uJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIGNoZWNrT25lVG91Y2hTdGF0dXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICQuYWpheCgnL2F1dGh5L3N0YXR1cycsIHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ1gtQVBJLVRPS0VOJzogYXBwLmdldCgndG9rZW4nKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwLnJvdXRlci5uYXZpZ2F0ZSgndXNlcicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PSAnZGVuaWVkJykgewogICAgICAgICAgICAgICAgICAgIGFwcC5yb3V0ZXIubmF2aWdhdGUoJ3ZlcmlmeScsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGFwcC5zZXQoJ21lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnT25lVG91Y2ggTG9naW4gcmVxdWVzdCBkZW5pZWQuJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNlbGYuY2hlY2tPbmVUb3VjaFN0YXR1cygpLCAzMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7Cn0pKCk7</textarea>
<textarea class="saurus-file" data-file="models/Session.js" data-mode="javascript">dmFyIG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKdmFyIHV1aWQgPSByZXF1aXJlKCdub2RlLXV1aWQnKTsKdmFyIFVzZXIgPSByZXF1aXJlKCcuL1VzZXInKTsKCi8vIERlZmluZSBzZXNzaW9uIG1vZGVsIHNjaGVtYQp2YXIgU2Vzc2lvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgdXNlcklkOiB7CiAgICAgICAgdHlwZTogU3RyaW5nLAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgdG9rZW46IHsKICAgICAgICB0eXBlOiBTdHJpbmcsCiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdW5pcXVlOiB0cnVlCiAgICB9LAogICAgY29uZmlybWVkOiB7CiAgICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgfQp9KTsKCi8vIENyZWF0ZSBhIHNlc3Npb24gZm9yIHRoZSBnaXZlbiB1c2VyClNlc3Npb25TY2hlbWEuc3RhdGljcy5jcmVhdGVTZXNzaW9uRm9yVXNlciA9IGZ1bmN0aW9uKHVzZXIsIGNvbmYsIGNiKSB7CiAgICB2YXIgbmV3U2Vzc2lvbiA9IG5ldyBTZXNzaW9uKHsKICAgICAgICB1c2VySWQ6IHVzZXIuX2lkLAogICAgICAgIGNvbmZpcm1lZDogY29uZiwKICAgICAgICB0b2tlbjogdXVpZC52MSgpCiAgICB9KTsKICAgIC8vIHdlIG5lZWQgdG8gZG8gdGhlIDJGQSBzdGVwIGZpcnN0CiAgICBpZiAoIWNvbmYpIHsKICAgICAgICB1c2VyLnNlbmRPbmVUb3VjaChmdW5jdGlvbihlcnIsIGF1dGh5UmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGNiLmNhbGwobmV3U2Vzc2lvbiwgZXJyKTsKICAgICAgICAgICAgc2F2ZShhdXRoeVJlc3BvbnNlKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gaWYgaXQncyBwcmUtY29uZmlybWVkIGp1c3Qgc2F2ZSB0aGUgc2Vzc2lvbgogICAgICAgIHNhdmUoKTsKICAgIH0KCiAgICAvLyBTYXZlIHRoZSBzZXNzaW9uIG9iamVjdAogICAgZnVuY3Rpb24gc2F2ZShhdXRoeVJlc3BvbnNlKSB7CiAgICAgICAgbmV3U2Vzc2lvbi5zYXZlKGZ1bmN0aW9uKGVyciwgZG9jKSB7CiAgICAgICAgICAgIGNiLmNhbGwobmV3U2Vzc2lvbiwgZXJyLCBkb2MsIGF1dGh5UmVzcG9uc2UpOwogICAgICAgIH0pOwogICAgfQp9OwoKLy8gR2V0IGEgdXNlciBtb2RlbCBmb3IgdGhpcyBzZXNzaW9uClNlc3Npb25TY2hlbWEubWV0aG9kcy5nZXRVc2VyID0gZnVuY3Rpb24oY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIFVzZXIuZmluZEJ5SWQoc2VsZi51c2VySWQsIGNiKTsKfTsKCi8vIEV4cG9ydCB1c2VyIG1vZGVsCnZhciBTZXNzaW9uID0gbW9uZ29vc2UubW9kZWwoJ1Nlc3Npb24nLCBTZXNzaW9uU2NoZW1hKTsKbW9kdWxlLmV4cG9ydHMgPSBTZXNzaW9uOwo=</textarea>
</div>
</div>
      <div class="saurus-overview">
        <ul></ul>
      </div>
    </div>
    <div class="saurus-code">
      <div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div>
      <div class="saurus-editor"></div>
    </div>
    <div class="saurus-explorer">
      <div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/authy2fa-node" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a>
    </div>
  </div>
</div>
</div>

      </div>
    </div>

    
    


<div class="footer" data-swiftype-index="false">
  <div class="uk-container uk-container-center">
    <div class="footer__statement">We can’t wait to see what you build.</div>
    <div class="uk-grid">
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Products</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="../../../../../voice-video.html" class="footer__link">Voice &amp; Video</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../messaging.html" class="footer__link">Messaging</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../authy.html" class="footer__link">Authentication</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../wireless.html" class="footer__link">Connected Devices</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Use Cases</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="../../../../../use-cases/access-security.html" class="footer__link">Access Security</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../use-cases/contact-center.html" class="footer__link">Contextual Call Center</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../use-cases/call-and-text-marketing.html" class="footer__link">Marketplace Communications</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../sms/use-cases.html" class="footer__link">Mobile Messaging</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">About</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="../../../../../what-is-cloud-communicationsd41d.html?" class="footer__link">What is Twilio?</a>
            </li>
            <li class="footer__list-item">
              <a href="https://customers.twilio.com/" class="footer__link">Customers</a>
            </li>
            <li class="footer__list-item">
              <a href="https://support.twilio.com/hc/en-us" class="footer__link">Get Help</a>
            </li>
            <li class="footer__list-item">
              <a href="../../../../../help/sales.html" class="footer__link">Talk to Sales</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-medium-2-5">
        <section class="footer__section">
  <header class="footer__header">Hits From The Blog</header>
  <ul class="footer__list footer__list">
    
    <li class="footer__list-item">
      <a href="../../../../../blog/2017/01/building-an-ivr-with-no-code-by-using-taskrouter-as-a-state-machine.html" class="footer__link">Building an IVR with no code by using TaskRouter as a state machine</a>
    </li>
    
    <li class="footer__list-item">
      <a href="../../../../../blog/2017/01/logrole-gives-you-permissions-based-granular-searching-for-twilio-logs.html" class="footer__link">Logrole Gives You Permissions Based, Granular Searching For Twilio Logs</a>
    </li>
    
    <li class="footer__list-item">
      <a href="../../../../../blog/2017/01/build-callbacks-with-stamplay-twilio-and-unbounce.html" class="footer__link">Build Callbacks With Stamplay, Twilio and Unbounce</a>
    </li>
    
    <li class="footer__list-item">
      <a href="../../../../../blog/2017/01/build-a-basic-call-center-in-just-a-few-minutes-with-twilio.html" class="footer__link">Build a Basic Call Center in Just a Few Minutes with Twilio</a>
    </li>
    
    <li class="footer__list-item">
      <a href="../../../../../blog/2017/01/redact-delete-sms-messages-node-js.html" class="footer__link">Redact or Delete SMS Messages as They Arrive with Node.js</a>
    </li>
    
  </ul>

</section>
      </div>
    </div>
    <footer class="footer__footer">
      <div class="footer__logo" title="Twilio">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
          <path d="M15 0C6.7 0 0 6.7 0 15s6.7 15 15 15 15-6.7 15-15S23.3 0 15 0zm0 26C8.9 26 4 21.1 4 15S8.9 4 15 4s11 4.9 11 11-4.9 11-11 11z"/>
          <circle cx="18.7" cy="11.3" r="3.1"/>
          <circle cx="18.7" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="11.3" r="3.1"/>
        </svg>
      </div>
      <ul class="legal__list">
        <li class="legal__list-item">
          <a href="../../../../../company.html" class="legal__link">About Twilio</a>
        </li>
        <li class="legal__list-item">
          <a href="../../../../../legal/tos.html" class="legal__link">Legal</a>
        </li>
        <li class="legal__list-item">Copyright &copy; 2016 Twilio, Inc. 
          <br class="uk-visible-small">All Rights Reserved.
        </li>
      </ul>
    </footer>
  </div>
</div>


    
    <script src="../../../../static/js/vendor.min.16abf41c42de.js"></script>
    

  

  <!-- Mixpanel -->
  <script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
  typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,
    e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
    mixpanel.init("f71c19735fa6ecc5225ff563285e1794");
    </script>
  

  
    <!-- Heap -->
    <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var n=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(n?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o);for(var r=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=r(p[c])};
    heap.load('1541905715');
    </script>
  

  
    <!-- GA -->
    <script type="text/javascript">
    try {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2900316-1']);
      _gaq.push(['_setSiteSpeedSampleRate', 50]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    } catch(err) {}

    var _kmq = _kmq || [];
    </script>
  

  
    <!-- Eloqua -->
    <script type="text/javascript">
    var _elqQ = _elqQ || [];
    _elqQ.push(['elqSetSiteId', '815114181']);
    _elqQ.push(['elqTrackPageView']);
    _elqQ.push(['elqUseFirstPartyCookie', 'www.twilio.com']);

    (function () {
      function async_load() {
        var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
        s.src = 'http://img03.en25.com/i/elqCfg.min.js';
        var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
      }
      if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
      else if (window.attachEvent) window.attachEvent('onload', async_load);
    })();
    </script>
  

  
    <!-- Transifex -->
    <script type="text/javascript">
    window.liveSettings = {
      api_key: '4c06c1c5a6b341e591d969476fe2675f'
    };
    </script>
    <script type="text/javascript" src="http://cdn.transifex.com/live.js"></script>
    <style>
    .txlive-langselector { display: none; }
    </style>
  

  



    
      <script src="../../../../static/js/docs.min.0c5bb1abb16f.js"></script>
    

    
    
<script type="text/javascript" src="../../../../static/js-lib/ace/ace.js"></script>
<script type="text/javascript" src="../../../../static/js-lib/ace/theme-monokai.js"></script>

<script type="text/javascript" src="../../../../static/js/walkthrough.min.js"></script>





    

  </body>

<!-- Mirrored from www.twilio.com/docs/tutorials/walkthrough/two-factor-authentication/node/express by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:02:14 GMT -->
</html>
