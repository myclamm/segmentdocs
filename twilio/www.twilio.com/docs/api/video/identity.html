


<!DOCTYPE html>
<html class="no-js">
  
<!-- Mirrored from www.twilio.com/docs/api/video/identity by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:09:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
	<!-- Optimizely -->
	<script src="https://cdn.optimizely.com/js/6082066.js"></script>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width">
    
    
    
    

    <title>
      User Identity and Access Tokens - Twilio
    </title>

    <link rel="canonical" href="https://www.twilio.com/docs/api/video/identity" />

    
    <link rel="shortcut icon" href="https://www.twilio.com/docs/static/img/favicons/favicon.db41f19ea294.ico"/>
    <link rel="apple-touch-icon" href="https://www.twilio.com/docs/static/img/favicons/favicon_57.98200b6899e6.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="https://www.twilio.com/docs/static/img/favicons/favicon_72.86ae17486256.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="https://www.twilio.com/docs/static/img/favicons/favicon_114.ee1859950ad4.png"/>

    
    <link rel="stylesheet" type="text/css" href="http://cloud.typography.com/6230892/752864/css/fonts.css">
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/font-awesome.min.295235b28b6e.css" />
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/twilio-icons.45de73e993f2.css" />
    <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/font-mfizz.818f36cb00cc.css" />

    
    
    <meta property="og:title" content="User Identity and Access Tokens">
    
    
    
    <meta property="og:url" content="https://www.twilio.com/docs/api/video/identity?utm_source=docs&utm_medium=social&utm_campaign=guides_tags">

    
    
    <meta name="twitter:title" content="User Identity and Access Tokens">
    
    
    

    
    

    

    
      <link rel="stylesheet" href="https://www.twilio.com/docs/static/css/docs.min.05ed18599e08.css" />
    

    
    

    
    <script>
  var twilio = twilio || {};
  twilio.realm = "prod";
  twilio.SWIFTYPE_ENGINE_KEY = "T68bXEBf7NaKzyRpvbnG";
</script>


<script>
  twilio.account = twilio.account || {};
  

  twilio.user = twilio.user || {};
  
  

</script>


    <script>
  
  window.userBetaFeatures = ["marketplace", "enable-video-rooms"];
</script>

  </head>

  <body class="
    
      apireference
    
    
    
  ">

    

	
	<!-- Google Tag Manager -->
	<noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-MWRD6S"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window, document, 'script', 'dataLayer', 'GTM-MWRD6S');</script>
	<!-- End Google Tag Manager -->
	



    
    <div role="drawer" class="nav__drawer">
  <div role="drawer__wrapper" class="nav__drawer-wrapper">
    <div role="drawer__nav" class="nav__drawer-nav"><span class="nav__drawer-auth"><a href="https://www.twilio.com/login" class="nav__drawer-auth-link">Log In</a><a href="https://www.twilio.com/try-twilio" class="nav__drawer-auth-link">Sign Up</a></span><a href="#close" role="drawer__close" class="nav__drawer-close">Close</a></div>
    <div class="nav__drawer-menu">
      <div class="nav__drawer-container">
        <div class="nav__drawer-grid">
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Products</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://www.twilio.com/voice-video" class="nav__drawer-link nav__drawer-link--category">Voice &amp; Video</a></li>
                  <li><a href="https://www.twilio.com/voice" class="nav__drawer-link">Programmable Voice</a></li>
                  <li><a href="https://www.twilio.com/video" class="nav__drawer-link">Programmable Video</a></li>
                  <li><a href="https://www.twilio.com/sip-trunking" class="nav__drawer-link">Elastic SIP Trunking</a></li>
                  <li><a href="https://www.twilio.com/taskrouter" class="nav__drawer-link">TaskRouter</a></li>
                  <li><a href="https://www.twilio.com/stun-turn" class="nav__drawer-link">Network Traversal</a></li>
                </ul>
                <ul>
                  <li><a href="https://www.twilio.com/messaging" class="nav__drawer-link nav__drawer-link--category">Messaging</a></li>
                  <li><a href="https://www.twilio.com/sms" class="nav__drawer-link">Programmable SMS</a></li>
                  <li><a href="https://www.twilio.com/chat" class="nav__drawer-link">Programmable Chat</a></li>
                  <li><a href="https://www.twilio.com/notify" class="nav__drawer-link">Notify</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Authentication</div>
                  </li>
                  <li><a href="https://www.twilio.com/authy" class="nav__drawer-link">Authy</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Connectivity</div>
                  </li>
                  <li><a href="https://www.twilio.com/lookup" class="nav__drawer-link">Lookup</a></li>
                  <li><a href="https://www.twilio.com/phone-numbers" class="nav__drawer-link">Phone Numbers</a></li>
                  <li><a href="https://www.twilio.com/wireless" class="nav__drawer-link">Programmable Wireless</a></li>
                  <li><a href="https://www.twilio.com/sync" class="nav__drawer-link">Sync</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Marketplace</div>
                  </li>
                  <li><a href="https://www.twilio.com/marketplace/add-ons" class="nav__drawer-link">Add-ons</a></li>
                </ul>
                <ul>
                  <li>
                    <div class="nav__drawer-link nav__drawer-link--category">Platform</div>
                  </li>
                  <li><a href="https://www.twilio.com/enterprise" class="nav__drawer-link">Enterprise Plan</a></li>
                  <li><a href="https://www.twilio.com/interconnect" class="nav__drawer-link">Interconnect</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="nav__drawer-section">
            <div role="drawer__header" class="nav__drawer-header">Use Cases</div>
            <div role="drawer__dropdown" class="nav__drawer-dropdown">
              <ul>
                <li><a href="https://www.twilio.com/use-cases/access-security" class="nav__drawer-link nav__drawer-link--category">Access Security</a></li>
                <li><a href="https://www.twilio.com/use-cases/call-and-text-marketing" class="nav__drawer-link nav__drawer-link--category">Call &amp; Text Marketing</a></li>
                <li><a href="https://www.twilio.com/use-cases/collaboration" class="nav__drawer-link nav__drawer-link--category">Collaboration</a></li>
                <li><a href="https://www.twilio.com/use-cases/commerce-communications" class="nav__drawer-link nav__drawer-link--category">Commerce Communications</a></li>
                <li><a href="https://www.twilio.com/use-cases/contact-center" class="nav__drawer-link nav__drawer-link--category">Contact Center</a></li>
              </ul>
              <hr>
            </div>
            <div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://customers.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Customer Stories</a></li>
                  <li><a href="https://www.twilio.com/showcase" class="nav__drawer-link nav__drawer-link--small">Partner Showcase</a></li>
                  <li><a href="https://www.twilio.com/what-is-cloud-communications?" class="nav__drawer-link nav__drawer-link--small">Why Twilio?</a></li>
                  <li><a href="https://www.twilio.com/support-plans" class="nav__drawer-link nav__drawer-link--small">Support Plans</a></li>
                  <li><a href="http://status.twilio.com/" class="nav__drawer-link nav__drawer-link--small">Status</a></li>
                </ul>
              </div>
              <div class="nav__drawer-column">
                <ul>
                  <li><a href="https://www.twilio.com/docs" class="nav__drawer-link nav__drawer-link--small">API &amp; Docs</a></li>
                  <li><a href="https://www.twilio.com/blog" class="nav__drawer-link nav__drawer-link--small">Blog</a></li>
                  <li><a href="https://www.twilio.com/help" class="nav__drawer-link nav__drawer-link--small">Help</a></li>
                  <li><a href="https://www.twilio.com/company/jobs" class="nav__drawer-link nav__drawer-link--small">Jobs at Twilio</a></li>
                </ul>
              </div>
            </div>
            <div class="nav__sales"><a href="https://www.twilio.com/help/sales" class="nav__sales-button">Talk to Sales</a></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div role="nav" class="nav nav--subnav nav--inverted nav--transparent " data-subnav-length="40">
  <div role="nav__menu" class="nav__header">
    <div class="nav__title"><a href="https://www.twilio.com/" class="nav__logo">Twilio</a></div>
    <nav class="nav__menu">
      <ul class="nav__menu-items">
        <li class="nav__menu-item"></li>
        
        <li class="nav__menu-item">
          <a href="https://www.twilio.com/login" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="10.2" height="13.5" viewBox="0 0 10.2 13.5">
              <circle fill="none" stroke="#F22F46" stroke-miterlimit="10" cx="5.1" cy="3" r="2.5"></circle>
              <path fill="none" stroke="#F22F46" stroke-miterlimit="10" d="M.5 13.5c0-2.5 2.1-4.6 4.6-4.6s4.6 2.1 4.6 4.6"></path>
            </svg>
            Log In
          </a>
        </li>
        <li class="nav__menu-item">
          <a href="https://www.twilio.com/try-twilio" class="nav__menu-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13">
              <path d="M0 6.5h13M6.5 0v13" fill="none" stroke="#F22F46" stroke-miterlimit="10"></path>
            </svg>
            Sign Up
          </a>
        </li>
        
        <li class="nav__menu-item"><a href="#menu" role="nav__activate" class="nav__menu-link nav__menu-activate"><span></span>Menu &amp; Products</a></li>
      </ul>
    </nav>
    <nav role="subnav" class="nav__subnav">
      <header class="nav__subnav-header">
        <a href="https://www.twilio.com/docs" class="nav__subnav-header-link">Docs</a>
        
          <a href="https://www.twilio.com/docs/api" role="subnav__dropdown" 
            class="nav__subnav-link nav__subnav-current">API Reference</a>
        
      </header>
      <ul role="subnav__items" class="nav__subnav-items">
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/quickstart" class="nav__subnav-link">Quickstart</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/guides" class="nav__subnav-link">Guides</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/tutorials" class="nav__subnav-link">Tutorials</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/api" class="nav__subnav-link">API Reference</a>
        </li>
        <li role="subnav__item" class="nav__subnav-item ">
          <a href="https://www.twilio.com/docs/libraries" class="nav__subnav-link">SDKs</a>
        </li>
      </ul>
    </nav>
  </div>
</div>



    
    
      

<div class="docs__pagenav">
  <div class="uk-container uk-container-center">
    <div class="uk-grid">
      <div class="uk-width-3-4 uk-hidden-small">
      
      
        <div class="breadcrumbs">
          
            
          
            
          
            
              <a href="https://www.twilio.com/docs/api">API Reference</a> &gt;
            
          
            
              <a href="https://www.twilio.com/docs/api/video">Programmable Video</a> &gt;
            
          
          <span>User Identity and Access Tokens</span>
        </div>
      
      </div>

      
      <div class="uk-width-1-1 uk-width-medium-1-4">
  <div class="search">
    <form action="https://www.twilio.com/docs/search" method="GET">
      <div class="wrapper">
        <input id="search-box" name="q" type="text" value=""/>
      </div>
      <button type="submit">
        <i class="fa fa-fw fa-search"></i>
      </button>
    </form>
  </div>
</div>

    </div>
  </div>
</div>

    

    <div class="docs-container">
      <div class="uk-container">
        
        
  <div class="coderail-container">

    <div class="sidenav-column">
      <div class="theme-switcher uk-hidden-small">
  <div class="theme-wrapper">
    <a data-theme="light" class="selected">
      <i class="fa fa-fw fa-sun-o"></i>
    </a>
    <a data-theme="dark" >
      <i class="fa fa-fw fa-moon-o"></i>
    </a>
  </div>
</div>
      
        <div class="sidenav" data-uk-sticky="{boundary: true}">
          

<ul id="doc_menu" class="sidenav__section" data-swiftype-index="false">

  <!-- Page entries -->
  
    <li id="dynamic-menu">
      <ul>
        
          
          



  <li 
    >
      <a href="https://www.twilio.com/docs/api/video">
          Programmable Video
      </a>
  </li>



        
          
            
<li class="menu-title expanded" role="menu-title" id="doc-navigation-parent">
  User Identity and Access Tokens
</li>
<ul class="menu-accordion expanded" role="menu-accordion" id="doc-navigation"></ul>

          
          
<li class="menu-title expanded" role="menu-title">

    <span class="heading">Usage Guide</span>
</li>


<ul class="menu-accordion expanded" role="menu-accordion">

    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/api/video/getting-started">
          Getting Started
      </a>
  </li>



    
        



  <li 
    data-beta-feature="enable-video-rooms">
      <a href="https://www.twilio.com/docs/api/video/download-video-sdks">
          Download Video SDKs
      </a>
  </li>



    
        <ul class="menu-accordion expanded">
    
        <li>
    <a href="https://www.twilio.com/docs/api/video/download-video-sdks#android-sdk" >
        Android

        
    </a>
</li>

    
        <li>
    <a href="https://www.twilio.com/docs/api/video/download-video-sdks#ios-sdk" >
        iOS

        
    </a>
</li>

    
        <li>
    <a href="https://www.twilio.com/docs/api/video/download-video-sdks#javascript-sdk" >
        JavaScript

        
    </a>
</li>

    
</ul>
    
        



  <li 
    data-beta-feature="enable-video-rooms">
      <a href="https://www.twilio.com/docs/api/video/quickstart-sample-apps">
          Sample Applications
      </a>
  </li>



    
        



  <li class="active"
    >
      <a href="https://www.twilio.com/docs/api/video/identity">
          User Identity and Access Tokens
      </a>
  </li>



    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/api/video/rooms">
          Working with Rooms
      </a>
  </li>



    
</ul>

        
          
          
<li class="menu-title" role="menu-title">

    <span class="heading">API Reference</span>
</li>


<ul class="menu-accordion" role="menu-accordion">

    
        <li>
    <a href="https://media.twiliocdn.com/sdk/android/video/latest/docs" target="_blank">
        Android

        
            <i class="fa fa-external-link"></i>
        
    </a>
</li>

    
        <li>
    <a href="https://media.twiliocdn.com/sdk/ios/video/latest/docs" target="_blank">
        iOS

        
            <i class="fa fa-external-link"></i>
        
    </a>
</li>

    
        <li>
    <a href="https://media.twiliocdn.com/sdk/js/video/releases/1.0.0-beta3/docs/" target="_blank">
        JavaScript

        
            <i class="fa fa-external-link"></i>
        
    </a>
</li>

    
</ul>

        
          
          
<li class="menu-title" role="menu-title">

    <span class="heading">Changelogs</span>
</li>


<ul class="menu-accordion" role="menu-accordion">

    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/api/video/changelogs/android">
          Android
      </a>
  </li>



    
        



  <li 
    >
      <a href="https://www.twilio.com/docs/api/video/changelogs/ios">
          iOS
      </a>
  </li>



    
        <li>
    <a href="https://github.com/twilio/twilio-conversations.js/blob/master/CHANGELOG.md" target="_blank">
        Javascript

        
            <i class="fa fa-external-link"></i>
        
    </a>
</li>

    
</ul>

        
          
          



  <li 
    data-beta-feature="video.conversations.doc">
      <a href="https://www.twilio.com/docs/api/video/conversations-api-deprecated">
          Conversations API (Deprecated)
      </a>
  </li>



        
        
      </ul>
    </li>
  
</ul>

        </div>
      
    </div>

    <div class="primary-column 
        ">
      <div class="docs-prose">
        
  
    
    <h1 class="page-title ">
      User Identity and Access Tokens
    </h1>
    
  
  
    <div class="block-markdown ">
      
        

<div>
    <p>In your Video application, you will be responsible for two components:</p>
<ul>
<li>A Video Client (a Web, iOS, or Android app) that users interact with.</li>
<li>A server that vouches for the identity of your users by providing <a href="https://www.twilio.com/docs/api/rest/access-tokens">Access Tokens</a> 
(<a href="http://jwt.io/">in JWT format</a>) to your Clients.</li>
</ul>
<p>This guide will show you how these two pieces work together in your application.</p>
<h2 id="client-request-an-access-token"><a class="toclink" href="#client-request-an-access-token">Client: Request an Access Token <a id="request-token"></a></a></h2>
<p>When a user in their browser or on their mobile device wants to start video
calling, Twilio can't trust them right away. This is the Internet after all.
Twilio needs you to vouch for your users by signing a token; we treat anyone
posessing a signed, valid, non-revoked token as a trusted actor for some aspect
of your Twilio account. This mechanism also allows you to provide granular
permissions.</p>
<p>In our pre-built quickstart apps, the client requests an Access Token from the
server like so:</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-token-generation" 
  data-title="Token Generation" data-pref="mobile">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-token-generation">Token Generation</a>
        <ul>
          
            <li class="sample-tab active" 
              data-ext="java">Java</li>
          
            <li class="sample-tab " 
              data-ext="js">JavaScript</li>
          
            <li class="sample-tab " 
              data-ext="m">Objective-C</li>
          
            <li class="sample-tab " 
              data-ext="swift">Swift</li>
          
        </ul>
      </div>

      
        
      
        
      
        
      
        
      
          
      
        <pre data-ext="java" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Import necessary dependencies</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.JsonObject</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.koushikdutta.async.future.FutureCallback</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.koushikdutta.ion.Ion</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="o">...</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">retrieveAccessTokenfromServer</span><span class="o">()</span> <span class="o">{</span>
</span><span class="code-line">        <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class="code-line">            <span class="c1">// Make JSON request to server</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;http://localhost:8080/token.php&quot;</span><span class="o">)</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class="code-line">                <span class="nd">@Override</span>
</span><span class="code-line">                <span class="c1">// Handle response from server</span>
</span><span class="code-line">                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">JsonObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">                    <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">                        <span class="c1">// The identity can be used to receive calls</span>
</span><span class="code-line">                        <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">).</span><span class="na">getAsString</span><span class="o">();</span>
</span><span class="code-line">                        <span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">).</span><span class="na">getAsString</span><span class="o">();</span>
</span><span class="code-line">                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Token found: &quot;</span> <span class="o">+</span> <span class="n">accessToken</span><span class="o">);</span>
</span><span class="code-line">                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="code-line">                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Error fetching token from server&quot;</span><span class="o">);</span>
</span><span class="code-line">                    <span class="o">}</span>
</span><span class="code-line">                <span class="o">}</span>
</span><span class="code-line">            <span class="o">});</span>
</span><span class="code-line">    <span class="o">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="o">...</span>
</span></code></pre>
      
        <pre data-ext="js" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// We use jQuery to make an Ajax request to the server to retrieve our </span>
</span><span class="code-line"><span class="c1">// Access Token</span>
</span><span class="code-line"><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="c1">// The data sent back from the server should contain a long string - this is</span>
</span><span class="code-line">    <span class="c1">// the JWT token you need to initialize the SDK. Read more about JWT </span>
</span><span class="code-line">    <span class="c1">// (JSON Web Token) at http://jwt.io</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Since the quickstart app doesn&#39;t implement authentication, the server</span>
</span><span class="code-line">    <span class="c1">// sends back a randomly generated username for the current client, which is</span>
</span><span class="code-line">    <span class="c1">// how they will be identified when sending and receiving Conversation</span>
</span><span class="code-line">    <span class="c1">// invites. If your app has an existing authentication system, you can use</span>
</span><span class="code-line">    <span class="c1">// the e-mail address or username that uniquely identifies a user instead.</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
      
        <pre data-ext="m" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Token server endpoint URL</span>
</span><span class="code-line"><span class="bp">NSURL</span> <span class="o">*</span><span class="n">tokenURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://localhost:8000/token.php&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line"><span class="bp">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">sessionConfig</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">];</span>
</span><span class="code-line"><span class="bp">NSURLSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSession</span> <span class="nl">sessionWithConfiguration</span><span class="p">:</span><span class="n">sessionConfig</span><span class="p">];</span>
</span><span class="code-line"><span class="bp">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="p">[</span><span class="n">session</span> <span class="nl">dataTaskWithURL</span><span class="p">:</span><span class="n">tokenURL</span>
</span><span class="code-line">                                <span class="nl">completionHandler</span><span class="p">:</span> <span class="o">^</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">data</span><span class="p">,</span>
</span><span class="code-line">                                                      <span class="bp">NSURLResponse</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">response</span><span class="p">,</span>
</span><span class="code-line">                                                      <span class="bp">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                    <span class="bp">NSError</span> <span class="o">*</span><span class="n">err</span> <span class="o">=</span> <span class="n">error</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="bp">NSString</span> <span class="o">*</span><span class="n">accessToken</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="bp">NSString</span> <span class="o">*</span><span class="n">identity</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                            <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">json</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSJSONSerialization</span> <span class="nl">JSONObjectWithData</span><span class="p">:</span><span class="n">data</span>
</span><span class="code-line">                                                                                                  <span class="nl">options</span><span class="p">:</span><span class="mi">0</span>
</span><span class="code-line">                                                                                                    <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">err</span><span class="p">];</span>
</span><span class="code-line">                                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                                <span class="n">accessToken</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@&quot;token&quot;</span><span class="p">];</span>
</span><span class="code-line">                                                <span class="n">identity</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@&quot;identity&quot;</span><span class="p">];</span>
</span><span class="code-line">                                                <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Logged in as %@&quot;</span><span class="p">,</span><span class="n">identity</span><span class="p">);</span>
</span><span class="code-line">                                            <span class="p">}</span>
</span><span class="code-line">                                        <span class="p">}</span>
</span><span class="code-line">                                    <span class="p">}</span>
</span><span class="code-line">                                    <span class="n">completionHandler</span><span class="p">(</span><span class="n">accessToken</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
</span><span class="code-line">                                <span class="p">}];</span>
</span><span class="code-line"><span class="p">[</span><span class="n">task</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre>
      
        <pre data-ext="swift" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Token server endpoint URL</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">urlString</span> <span class="p">=</span> <span class="s">&quot;http://localhost:8000/token.php&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Get JSON from server</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">config</span> <span class="p">=</span> <span class="bp">NSURLSessionConfiguration</span><span class="p">.</span><span class="n">defaultSessionConfiguration</span><span class="p">()</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">session</span> <span class="p">=</span> <span class="bp">NSURLSession</span><span class="p">(</span><span class="n">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> <span class="n">delegate</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">delegateQueue</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="bp">NSURL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">urlString</span><span class="p">)</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">request</span>  <span class="p">=</span> <span class="bp">NSMutableURLRequest</span><span class="p">(</span><span class="n">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">!)</span>
</span><span class="code-line"><span class="n">request</span><span class="p">.</span><span class="n">HTTPMethod</span> <span class="p">=</span> <span class="s">&quot;GET&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Make HTTP request</span>
</span><span class="code-line"><span class="n">session</span><span class="p">.</span><span class="n">dataTaskWithRequest</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
</span><span class="code-line">  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="c1">// Parse result JSON</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">json</span> <span class="p">=</span> <span class="n">JSON</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">!)</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">token</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;token&quot;</span><span class="p">].</span><span class="n">stringValue</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">identity</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;identity&quot;</span><span class="p">].</span><span class="n">stringValue</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">}).</span><span class="n">resume</span><span class="p">()</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Token Generation
    </h5>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <p>Now that our app is ready to retrieve an Access Token from our server, we need
to implement the server component of the project.</p>
<h2 id="server-create-an-access-token"><a class="toclink" href="#server-create-an-access-token">Server: Create an Access Token <a id="create-token"></a></a></h2>
<p>On your server you must decide, based on the token request that was sent to you,
<em>who the user is</em> and <em>what they should be allowed to do</em>.</p>
<p>To figure out who the user is (their <strong>identity</strong>), you might use your existing
authentication system (using session cookies, an API token, or whatever
mechanism you use to secure your content today). You might not care who a user
is at all, and assign them a temporary identity as in our <a href="https://www.twilio.com/docs/api/video/quickstart-sample-apps">quickstart apps</a>. 
Who the user is and how you determine their capabilities will
vary from app to app.</p>
<p>If you determine that the user should indeed be allowed to access your Video
application, you must grant the user access to Video and configure an
<strong>identity</strong>. Here's how we generate those tokens in our <a href="https://www.twilio.com/docs/api/video/quickstart-sample-apps">quickstart apps
</a>.</p>
<p>The following code samples utilize the server-side <a href="https://www.twilio.com/docs/libraries">Twilio Helper
Libraries</a>. For details on the access token format, see the <a href="https://www.twilio.com/docs/api/rest/access-tokens">Access Token documentation</a>.</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-server-token-generation" 
  data-title="Server Token Generation" data-pref="server">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-server-token-generation">Server Token Generation</a>
        <ul>
          
            <li class="sample-tab active" 
              data-ext="cs">C#</li>
          
            <li class="sample-tab " 
              data-ext="java">Java</li>
          
            <li class="sample-tab " 
              data-ext="js">Node.js</li>
          
            <li class="sample-tab " 
              data-ext="php">PHP</li>
          
            <li class="sample-tab " 
              data-ext="py">Python</li>
          
            <li class="sample-tab " 
              data-ext="rb">Ruby</li>
          
        </ul>
      </div>

      
        
          <div class="sample-version-tabs" data-ext="cs">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="4.x"
                  
                  
                  >4.x</li>
              
                <li class="sample-version-tab" data-version="5.x"
                  
                  
                  >5.x</li>
              
            </ul>
          </div>
        
      
        
          <div class="sample-version-tabs" data-ext="java">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="6.x"
                  
                  
                  >6.x</li>
              
                <li class="sample-version-tab" data-version="7.x"
                  
                  data-default-version
                  >7.x</li>
              
            </ul>
          </div>
        
      
        
          <div class="sample-version-tabs" data-ext="js">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="2.x"
                  
                  
                  >2.x</li>
              
                <li class="sample-version-tab" data-version="3.x"
                  
                  
                  >3.x</li>
              
            </ul>
          </div>
        
      
        
          <div class="sample-version-tabs" data-ext="php">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="4.x"
                  
                  
                  >4.x</li>
              
                <li class="sample-version-tab" data-version="5.x"
                  data-default-version
                  
                  >5.x</li>
              
            </ul>
          </div>
        
      
        
          <div class="sample-version-tabs" data-ext="py">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="5.x"
                  
                  
                  >5.x</li>
              
                <li class="sample-version-tab" data-version="6.x"
                  
                  
                  >6.x</li>
              
            </ul>
          </div>
        
      
        
          <div class="sample-version-tabs" data-ext="rb">
            
            <span>SDK Version:</span>
            
            <ul>
              
                <li class="sample-version-tab" data-version="4.x"
                  
                  
                  >4.x</li>
              
                <li class="sample-version-tab" data-version="5.x"
                  
                  
                  >5.x</li>
              
            </ul>
          </div>
        
      
          
      
        <pre data-ext="java" data-version="6.x" class="codehilite"><code><span class="code-line"><span class="kn">package</span> <span class="nn">com.twilio</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">staticFileLocation</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.github.javafaker.Faker</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.sdk.auth.AccessToken</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.sdk.auth.ConversationsGrant</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Webapp</span> <span class="o">{</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">    <span class="c1">// Serve static files from src/main/resources/public</span>
</span><span class="code-line">    <span class="n">staticFileLocation</span><span class="o">(</span><span class="s">&quot;/public&quot;</span><span class="o">);</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create a Faker instance to generate a random username for the connecting user</span>
</span><span class="code-line">    <span class="n">Faker</span> <span class="n">faker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="o">();</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create an access token using our Twilio credentials</span>
</span><span class="code-line">    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/token&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class="code-line">      <span class="c1">// Generate a random username for the connecting client</span>
</span><span class="code-line">      <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="na">firstName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">lastName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">zipCode</span><span class="o">();</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// Create Twilio Video messaging grant</span>
</span><span class="code-line">      <span class="n">ConversationsGrant</span> <span class="n">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="o">();</span>
</span><span class="code-line">      <span class="n">grant</span><span class="o">.</span><span class="na">configurationProfileSid</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_CONFIGURATION_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// Create access token</span>
</span><span class="code-line">      <span class="n">AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_ACCOUNT_SID&quot;</span><span class="o">),</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_KEY&quot;</span><span class="o">),</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_SECRET&quot;</span><span class="o">)</span>
</span><span class="code-line">      <span class="o">).</span><span class="na">identity</span><span class="o">(</span><span class="n">identity</span><span class="o">).</span><span class="na">grant</span><span class="o">(</span><span class="n">grant</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// create JSON response payload </span>
</span><span class="code-line">      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">,</span> <span class="n">identity</span><span class="o">);</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">toJWT</span><span class="o">());</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Render JSON response</span>
</span><span class="code-line">      <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span><span class="code-line">      <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
</span><span class="code-line">    <span class="o">});</span>
</span><span class="code-line">  <span class="o">}</span>
</span><span class="code-line"><span class="o">}</span>
</span></code></pre>
      
        <pre data-ext="py" data-version="6.x" class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">os</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">twilio.jwt.access_token</span> <span class="kn">import</span> <span class="n">AccessToken</span><span class="p">,</span> <span class="n">ConversationsGrant</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class="code-line"><span class="n">fake</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">send_static_file</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">token</span><span class="p">():</span>
</span><span class="code-line">    <span class="c1"># get credentials for environment variables</span>
</span><span class="code-line">    <span class="n">account_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="p">]</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Create an Access Token</span>
</span><span class="code-line">    <span class="n">token</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">account_sid</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Set the Identity of this token</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">user_name</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">    <span class="n">grant</span> <span class="o">=</span> <span class="n">ConversationsGrant</span><span class="p">()</span>
</span><span class="code-line">    <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span><span class="p">(</span><span class="n">grant</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Return token info as JSON</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span><span class="p">())</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="code-line">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre>
      
        <pre data-ext="js" data-version="3.x" class="codehilite"><code><span class="code-line"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kr">const</span> <span class="nx">AccessToken</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;twilio&#39;</span><span class="p">).</span><span class="nx">AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">ConversationsGrant</span> <span class="o">=</span> <span class="nx">AccessToken</span><span class="p">.</span><span class="nx">ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">randomUsername</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./randos&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create Express webapp</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Create an access token which we will sign and return to the client,</span>
</span><span class="code-line">  <span class="c1">// containing the grant we just created</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_SECRET</span>
</span><span class="code-line">  <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Assign the generated identity to the token.</span>
</span><span class="code-line">  <span class="nx">token</span><span class="p">.</span><span class="nx">identity</span> <span class="o">=</span> <span class="nx">identity</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Grant the access token Twilio Video capabilities.</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">  <span class="nx">grant</span><span class="p">.</span><span class="nx">configurationProfileSid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_CONFIGURATION_SID</span><span class="p">;</span>
</span><span class="code-line">  <span class="nx">token</span><span class="p">.</span><span class="nx">addGrant</span><span class="p">(</span><span class="nx">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Serialize the token to a JWT string and include it in a JSON response</span>
</span><span class="code-line">  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class="code-line">    <span class="nx">identity</span><span class="o">:</span> <span class="nx">identity</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">toJwt</span><span class="p">(),</span>
</span><span class="code-line">  <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create http server and run it</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Express server running on *:&#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
      
        <pre data-ext="cs" data-version="5.x" class="codehilite"><code><span class="code-line"><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Faker</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio.JWT</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nn">VideoQuickstart.Controllers</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">class</span> <span class="nc">TokenController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">        <span class="c1">// GET: Token</span>
</span><span class="code-line">        <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">device</span><span class="p">)</span>
</span><span class="code-line">        <span class="p">{</span>
</span><span class="code-line">            <span class="c1">// Load Twilio configuration from Web.config</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">accountSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioAccountSid&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiKey</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiKey&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiSecret</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiSecret&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a random identity for the client</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">identity</span> <span class="p">=</span> <span class="n">Internet</span><span class="p">.</span><span class="n">UserName</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create an Access Token generator</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">accountSid</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">,</span> <span class="n">apiSecret</span><span class="p">)</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">Identity</span> <span class="p">=</span> <span class="n">identity</span>
</span><span class="code-line">            <span class="p">};</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a video grant for this token</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">grant</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">AddGrant</span><span class="p">(</span><span class="n">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">identity</span><span class="p">,</span>
</span><span class="code-line">                <span class="n">token</span> <span class="p">=</span> <span class="n">token</span><span class="p">.</span><span class="n">ToJwt</span><span class="p">()</span>
</span><span class="code-line">            <span class="p">},</span> <span class="n">JsonRequestBehavior</span><span class="p">.</span><span class="n">AllowGet</span><span class="p">);</span>
</span><span class="code-line">        <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
      
        <pre data-ext="php" data-version="5.x" class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line"><span class="c1">// Get the PHP helper library from twilio.com/docs/php/install</span>
</span><span class="code-line"><span class="k">require_once</span> <span class="s1">&#39;/path/to/vendor/autoload.php&#39;</span><span class="p">;</span> <span class="c1">// Loads the library</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Jwt\AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Jwt\Grants\ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Required for all Twilio access tokens</span>
</span><span class="code-line"><span class="nv">$twilioAccountSid</span> <span class="o">=</span> <span class="s1">&#39;ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$twilioApiKey</span> <span class="o">=</span> <span class="s1">&#39;SKXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$twilioApiSecret</span> <span class="o">=</span> <span class="s1">&#39;your_api_secret&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$TwilioConfigurationSid</span> <span class="o">=</span> <span class="s1">&#39;VSXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="c1">// choose a random username for the connecting user</span>
</span><span class="code-line"><span class="nv">$identity</span> <span class="o">=</span> <span class="s1">&#39;randomUsername&#39;</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create access token, which we will serialize and send to the client</span>
</span><span class="code-line"><span class="nv">$token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nv">$TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_SECRET</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$identity</span>
</span><span class="code-line"><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Grant access to Twilio Video</span>
</span><span class="code-line"><span class="nv">$grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line"><span class="nv">$grant</span><span class="o">-&gt;</span><span class="na">setConfigurationProfileSid</span><span class="p">(</span><span class="nv">$TwilioConfigurationSid</span><span class="p">);</span>
</span><span class="code-line"><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">addGrant</span><span class="p">(</span><span class="nv">$grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// return serialized token and the user&#39;s randomly generated ID</span>
</span><span class="code-line"><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span>
</span><span class="code-line">    <span class="k">array</span><span class="p">(</span>
</span><span class="code-line">        <span class="s1">&#39;identity&#39;</span> <span class="o">=&gt;</span> <span class="nv">$identity</span><span class="p">,</span>
</span><span class="code-line">        <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">toJWT</span><span class="p">(),</span>
</span><span class="code-line">    <span class="p">)</span>
</span><span class="code-line"><span class="p">);</span>
</span></code></pre>
      
        <pre data-ext="py" data-version="5.x" class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">os</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">twilio.access_token</span> <span class="kn">import</span> <span class="n">AccessToken</span><span class="p">,</span> <span class="n">ConversationsGrant</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class="code-line"><span class="n">fake</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">send_static_file</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">token</span><span class="p">():</span>
</span><span class="code-line">    <span class="c1"># get credentials for environment variables</span>
</span><span class="code-line">    <span class="n">account_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="p">]</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Create an Access Token</span>
</span><span class="code-line">    <span class="n">token</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">account_sid</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Set the Identity of this token</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">user_name</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">    <span class="n">grant</span> <span class="o">=</span> <span class="n">ConversationsGrant</span><span class="p">()</span>
</span><span class="code-line">    <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span><span class="p">(</span><span class="n">grant</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Return token info as JSON</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span><span class="p">())</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="code-line">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre>
      
        <pre data-ext="rb" data-version="5.x" class="codehilite"><code><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;twilio-ruby&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra/json&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;dotenv&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;faker&#39;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Load environment configuration</span>
</span><span class="code-line"><span class="no">Dotenv</span><span class="o">.</span><span class="n">load</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Render home page</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">))</span>
</span><span class="code-line"><span class="k">end</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Generate a token for use in our Video application</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/token&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="c1"># Create a random username for the client</span>
</span><span class="code-line">  <span class="n">identity</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="o">.</span><span class="n">user_name</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Create an Access Token for Video usage</span>
</span><span class="code-line">  <span class="n">token</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="n">identity</span>
</span><span class="code-line">  <span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">  <span class="n">grant</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">::</span><span class="no">ConversationsGrant</span><span class="o">.</span><span class="n">new</span>
</span><span class="code-line">  <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="o">]</span>
</span><span class="code-line">  <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span> <span class="n">grant</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Generate the token and send to client</span>
</span><span class="code-line">  <span class="n">json</span> <span class="ss">identity</span><span class="p">:</span> <span class="n">identity</span><span class="p">,</span> <span class="ss">token</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span>
</span><span class="code-line"><span class="k">end</span>
</span></code></pre>
      
        <pre data-ext="java" data-version="7.x" class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">staticFileLocation</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.github.javafaker.Faker</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.jwt.accesstoken.AccessToken</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.jwt.accesstoken.ConversationsGrant</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Webapp</span> <span class="o">{</span>
</span><span class="code-line">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">    <span class="c1">// Serve static files from src/main/resources/public</span>
</span><span class="code-line">    <span class="n">staticFileLocation</span><span class="o">(</span><span class="s">&quot;/public&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="n">String</span> <span class="n">ACCOUNT_SID</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_ACCOUNT_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">    <span class="n">String</span> <span class="n">API_KEY</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_KEY&quot;</span><span class="o">);</span>
</span><span class="code-line">    <span class="n">String</span> <span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_SECRET&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="n">String</span> <span class="n">TWILIO_CONFIGURATION_SID</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_CONFIGURATION_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Create a Faker instance to generate a random username for the connecting user</span>
</span><span class="code-line">    <span class="n">Faker</span> <span class="n">faker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Create an access token using our Twilio credentials</span>
</span><span class="code-line">    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/token&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class="code-line">      <span class="c1">// Generate a random username for the connecting client</span>
</span><span class="code-line">      <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span>
</span><span class="code-line">          <span class="n">faker</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">firstName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">lastName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">address</span><span class="o">().</span><span class="na">zipCode</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Create Twilio Video grant</span>
</span><span class="code-line">      <span class="n">ConversationsGrant</span> <span class="n">grant</span> <span class="o">=</span>
</span><span class="code-line">          <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="o">().</span><span class="na">setConfigurationProfileSid</span><span class="o">(</span><span class="n">TWILIO_CONFIGURATION_SID</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Create access token</span>
</span><span class="code-line">      <span class="n">AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">ACCOUNT_SID</span><span class="o">,</span> <span class="n">API_KEY</span><span class="o">,</span> <span class="n">API_SECRET</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">identity</span><span class="o">(</span><span class="n">identity</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">grant</span><span class="o">(</span><span class="n">grant</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// create JSON response payload</span>
</span><span class="code-line">      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">,</span> <span class="n">identity</span><span class="o">);</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">toJwt</span><span class="o">());</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Render JSON response</span>
</span><span class="code-line">      <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span><span class="code-line">      <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
</span><span class="code-line">    <span class="o">});</span>
</span><span class="code-line">  <span class="o">}</span>
</span><span class="code-line"><span class="o">}</span>
</span></code></pre>
      
        <pre data-ext="js" data-version="2.x" class="codehilite"><code><span class="code-line"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">AccessToken</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;twilio&#39;</span><span class="p">).</span><span class="nx">AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">ConversationsGrant</span> <span class="o">=</span> <span class="nx">AccessToken</span><span class="p">.</span><span class="nx">ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">randomUsername</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./randos&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create Express webapp</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create an access token which we will sign and return to the client,</span>
</span><span class="code-line">    <span class="c1">// containing the grant we just created</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_SECRET</span>
</span><span class="code-line">    <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">//assign the generated identity to the token</span>
</span><span class="code-line">    <span class="nx">token</span><span class="p">.</span><span class="nx">identity</span> <span class="o">=</span> <span class="nx">identity</span><span class="p">;</span>
</span><span class="code-line">        
</span><span class="code-line">    <span class="c1">//grant the access token Twilio Video capabilities</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">    <span class="nx">grant</span><span class="p">.</span><span class="nx">configurationProfileSid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_CONFIGURATION_SID</span><span class="p">;</span>
</span><span class="code-line">    <span class="nx">token</span><span class="p">.</span><span class="nx">addGrant</span><span class="p">(</span><span class="nx">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Serialize the token to a JWT string and include it in a JSON response</span>
</span><span class="code-line">    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class="code-line">        <span class="nx">identity</span><span class="o">:</span> <span class="nx">identity</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">toJwt</span><span class="p">()</span>
</span><span class="code-line">    <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create http server and run it</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>
</span><span class="code-line"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Express server running on *:&#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
      
        <pre data-ext="cs" data-version="4.x" class="codehilite"><code><span class="code-line"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio.Auth</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">JWT</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Faker</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nn">VideoQuickstart.Controllers</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">class</span> <span class="nc">TokenController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">        <span class="c1">// GET: /token</span>
</span><span class="code-line">        <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">Device</span><span class="p">)</span>
</span><span class="code-line">        <span class="p">{</span>
</span><span class="code-line">            <span class="c1">// Load Twilio configuration from Web.config</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">accountSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioAccountSid&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiKey</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiKey&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiSecret</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiSecret&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">videoConfigSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioConfigurationSid&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a random identity for the client</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">identity</span> <span class="p">=</span> <span class="n">Internet</span><span class="p">.</span><span class="n">UserName</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create an Access Token generator</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">accountSid</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">,</span> <span class="n">apiSecret</span><span class="p">);</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">Identity</span> <span class="p">=</span> <span class="n">identity</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a video grant for this token</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">grant</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">AddGrant</span><span class="p">(</span><span class="n">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">identity</span> <span class="p">=</span> <span class="n">identity</span><span class="p">,</span>
</span><span class="code-line">                <span class="n">token</span> <span class="p">=</span> <span class="n">token</span><span class="p">.</span><span class="n">ToJWT</span><span class="p">()</span>
</span><span class="code-line">            <span class="p">},</span> <span class="n">JsonRequestBehavior</span><span class="p">.</span><span class="n">AllowGet</span><span class="p">);</span>
</span><span class="code-line">        <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
      
        <pre data-ext="php" data-version="4.x" class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./twilio-php/Services/Twilio.php&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./randos.php&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./config.php&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// choose a random username for the connecting user</span>
</span><span class="code-line"><span class="nv">$identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create access token, which we will serialize and send to the client</span>
</span><span class="code-line"><span class="nv">$token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Services_Twilio_AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nv">$TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_SECRET</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$identity</span>
</span><span class="code-line"><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Grant access to Twilio Video</span>
</span><span class="code-line"><span class="nv">$grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Services_Twilio_Auth_ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line"><span class="nv">$grant</span><span class="o">-&gt;</span><span class="na">setConfigurationProfileSid</span><span class="p">(</span><span class="nv">$TWILIO_CONFIGURATION_SID</span><span class="p">);</span>
</span><span class="code-line"><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">addGrant</span><span class="p">(</span><span class="nv">$grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// return serialized token and the user&#39;s randomly generated ID</span>
</span><span class="code-line"><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class="code-line">    <span class="s1">&#39;identity&#39;</span> <span class="o">=&gt;</span> <span class="nv">$identity</span><span class="p">,</span>
</span><span class="code-line">    <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">toJWT</span><span class="p">(),</span>
</span><span class="code-line"><span class="p">));</span>
</span></code></pre>
      
        <pre data-ext="rb" data-version="4.x" class="codehilite"><code><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;twilio-ruby&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra/json&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;dotenv&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;faker&#39;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Load environment configuration</span>
</span><span class="code-line"><span class="no">Dotenv</span><span class="o">.</span><span class="n">load</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Render home page</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">))</span>
</span><span class="code-line"><span class="k">end</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Generate a token for use in our Video application</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/token&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="c1"># Create a random username for the client</span>
</span><span class="code-line">  <span class="n">identity</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="o">.</span><span class="n">user_name</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Create an Access Token for Video usage</span>
</span><span class="code-line">  <span class="n">token</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">.</span><span class="n">new</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="o">]</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">identity</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">  <span class="n">grant</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">::</span><span class="no">ConversationsGrant</span><span class="o">.</span><span class="n">new</span>
</span><span class="code-line">  <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="o">]</span>
</span><span class="code-line">  <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span> <span class="n">grant</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Generate the token and send to client</span>
</span><span class="code-line">  <span class="n">json</span> <span class="ss">:identity</span> <span class="o">=&gt;</span> <span class="n">identity</span><span class="p">,</span> <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span>
</span><span class="code-line"><span class="k">end</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Server Token Generation
    </h5>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <p>Once your client receives an Access Token from your server, you can initialize
the Twilio Video SDK and start joining Rooms.</p>
<h2 id="client-initialize-the-sdk-with-an-access-token"><a class="toclink" href="#client-initialize-the-sdk-with-an-access-token">Client: Initialize the SDK with an Access Token <a id="init-sdk"></a></a></h2>
<p>Access Token in tow, we can now initialize the Video SDK on the client and start
doing fun stuff.</p>
</div>

      
    </div>
  
    <div class="block-code_sample ">
      
        

<div class="md-code-sample" id="code-client-initialization" 
  data-title="Client Initialization" data-pref="mobile">

  <div class="inline-mode">
    <div class="code-snippets">
      <div class="sample-tabs">
      <a class="title" href="#code-client-initialization">Client Initialization</a>
        <ul>
          
            <li class="sample-tab active" 
              data-ext="java">Java</li>
          
            <li class="sample-tab " 
              data-ext="js">JavaScript</li>
          
            <li class="sample-tab " 
              data-ext="m">Objective-C</li>
          
            <li class="sample-tab " 
              data-ext="swift">Swift</li>
          
        </ul>
      </div>

      
        
      
        
      
        
      
        
      
          
      
        <pre data-ext="java" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="n">VideoClient</span> <span class="n">videoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VideoClient</span><span class="o">(</span><span class="n">VideoActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Connect to a room</span>
</span><span class="code-line"><span class="n">ConnectOptions</span> <span class="n">connectOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">roomName</span><span class="o">(</span><span class="s">&quot;my-room&quot;</span><span class="o">)</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">localMedia</span><span class="o">(</span><span class="n">localMedia</span><span class="o">)</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line"><span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">videoClient</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">connectOptions</span><span class="o">,</span> <span class="n">roomListener</span><span class="o">());</span>
</span></code></pre>
      
        <pre data-ext="js" data-version="default" class="codehilite"><code><span class="code-line"><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Create a Video Client and connect to Twilio&#39;s backend</span>
</span><span class="code-line">  <span class="kd">var</span> <span class="nx">videoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twilio</span><span class="p">.</span><span class="nx">Video</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span class="code-line">  <span class="nx">videoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span> <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;my-room&#39;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to Twilio!&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Could not connect to Twilio: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
      
        <pre data-ext="m" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="n">TVIVideoClient</span> <span class="o">*</span><span class="n">videoClient</span> <span class="o">=</span> <span class="p">[</span><span class="n">TVIVideoClient</span> <span class="nl">clientWithToken</span><span class="p">:</span><span class="n">accessToken</span><span class="p">];</span>
</span><span class="code-line"><span class="nb">self</span><span class="p">.</span><span class="n">videoClient</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Join a room </span>
</span><span class="code-line"><span class="n">TVIConnectOptions</span> <span class="o">*</span><span class="n">connectOptions</span> <span class="o">=</span> <span class="p">[</span><span class="n">TVIConnectOptions</span> <span class="nl">optionsWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">TVIConnectOptionsBuilder</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">  <span class="n">builder</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">@&quot;my-room&quot;</span><span class="p">;</span>
</span><span class="code-line"><span class="p">}];</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">TVIRoom</span> <span class="o">*</span><span class="n">room</span> <span class="o">=</span> <span class="p">[</span><span class="n">videoClient</span> <span class="nl">connectWithOptions</span><span class="p">:</span><span class="n">connectOptions</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
</span></code></pre>
      
        <pre data-ext="swift" data-version="default" class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nv">client</span> <span class="p">=</span> <span class="n">TVIVideoClient</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">accessToken</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Connect to a room</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">connectOptions</span> <span class="p">=</span> <span class="n">TVIConnectOptions</span> <span class="p">{</span> <span class="p">(</span><span class="n">builder</span><span class="p">)</span> <span class="k">in</span>
</span><span class="code-line">    <span class="n">builder</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&quot;my-room&quot;</span>
</span><span class="code-line"><span class="p">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="kd">let</span> <span class="nv">client</span> <span class="p">=</span> <span class="n">client</span> <span class="p">{</span>
</span><span class="code-line">    <span class="n">room</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">connectOptions</span><span class="p">,</span> <span class="n">delegate</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
      
    </div>

    
  </div>

  <div class="button-mode">
    <h5 class="title">
      <i class="fa fa-fw fa-code"></i>
      Client Initialization
    </h5>
    
    <div class="active-tail"></div>
  </div>
</div>



      
    </div>
  
    <div class="block-markdown ">
      
        

<div>
    <p>After you've initialized the client, you can access all of the SDK's features.</p>
</div>

      
    </div>
  

    

        
          
<div id="disqus_thread"></div>


<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

// Unique identifiers
PAGE_URL = "https://www.twilio.com/docs/api/video/identity";

var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'http://twiliodocumentation.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


        
      </div>
    </div>

    <div class="code-column">
      
  <div id="coderail" class="code-rail" data-uk-sticky="{boundary: true}">

  <div class="rail-placeholder"></div>

  <div class="rail-header uk-hidden">

    <div class="rail-header-wrapper">

      <div class="rail-navigation">
        <div class="inner">
          <a href="#previous" class="inactive" data-previous>
            <i class="fa fa-fw fa-arrow-left left"></i>
          </a>
        </div>
        <div class="inner">
          <span>
            <span class="current-index">1</span>
            <span>/</span>
            <span class="snippet-total">1</span>
          </span>
        </div>
        <div class="inner">
          <a href="#next" data-next>
            <i class="fa fa-fw fa-arrow-right"></i>
          </a>
        </div>
      </div>

      <div class="rail-title">
        <div class="title-content inner">
          <span>Loading Code Samples...</span>
          <i class="fa fa-fw fa-chevron-down"></i>
        </div>
      </div>

    </div>

  </div>

  <div class="rail-toolbar uk-hidden">

    <div class="rail-current-language">
      <div class="inner">
        <span>Language</span>
        <i class="fa fa-fw fa-chevron-down"></i>
      </div>
    </div>

    <div class="toolbar">
      <a href="#code" class="uk-hidden tab" data-code>Code</a>
      <a href="#output" class="uk-hidden inactive" data-output>Output</a>

      <span class="separator"></span>

      <a id="download" class="uk-hidden">
        <i class="fa fa-fw fa-download"></i>
        <span>Download Project</span>
      </a>

      <a id="github" class="uk-hidden" target="_blank">
        <i class="fa fa-fw fa-github-square"></i>
        <span>View on GitHub</span>
      </a>

      <a id="defrosty" class="fr-on" href="#defrosty">
        <i class="fa fa-fw fa-eye"></i>
        <span class="wider-tooltip">Toggle Highlighted Lines</span>
      </a>

      <a id="clippy" href="#copy">
        <i class="fa fa-fw fa-copy"></i>
        <span>Copy to Clipboard</span>
      </a>

      <a id="linkcode" href="#linkcode">
        <i class="fa fa-fw fa-link"></i>
        <span>Link to this Code</span>
      </a>

      <a href="#expand" data-expand>
        <i class="fa fa-fw fa-arrows-alt"></i>
        <span>Full Screen</span>
      </a>
      <a href="#collapse" class="uk-hidden" data-collapse>
        <i class="fa fa-fw fa-compress"></i>
        <span>Normal Size</span>
      </a>
    </div>
  </div>

  <div class="rail-samples">
    <ul>
      
        <li>
          <a href="#code-token-generation">
            Token Generation
          </a>
        </li>
      
        <li>
          <a href="#code-server-token-generation">
            Server Token Generation
          </a>
        </li>
      
        <li>
          <a href="#code-client-initialization">
            Client Initialization
          </a>
        </li>
      
    </ul>
  </div>

  <div class="rail-languages"></div>

  <div class="rail-content">
    <div class="rail-content-inner">
      
        
        <div data-sample-title="Token Generation"
            data-sample="code-token-generation" 
            data-pref="mobile"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/video/users/token-generation-rooms/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="java">Java</option>
              
                <option value="js">JavaScript</option>
              
                <option value="m">Objective-C</option>
              
                <option value="swift">Swift</option>
              
            </select>
          </div>

          
            
          
            
          
            
          
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="java" 
                data-version="default"
                data-filename="token-generation.java"
                class="codehilite"><code><span class="code-line"><span class="c1">// Import necessary dependencies</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.JsonObject</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.koushikdutta.async.future.FutureCallback</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.koushikdutta.ion.Ion</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="o">...</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">retrieveAccessTokenfromServer</span><span class="o">()</span> <span class="o">{</span>
</span><span class="code-line">        <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class="code-line">            <span class="c1">// Make JSON request to server</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;http://localhost:8080/token.php&quot;</span><span class="o">)</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
</span><span class="code-line">            <span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class="code-line">                <span class="nd">@Override</span>
</span><span class="code-line">                <span class="c1">// Handle response from server</span>
</span><span class="code-line">                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">JsonObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">                    <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">                        <span class="c1">// The identity can be used to receive calls</span>
</span><span class="code-line">                        <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">).</span><span class="na">getAsString</span><span class="o">();</span>
</span><span class="code-line">                        <span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">).</span><span class="na">getAsString</span><span class="o">();</span>
</span><span class="code-line">                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Token found: &quot;</span> <span class="o">+</span> <span class="n">accessToken</span><span class="o">);</span>
</span><span class="code-line">                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="code-line">                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Error fetching token from server&quot;</span><span class="o">);</span>
</span><span class="code-line">                    <span class="o">}</span>
</span><span class="code-line">                <span class="o">}</span>
</span><span class="code-line">            <span class="o">});</span>
</span><span class="code-line">    <span class="o">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="o">...</span>
</span></code></pre>
            
              <pre data-ext="js" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/api/video/token-generation.js"
                class="codehilite"><code><span class="code-line"><span class="c1">// We use jQuery to make an Ajax request to the server to retrieve our </span>
</span><span class="code-line"><span class="c1">// Access Token</span>
</span><span class="code-line"><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="c1">// The data sent back from the server should contain a long string - this is</span>
</span><span class="code-line">    <span class="c1">// the JWT token you need to initialize the SDK. Read more about JWT </span>
</span><span class="code-line">    <span class="c1">// (JSON Web Token) at http://jwt.io</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Since the quickstart app doesn&#39;t implement authentication, the server</span>
</span><span class="code-line">    <span class="c1">// sends back a randomly generated username for the current client, which is</span>
</span><span class="code-line">    <span class="c1">// how they will be identified when sending and receiving Conversation</span>
</span><span class="code-line">    <span class="c1">// invites. If your app has an existing authentication system, you can use</span>
</span><span class="code-line">    <span class="c1">// the e-mail address or username that uniquely identifies a user instead.</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
            
              <pre data-ext="m" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/api/video/token-generation.m"
                class="codehilite"><code><span class="code-line"><span class="c1">// Token server endpoint URL</span>
</span><span class="code-line"><span class="bp">NSURL</span> <span class="o">*</span><span class="n">tokenURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://localhost:8000/token.php&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line"><span class="bp">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">sessionConfig</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">];</span>
</span><span class="code-line"><span class="bp">NSURLSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSession</span> <span class="nl">sessionWithConfiguration</span><span class="p">:</span><span class="n">sessionConfig</span><span class="p">];</span>
</span><span class="code-line"><span class="bp">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="p">[</span><span class="n">session</span> <span class="nl">dataTaskWithURL</span><span class="p">:</span><span class="n">tokenURL</span>
</span><span class="code-line">                                <span class="nl">completionHandler</span><span class="p">:</span> <span class="o">^</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">data</span><span class="p">,</span>
</span><span class="code-line">                                                      <span class="bp">NSURLResponse</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">response</span><span class="p">,</span>
</span><span class="code-line">                                                      <span class="bp">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                    <span class="bp">NSError</span> <span class="o">*</span><span class="n">err</span> <span class="o">=</span> <span class="n">error</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="bp">NSString</span> <span class="o">*</span><span class="n">accessToken</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="bp">NSString</span> <span class="o">*</span><span class="n">identity</span><span class="p">;</span>
</span><span class="code-line">                                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                            <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">json</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSJSONSerialization</span> <span class="nl">JSONObjectWithData</span><span class="p">:</span><span class="n">data</span>
</span><span class="code-line">                                                                                                  <span class="nl">options</span><span class="p">:</span><span class="mi">0</span>
</span><span class="code-line">                                                                                                    <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">err</span><span class="p">];</span>
</span><span class="code-line">                                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">                                                <span class="n">accessToken</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@&quot;token&quot;</span><span class="p">];</span>
</span><span class="code-line">                                                <span class="n">identity</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@&quot;identity&quot;</span><span class="p">];</span>
</span><span class="code-line">                                                <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Logged in as %@&quot;</span><span class="p">,</span><span class="n">identity</span><span class="p">);</span>
</span><span class="code-line">                                            <span class="p">}</span>
</span><span class="code-line">                                        <span class="p">}</span>
</span><span class="code-line">                                    <span class="p">}</span>
</span><span class="code-line">                                    <span class="n">completionHandler</span><span class="p">(</span><span class="n">accessToken</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
</span><span class="code-line">                                <span class="p">}];</span>
</span><span class="code-line"><span class="p">[</span><span class="n">task</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre>
            
              <pre data-ext="swift" 
                data-version="default"
                data-filename="token-generation.swift"
                class="codehilite"><code><span class="code-line"><span class="c1">// Token server endpoint URL</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">urlString</span> <span class="p">=</span> <span class="s">&quot;http://localhost:8000/token.php&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Get JSON from server</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">config</span> <span class="p">=</span> <span class="bp">NSURLSessionConfiguration</span><span class="p">.</span><span class="n">defaultSessionConfiguration</span><span class="p">()</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">session</span> <span class="p">=</span> <span class="bp">NSURLSession</span><span class="p">(</span><span class="n">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> <span class="n">delegate</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">delegateQueue</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="bp">NSURL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">urlString</span><span class="p">)</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">request</span>  <span class="p">=</span> <span class="bp">NSMutableURLRequest</span><span class="p">(</span><span class="n">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">!)</span>
</span><span class="code-line"><span class="n">request</span><span class="p">.</span><span class="n">HTTPMethod</span> <span class="p">=</span> <span class="s">&quot;GET&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Make HTTP request</span>
</span><span class="code-line"><span class="n">session</span><span class="p">.</span><span class="n">dataTaskWithRequest</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
</span><span class="code-line">  <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="c1">// Parse result JSON</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">json</span> <span class="p">=</span> <span class="n">JSON</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">!)</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">token</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;token&quot;</span><span class="p">].</span><span class="n">stringValue</span>
</span><span class="code-line">    <span class="kd">let</span> <span class="nv">identity</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;identity&quot;</span><span class="p">].</span><span class="n">stringValue</span>
</span><span class="code-line">  <span class="p">}</span>
</span><span class="code-line"><span class="p">}).</span><span class="n">resume</span><span class="p">()</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
        
        <div data-sample-title="Server Token Generation"
            data-sample="code-server-token-generation" 
            data-pref="server"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/video/users/token-generation-server-rooms/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="cs">C#</option>
              
                <option value="java">Java</option>
              
                <option value="js">Node.js</option>
              
                <option value="php">PHP</option>
              
                <option value="py">Python</option>
              
                <option value="rb">Ruby</option>
              
            </select>
          </div>

          
            
              <div class="sample-version-tabs" 
                data-ext="cs">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="4.x"
                        
                        
                        >4.x</li>
                    
                      <li class="sample-version-tab" data-version="5.x"
                        
                        
                        >5.x</li>
                    
                  </ul>
                </div>
              </div>
            
          
            
              <div class="sample-version-tabs" 
                data-ext="java">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="6.x"
                        
                        
                        >6.x</li>
                    
                      <li class="sample-version-tab" data-version="7.x"
                        
                        data-default-version
                        >7.x</li>
                    
                  </ul>
                </div>
              </div>
            
          
            
              <div class="sample-version-tabs" 
                data-ext="js">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="2.x"
                        
                        
                        >2.x</li>
                    
                      <li class="sample-version-tab" data-version="3.x"
                        
                        
                        >3.x</li>
                    
                  </ul>
                </div>
              </div>
            
          
            
              <div class="sample-version-tabs" 
                data-ext="php">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="4.x"
                        
                        
                        >4.x</li>
                    
                      <li class="sample-version-tab" data-version="5.x"
                        data-default-version
                        
                        >5.x</li>
                    
                  </ul>
                </div>
              </div>
            
          
            
              <div class="sample-version-tabs" 
                data-ext="py">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="5.x"
                        
                        
                        >5.x</li>
                    
                      <li class="sample-version-tab" data-version="6.x"
                        
                        
                        >6.x</li>
                    
                  </ul>
                </div>
              </div>
            
          
            
              <div class="sample-version-tabs" 
                data-ext="rb">
                <div class="sample-version-tabs-inner">
                  
                  <span>SDK Version:</span>
                  
                  <ul>
                    
                      <li class="sample-version-tab" data-version="4.x"
                        
                        
                        >4.x</li>
                    
                      <li class="sample-version-tab" data-version="5.x"
                        
                        
                        >5.x</li>
                    
                  </ul>
                </div>
              </div>
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="java" 
                data-version="6.x"
                data-filename="token-generation-server.6.x.java"
                class="codehilite"><code><span class="code-line"><span class="kn">package</span> <span class="nn">com.twilio</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">staticFileLocation</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.github.javafaker.Faker</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.sdk.auth.AccessToken</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.sdk.auth.ConversationsGrant</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Webapp</span> <span class="o">{</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">    <span class="c1">// Serve static files from src/main/resources/public</span>
</span><span class="code-line">    <span class="n">staticFileLocation</span><span class="o">(</span><span class="s">&quot;/public&quot;</span><span class="o">);</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create a Faker instance to generate a random username for the connecting user</span>
</span><span class="code-line">    <span class="n">Faker</span> <span class="n">faker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="o">();</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create an access token using our Twilio credentials</span>
</span><span class="code-line">    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/token&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class="code-line">      <span class="c1">// Generate a random username for the connecting client</span>
</span><span class="code-line">      <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="na">firstName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">lastName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">zipCode</span><span class="o">();</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// Create Twilio Video messaging grant</span>
</span><span class="code-line">      <span class="n">ConversationsGrant</span> <span class="n">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="o">();</span>
</span><span class="code-line">      <span class="n">grant</span><span class="o">.</span><span class="na">configurationProfileSid</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_CONFIGURATION_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// Create access token</span>
</span><span class="code-line">      <span class="n">AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_ACCOUNT_SID&quot;</span><span class="o">),</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_KEY&quot;</span><span class="o">),</span>
</span><span class="code-line">        <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_SECRET&quot;</span><span class="o">)</span>
</span><span class="code-line">      <span class="o">).</span><span class="na">identity</span><span class="o">(</span><span class="n">identity</span><span class="o">).</span><span class="na">grant</span><span class="o">(</span><span class="n">grant</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line">      
</span><span class="code-line">      <span class="c1">// create JSON response payload </span>
</span><span class="code-line">      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">,</span> <span class="n">identity</span><span class="o">);</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">toJWT</span><span class="o">());</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Render JSON response</span>
</span><span class="code-line">      <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span><span class="code-line">      <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
</span><span class="code-line">    <span class="o">});</span>
</span><span class="code-line">  <span class="o">}</span>
</span><span class="code-line"><span class="o">}</span>
</span></code></pre>
            
              <pre data-ext="py" 
                data-version="6.x"
                data-filename="token-generation-server.6.x.py"
                class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">os</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">twilio.jwt.access_token</span> <span class="kn">import</span> <span class="n">AccessToken</span><span class="p">,</span> <span class="n">ConversationsGrant</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class="code-line"><span class="n">fake</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">send_static_file</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">token</span><span class="p">():</span>
</span><span class="code-line">    <span class="c1"># get credentials for environment variables</span>
</span><span class="code-line">    <span class="n">account_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="p">]</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Create an Access Token</span>
</span><span class="code-line">    <span class="n">token</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">account_sid</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Set the Identity of this token</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">user_name</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">    <span class="n">grant</span> <span class="o">=</span> <span class="n">ConversationsGrant</span><span class="p">()</span>
</span><span class="code-line">    <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span><span class="p">(</span><span class="n">grant</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Return token info as JSON</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span><span class="p">())</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="code-line">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre>
            
              <pre data-ext="js" 
                data-version="3.x"
                data-filename="https://www.twilio.com/docs/api/video/token-generation-server.3.x.js"
                class="codehilite"><code><span class="code-line"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kr">const</span> <span class="nx">AccessToken</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;twilio&#39;</span><span class="p">).</span><span class="nx">AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">ConversationsGrant</span> <span class="o">=</span> <span class="nx">AccessToken</span><span class="p">.</span><span class="nx">ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">randomUsername</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./randos&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create Express webapp</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Create an access token which we will sign and return to the client,</span>
</span><span class="code-line">  <span class="c1">// containing the grant we just created</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_SECRET</span>
</span><span class="code-line">  <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Assign the generated identity to the token.</span>
</span><span class="code-line">  <span class="nx">token</span><span class="p">.</span><span class="nx">identity</span> <span class="o">=</span> <span class="nx">identity</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Grant the access token Twilio Video capabilities.</span>
</span><span class="code-line">  <span class="kr">const</span> <span class="nx">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">  <span class="nx">grant</span><span class="p">.</span><span class="nx">configurationProfileSid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_CONFIGURATION_SID</span><span class="p">;</span>
</span><span class="code-line">  <span class="nx">token</span><span class="p">.</span><span class="nx">addGrant</span><span class="p">(</span><span class="nx">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Serialize the token to a JWT string and include it in a JSON response</span>
</span><span class="code-line">  <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class="code-line">    <span class="nx">identity</span><span class="o">:</span> <span class="nx">identity</span><span class="p">,</span>
</span><span class="code-line">    <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">toJwt</span><span class="p">(),</span>
</span><span class="code-line">  <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create http server and run it</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span><span class="code-line"><span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Express server running on *:&#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
            
              <pre data-ext="cs" 
                data-version="5.x"
                data-filename="token-generation-server.5.x.cs"
                class="codehilite"><code><span class="code-line"><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Faker</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio.JWT</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nn">VideoQuickstart.Controllers</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">class</span> <span class="nc">TokenController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">        <span class="c1">// GET: Token</span>
</span><span class="code-line">        <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">device</span><span class="p">)</span>
</span><span class="code-line">        <span class="p">{</span>
</span><span class="code-line">            <span class="c1">// Load Twilio configuration from Web.config</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">accountSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioAccountSid&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiKey</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiKey&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiSecret</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiSecret&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a random identity for the client</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">identity</span> <span class="p">=</span> <span class="n">Internet</span><span class="p">.</span><span class="n">UserName</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create an Access Token generator</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">accountSid</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">,</span> <span class="n">apiSecret</span><span class="p">)</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">Identity</span> <span class="p">=</span> <span class="n">identity</span>
</span><span class="code-line">            <span class="p">};</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a video grant for this token</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">grant</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">AddGrant</span><span class="p">(</span><span class="n">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">identity</span><span class="p">,</span>
</span><span class="code-line">                <span class="n">token</span> <span class="p">=</span> <span class="n">token</span><span class="p">.</span><span class="n">ToJwt</span><span class="p">()</span>
</span><span class="code-line">            <span class="p">},</span> <span class="n">JsonRequestBehavior</span><span class="p">.</span><span class="n">AllowGet</span><span class="p">);</span>
</span><span class="code-line">        <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
            
              <pre data-ext="php" 
                data-version="5.x"
                data-filename="https://www.twilio.com/docs/api/video/token-generation-server.5.x.php"
                class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line"><span class="c1">// Get the PHP helper library from twilio.com/docs/php/install</span>
</span><span class="code-line"><span class="k">require_once</span> <span class="s1">&#39;/path/to/vendor/autoload.php&#39;</span><span class="p">;</span> <span class="c1">// Loads the library</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Jwt\AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="k">use</span> <span class="nx">Twilio\Jwt\Grants\ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Required for all Twilio access tokens</span>
</span><span class="code-line"><span class="nv">$twilioAccountSid</span> <span class="o">=</span> <span class="s1">&#39;ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$twilioApiKey</span> <span class="o">=</span> <span class="s1">&#39;SKXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$twilioApiSecret</span> <span class="o">=</span> <span class="s1">&#39;your_api_secret&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="nv">$TwilioConfigurationSid</span> <span class="o">=</span> <span class="s1">&#39;VSXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="p">;</span>
</span><span class="code-line"><span class="c1">// choose a random username for the connecting user</span>
</span><span class="code-line"><span class="nv">$identity</span> <span class="o">=</span> <span class="s1">&#39;randomUsername&#39;</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create access token, which we will serialize and send to the client</span>
</span><span class="code-line"><span class="nv">$token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nv">$TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_SECRET</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$identity</span>
</span><span class="code-line"><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Grant access to Twilio Video</span>
</span><span class="code-line"><span class="nv">$grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line"><span class="nv">$grant</span><span class="o">-&gt;</span><span class="na">setConfigurationProfileSid</span><span class="p">(</span><span class="nv">$TwilioConfigurationSid</span><span class="p">);</span>
</span><span class="code-line"><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">addGrant</span><span class="p">(</span><span class="nv">$grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// return serialized token and the user&#39;s randomly generated ID</span>
</span><span class="code-line"><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span>
</span><span class="code-line">    <span class="k">array</span><span class="p">(</span>
</span><span class="code-line">        <span class="s1">&#39;identity&#39;</span> <span class="o">=&gt;</span> <span class="nv">$identity</span><span class="p">,</span>
</span><span class="code-line">        <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">toJWT</span><span class="p">(),</span>
</span><span class="code-line">    <span class="p">)</span>
</span><span class="code-line"><span class="p">);</span>
</span></code></pre>
            
              <pre data-ext="py" 
                data-version="5.x"
                data-filename="token-generation-server.5.x.py"
                class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">os</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>
</span><span class="code-line"><span class="kn">from</span> <span class="nn">twilio.access_token</span> <span class="kn">import</span> <span class="n">AccessToken</span><span class="p">,</span> <span class="n">ConversationsGrant</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class="code-line"><span class="n">fake</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">send_static_file</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">)</span>
</span><span class="code-line"><span class="k">def</span> <span class="nf">token</span><span class="p">():</span>
</span><span class="code-line">    <span class="c1"># get credentials for environment variables</span>
</span><span class="code-line">    <span class="n">account_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">api_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="p">]</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Create an Access Token</span>
</span><span class="code-line">    <span class="n">token</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">account_sid</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Set the Identity of this token</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">user_name</span><span class="p">()</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">    <span class="n">grant</span> <span class="o">=</span> <span class="n">ConversationsGrant</span><span class="p">()</span>
</span><span class="code-line">    <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="p">]</span>
</span><span class="code-line">    <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span><span class="p">(</span><span class="n">grant</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1"># Return token info as JSON</span>
</span><span class="code-line">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span><span class="p">())</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="code-line">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre>
            
              <pre data-ext="rb" 
                data-version="5.x"
                data-filename="token-generation-server.5.x.rb"
                class="codehilite"><code><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;twilio-ruby&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra/json&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;dotenv&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;faker&#39;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Load environment configuration</span>
</span><span class="code-line"><span class="no">Dotenv</span><span class="o">.</span><span class="n">load</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Render home page</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">))</span>
</span><span class="code-line"><span class="k">end</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Generate a token for use in our Video application</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/token&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="c1"># Create a random username for the client</span>
</span><span class="code-line">  <span class="n">identity</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="o">.</span><span class="n">user_name</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Create an Access Token for Video usage</span>
</span><span class="code-line">  <span class="n">token</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="n">identity</span>
</span><span class="code-line">  <span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">  <span class="n">grant</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">::</span><span class="no">ConversationsGrant</span><span class="o">.</span><span class="n">new</span>
</span><span class="code-line">  <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="o">]</span>
</span><span class="code-line">  <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span> <span class="n">grant</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Generate the token and send to client</span>
</span><span class="code-line">  <span class="n">json</span> <span class="ss">identity</span><span class="p">:</span> <span class="n">identity</span><span class="p">,</span> <span class="ss">token</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span>
</span><span class="code-line"><span class="k">end</span>
</span></code></pre>
            
              <pre data-ext="java" 
                data-version="7.x"
                data-filename="token-generation-server.7.x.java"
                class="codehilite"><code><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">staticFileLocation</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.github.javafaker.Faker</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.jwt.accesstoken.AccessToken</span><span class="o">;</span>
</span><span class="code-line"><span class="kn">import</span> <span class="nn">com.twilio.jwt.accesstoken.ConversationsGrant</span><span class="o">;</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Webapp</span> <span class="o">{</span>
</span><span class="code-line">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class="code-line">    <span class="c1">// Serve static files from src/main/resources/public</span>
</span><span class="code-line">    <span class="n">staticFileLocation</span><span class="o">(</span><span class="s">&quot;/public&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="n">String</span> <span class="n">ACCOUNT_SID</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_ACCOUNT_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">    <span class="n">String</span> <span class="n">API_KEY</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_KEY&quot;</span><span class="o">);</span>
</span><span class="code-line">    <span class="n">String</span> <span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_API_SECRET&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="n">String</span> <span class="n">TWILIO_CONFIGURATION_SID</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">(</span><span class="s">&quot;TWILIO_CONFIGURATION_SID&quot;</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Create a Faker instance to generate a random username for the connecting user</span>
</span><span class="code-line">    <span class="n">Faker</span> <span class="n">faker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Create an access token using our Twilio credentials</span>
</span><span class="code-line">    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/token&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class="code-line">      <span class="c1">// Generate a random username for the connecting client</span>
</span><span class="code-line">      <span class="n">String</span> <span class="n">identity</span> <span class="o">=</span>
</span><span class="code-line">          <span class="n">faker</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">firstName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">lastName</span><span class="o">()</span> <span class="o">+</span> <span class="n">faker</span><span class="o">.</span><span class="na">address</span><span class="o">().</span><span class="na">zipCode</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Create Twilio Video grant</span>
</span><span class="code-line">      <span class="n">ConversationsGrant</span> <span class="n">grant</span> <span class="o">=</span>
</span><span class="code-line">          <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="o">().</span><span class="na">setConfigurationProfileSid</span><span class="o">(</span><span class="n">TWILIO_CONFIGURATION_SID</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Create access token</span>
</span><span class="code-line">      <span class="n">AccessToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">ACCOUNT_SID</span><span class="o">,</span> <span class="n">API_KEY</span><span class="o">,</span> <span class="n">API_SECRET</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">identity</span><span class="o">(</span><span class="n">identity</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">grant</span><span class="o">(</span><span class="n">grant</span><span class="o">)</span>
</span><span class="code-line">          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// create JSON response payload</span>
</span><span class="code-line">      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">,</span> <span class="n">identity</span><span class="o">);</span>
</span><span class="code-line">      <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">toJwt</span><span class="o">());</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="c1">// Render JSON response</span>
</span><span class="code-line">      <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span><span class="code-line">      <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
</span><span class="code-line">    <span class="o">});</span>
</span><span class="code-line">  <span class="o">}</span>
</span><span class="code-line"><span class="o">}</span>
</span></code></pre>
            
              <pre data-ext="js" 
                data-version="2.x"
                data-filename="https://www.twilio.com/docs/api/video/token-generation-server.2.x.js"
                class="codehilite"><code><span class="code-line"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">AccessToken</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;twilio&#39;</span><span class="p">).</span><span class="nx">AccessToken</span><span class="p">;</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">ConversationsGrant</span> <span class="o">=</span> <span class="nx">AccessToken</span><span class="p">.</span><span class="nx">ConversationsGrant</span><span class="p">;</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">randomUsername</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./randos&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create Express webapp</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
</span><span class="code-line">
</span><span class="code-line"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="c1">// Create an access token which we will sign and return to the client,</span>
</span><span class="code-line">    <span class="c1">// containing the grant we just created</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AccessToken</span><span class="p">(</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_API_SECRET</span>
</span><span class="code-line">    <span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">//assign the generated identity to the token</span>
</span><span class="code-line">    <span class="nx">token</span><span class="p">.</span><span class="nx">identity</span> <span class="o">=</span> <span class="nx">identity</span><span class="p">;</span>
</span><span class="code-line">        
</span><span class="code-line">    <span class="c1">//grant the access token Twilio Video capabilities</span>
</span><span class="code-line">    <span class="kd">var</span> <span class="nx">grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">    <span class="nx">grant</span><span class="p">.</span><span class="nx">configurationProfileSid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TWILIO_CONFIGURATION_SID</span><span class="p">;</span>
</span><span class="code-line">    <span class="nx">token</span><span class="p">.</span><span class="nx">addGrant</span><span class="p">(</span><span class="nx">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="c1">// Serialize the token to a JWT string and include it in a JSON response</span>
</span><span class="code-line">    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class="code-line">        <span class="nx">identity</span><span class="o">:</span> <span class="nx">identity</span><span class="p">,</span>
</span><span class="code-line">        <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">toJwt</span><span class="p">()</span>
</span><span class="code-line">    <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create http server and run it</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>
</span><span class="code-line"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="code-line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Express server running on *:&#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
            
              <pre data-ext="cs" 
                data-version="4.x"
                data-filename="token-generation-server.4.x.cs"
                class="codehilite"><code><span class="code-line"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">System.Web.Mvc</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Twilio.Auth</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">JWT</span><span class="p">;</span>
</span><span class="code-line"><span class="k">using</span> <span class="nn">Faker</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">namespace</span> <span class="nn">VideoQuickstart.Controllers</span>
</span><span class="code-line"><span class="p">{</span>
</span><span class="code-line">    <span class="k">public</span> <span class="k">class</span> <span class="nc">TokenController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class="code-line">    <span class="p">{</span>
</span><span class="code-line">        <span class="c1">// GET: /token</span>
</span><span class="code-line">        <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">Device</span><span class="p">)</span>
</span><span class="code-line">        <span class="p">{</span>
</span><span class="code-line">            <span class="c1">// Load Twilio configuration from Web.config</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">accountSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioAccountSid&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiKey</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiKey&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">apiSecret</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioApiSecret&quot;</span><span class="p">];</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">videoConfigSid</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;TwilioConfigurationSid&quot;</span><span class="p">];</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a random identity for the client</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">identity</span> <span class="p">=</span> <span class="n">Internet</span><span class="p">.</span><span class="n">UserName</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create an Access Token generator</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="p">(</span><span class="n">accountSid</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">,</span> <span class="n">apiSecret</span><span class="p">);</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">Identity</span> <span class="p">=</span> <span class="n">identity</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="c1">// Create a video grant for this token</span>
</span><span class="code-line">            <span class="kt">var</span> <span class="n">grant</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line">            <span class="n">token</span><span class="p">.</span><span class="n">AddGrant</span><span class="p">(</span><span class="n">grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span>
</span><span class="code-line">            <span class="p">{</span>
</span><span class="code-line">                <span class="n">identity</span> <span class="p">=</span> <span class="n">identity</span><span class="p">,</span>
</span><span class="code-line">                <span class="n">token</span> <span class="p">=</span> <span class="n">token</span><span class="p">.</span><span class="n">ToJWT</span><span class="p">()</span>
</span><span class="code-line">            <span class="p">},</span> <span class="n">JsonRequestBehavior</span><span class="p">.</span><span class="n">AllowGet</span><span class="p">);</span>
</span><span class="code-line">        <span class="p">}</span>
</span><span class="code-line">    <span class="p">}</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
            
              <pre data-ext="php" 
                data-version="4.x"
                data-filename="https://www.twilio.com/docs/api/video/token-generation-server.4.x.php"
                class="codehilite"><code><span class="code-line"><span class="cp">&lt;?php</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./twilio-php/Services/Twilio.php&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./randos.php&#39;</span><span class="p">);</span>
</span><span class="code-line"><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;./config.php&#39;</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// choose a random username for the connecting user</span>
</span><span class="code-line"><span class="nv">$identity</span> <span class="o">=</span> <span class="nx">randomUsername</span><span class="p">();</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Create access token, which we will serialize and send to the client</span>
</span><span class="code-line"><span class="nv">$token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Services_Twilio_AccessToken</span><span class="p">(</span>
</span><span class="code-line">    <span class="nv">$TWILIO_ACCOUNT_SID</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_KEY</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$TWILIO_API_SECRET</span><span class="p">,</span>
</span><span class="code-line">    <span class="mi">3600</span><span class="p">,</span>
</span><span class="code-line">    <span class="nv">$identity</span>
</span><span class="code-line"><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Grant access to Twilio Video</span>
</span><span class="code-line"><span class="nv">$grant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Services_Twilio_Auth_ConversationsGrant</span><span class="p">();</span>
</span><span class="code-line"><span class="nv">$grant</span><span class="o">-&gt;</span><span class="na">setConfigurationProfileSid</span><span class="p">(</span><span class="nv">$TWILIO_CONFIGURATION_SID</span><span class="p">);</span>
</span><span class="code-line"><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">addGrant</span><span class="p">(</span><span class="nv">$grant</span><span class="p">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// return serialized token and the user&#39;s randomly generated ID</span>
</span><span class="code-line"><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class="code-line">    <span class="s1">&#39;identity&#39;</span> <span class="o">=&gt;</span> <span class="nv">$identity</span><span class="p">,</span>
</span><span class="code-line">    <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">toJWT</span><span class="p">(),</span>
</span><span class="code-line"><span class="p">));</span>
</span></code></pre>
            
              <pre data-ext="rb" 
                data-version="4.x"
                data-filename="token-generation-server.4.x.rb"
                class="codehilite"><code><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;twilio-ruby&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;sinatra/json&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;dotenv&#39;</span>
</span><span class="code-line"><span class="nb">require</span> <span class="s1">&#39;faker&#39;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Load environment configuration</span>
</span><span class="code-line"><span class="no">Dotenv</span><span class="o">.</span><span class="n">load</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Render home page</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">))</span>
</span><span class="code-line"><span class="k">end</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1"># Generate a token for use in our Video application</span>
</span><span class="code-line"><span class="n">get</span> <span class="s1">&#39;/token&#39;</span> <span class="k">do</span>
</span><span class="code-line">  <span class="c1"># Create a random username for the client</span>
</span><span class="code-line">  <span class="n">identity</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="o">.</span><span class="n">user_name</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Create an Access Token for Video usage</span>
</span><span class="code-line">  <span class="n">token</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">.</span><span class="n">new</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_ACCOUNT_SID&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class="code-line">    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_KEY&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_API_SECRET&#39;</span><span class="o">]</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">identity</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Grant access to Twilio Video</span>
</span><span class="code-line">  <span class="n">grant</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">::</span><span class="no">ConversationsGrant</span><span class="o">.</span><span class="n">new</span>
</span><span class="code-line">  <span class="n">grant</span><span class="o">.</span><span class="n">configuration_profile_sid</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_CONFIGURATION_SID&#39;</span><span class="o">]</span>
</span><span class="code-line">  <span class="n">token</span><span class="o">.</span><span class="n">add_grant</span> <span class="n">grant</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1"># Generate the token and send to client</span>
</span><span class="code-line">  <span class="n">json</span> <span class="ss">:identity</span> <span class="o">=&gt;</span> <span class="n">identity</span><span class="p">,</span> <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="n">token</span><span class="o">.</span><span class="n">to_jwt</span>
</span><span class="code-line"><span class="k">end</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
        
        <div data-sample-title="Client Initialization"
            data-sample="code-client-initialization" 
            data-pref="mobile"
            data-download-url=""
            data-github-url="https://github.com/TwilioDevEd/api-snippets/blob/master/video/users/client-initialization-rooms/{{ filename }}"
            class="code-sample">

          <div class="sample-language-data" style="display:none;">
            <select>
              
                <option value="java">Java</option>
              
                <option value="js">JavaScript</option>
              
                <option value="m">Objective-C</option>
              
                <option value="swift">Swift</option>
              
            </select>
          </div>

          
            
          
            
          
            
          
            
          

          

          <div class="snippet-container">
            
              <pre data-ext="java" 
                data-version="default"
                data-filename="client-initialization.java"
                class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="n">VideoClient</span> <span class="n">videoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VideoClient</span><span class="o">(</span><span class="n">VideoActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">);</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Connect to a room</span>
</span><span class="code-line"><span class="n">ConnectOptions</span> <span class="n">connectOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">roomName</span><span class="o">(</span><span class="s">&quot;my-room&quot;</span><span class="o">)</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">localMedia</span><span class="o">(</span><span class="n">localMedia</span><span class="o">)</span>
</span><span class="code-line">                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class="code-line"><span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">videoClient</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">connectOptions</span><span class="o">,</span> <span class="n">roomListener</span><span class="o">());</span>
</span></code></pre>
            
              <pre data-ext="js" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/api/video/client-initialization.js"
                class="codehilite"><code><span class="code-line"><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;/token&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="c1">// Create a Video Client and connect to Twilio&#39;s backend</span>
</span><span class="code-line">  <span class="kd">var</span> <span class="nx">videoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Twilio</span><span class="p">.</span><span class="nx">Video</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span class="code-line">  <span class="nx">videoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span> <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;my-room&#39;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected to Twilio!&#39;</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Could not connect to Twilio: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span class="code-line">  <span class="p">});</span>
</span><span class="code-line"><span class="p">});</span>
</span></code></pre>
            
              <pre data-ext="m" 
                data-version="default"
                data-filename="https://www.twilio.com/docs/api/video/client-initialization.m"
                class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="n">TVIVideoClient</span> <span class="o">*</span><span class="n">videoClient</span> <span class="o">=</span> <span class="p">[</span><span class="n">TVIVideoClient</span> <span class="nl">clientWithToken</span><span class="p">:</span><span class="n">accessToken</span><span class="p">];</span>
</span><span class="code-line"><span class="nb">self</span><span class="p">.</span><span class="n">videoClient</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Join a room </span>
</span><span class="code-line"><span class="n">TVIConnectOptions</span> <span class="o">*</span><span class="n">connectOptions</span> <span class="o">=</span> <span class="p">[</span><span class="n">TVIConnectOptions</span> <span class="nl">optionsWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">TVIConnectOptionsBuilder</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
</span><span class="code-line">  <span class="n">builder</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">@&quot;my-room&quot;</span><span class="p">;</span>
</span><span class="code-line"><span class="p">}];</span>
</span><span class="code-line">
</span><span class="code-line"><span class="n">TVIRoom</span> <span class="o">*</span><span class="n">room</span> <span class="o">=</span> <span class="p">[</span><span class="n">videoClient</span> <span class="nl">connectWithOptions</span><span class="p">:</span><span class="n">connectOptions</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
</span></code></pre>
            
              <pre data-ext="swift" 
                data-version="default"
                data-filename="client-initialization.swift"
                class="codehilite"><code><span class="code-line"><span class="c1">// Create a Video Client and connect to Twilio&#39;s backend.</span>
</span><span class="code-line"><span class="kd">var</span> <span class="nv">client</span> <span class="p">=</span> <span class="n">TVIVideoClient</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="n">accessToken</span><span class="p">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="c1">// Connect to a room</span>
</span><span class="code-line"><span class="kd">let</span> <span class="nv">connectOptions</span> <span class="p">=</span> <span class="n">TVIConnectOptions</span> <span class="p">{</span> <span class="p">(</span><span class="n">builder</span><span class="p">)</span> <span class="k">in</span>
</span><span class="code-line">    <span class="n">builder</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&quot;my-room&quot;</span>
</span><span class="code-line"><span class="p">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="k">if</span> <span class="kd">let</span> <span class="nv">client</span> <span class="p">=</span> <span class="n">client</span> <span class="p">{</span>
</span><span class="code-line">    <span class="n">room</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">connectOptions</span><span class="p">,</span> <span class="n">delegate</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
</span><span class="code-line"><span class="p">}</span>
</span></code></pre>
            
          </div>

          <div class="output-snippet-container">
            
          </div>

        </div>
        
      
    </div>
  </div>
</div>


    </div>

  </div>

      </div>
    </div>

    
    


<div class="footer" data-swiftype-index="false">
  <div class="uk-container uk-container-center">
    <div class="footer__statement">We can’t wait to see what you build.</div>
    <div class="uk-grid">
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Products</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/voice-video" class="footer__link">Voice &amp; Video</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/messaging" class="footer__link">Messaging</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/authy" class="footer__link">Authentication</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/wireless" class="footer__link">Connected Devices</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">Use Cases</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/access-security" class="footer__link">Access Security</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/contextual-call-center" class="footer__link">Contextual Call Center</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/marketplace-communications" class="footer__link">Marketplace Communications</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/use-cases/mobile-messaging" class="footer__link">Mobile Messaging</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-small-1-3 uk-width-medium-1-5">
        <section class="footer__section">
          <header class="footer__header">About</header>
          <ul class="footer__list">
            <li class="footer__list-item">
              <a href="https://www.twilio.com/what-is-cloud-communications?" class="footer__link">What is Twilio?</a>
            </li>
            <li class="footer__list-item">
              <a href="https://customers.twilio.com/" class="footer__link">Customers</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/help" class="footer__link">Get Help</a>
            </li>
            <li class="footer__list-item">
              <a href="https://www.twilio.com/help/sales" class="footer__link">Talk to Sales</a>
            </li>
          </ul>
        </section>
      </div>
      <div class="uk-width-1-1 uk-width-medium-2-5">
        <section class="footer__section">
  <header class="footer__header">Hits From The Blog</header>
  <ul class="footer__list footer__list">
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/building-an-ivr-with-no-code-by-using-taskrouter-as-a-state-machine.html" class="footer__link">Building an IVR with no code by using TaskRouter as a state machine</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/logrole-gives-you-permissions-based-granular-searching-for-twilio-logs.html" class="footer__link">Logrole Gives You Permissions Based, Granular Searching For Twilio Logs</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/build-callbacks-with-stamplay-twilio-and-unbounce.html" class="footer__link">Build Callbacks With Stamplay, Twilio and Unbounce</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/build-a-basic-call-center-in-just-a-few-minutes-with-twilio.html" class="footer__link">Build a Basic Call Center in Just a Few Minutes with Twilio</a>
    </li>
    
    <li class="footer__list-item">
      <a href="https://www.twilio.com/blog/2017/01/redact-delete-sms-messages-node-js.html" class="footer__link">Redact or Delete SMS Messages as They Arrive with Node.js</a>
    </li>
    
  </ul>

</section>
      </div>
    </div>
    <footer class="footer__footer">
      <div class="footer__logo" title="Twilio">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
          <path d="M15 0C6.7 0 0 6.7 0 15s6.7 15 15 15 15-6.7 15-15S23.3 0 15 0zm0 26C8.9 26 4 21.1 4 15S8.9 4 15 4s11 4.9 11 11-4.9 11-11 11z"/>
          <circle cx="18.7" cy="11.3" r="3.1"/>
          <circle cx="18.7" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="18.7" r="3.1"/>
          <circle cx="11.3" cy="11.3" r="3.1"/>
        </svg>
      </div>
      <ul class="legal__list">
        <li class="legal__list-item">
          <a href="https://www.twilio.com/company" class="legal__link">About Twilio</a>
        </li>
        <li class="legal__list-item">
          <a href="https://www.twilio.com/legal" class="legal__link">Legal</a>
        </li>
        <li class="legal__list-item">Copyright &copy; 2016 Twilio, Inc. 
          <br class="uk-visible-small">All Rights Reserved.
        </li>
      </ul>
    </footer>
  </div>
</div>


    
    <script src="https://www.twilio.com/docs/static/js/vendor.min.16abf41c42de.js"></script>
    

  

  <!-- Mixpanel -->
  <script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
  typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,
    e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
    mixpanel.init("f71c19735fa6ecc5225ff563285e1794");
    </script>
  

  
    <!-- Heap -->
    <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var n=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(n?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o);for(var r=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=r(p[c])};
    heap.load('1541905715');
    </script>
  

  
    <!-- GA -->
    <script type="text/javascript">
    try {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2900316-1']);
      _gaq.push(['_setSiteSpeedSampleRate', 50]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    } catch(err) {}

    var _kmq = _kmq || [];
    </script>
  

  
    <!-- Eloqua -->
    <script type="text/javascript">
    var _elqQ = _elqQ || [];
    _elqQ.push(['elqSetSiteId', '815114181']);
    _elqQ.push(['elqTrackPageView']);
    _elqQ.push(['elqUseFirstPartyCookie', 'www.twilio.com']);

    (function () {
      function async_load() {
        var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
        s.src = 'http://img03.en25.com/i/elqCfg.min.js';
        var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
      }
      if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
      else if (window.attachEvent) window.attachEvent('onload', async_load);
    })();
    </script>
  

  
    <!-- Transifex -->
    <script type="text/javascript">
    window.liveSettings = {
      api_key: '4c06c1c5a6b341e591d969476fe2675f'
    };
    </script>
    <script type="text/javascript" src="http://cdn.transifex.com/live.js"></script>
    <style>
    .txlive-langselector { display: none; }
    </style>
  

  



    
      <script src="https://www.twilio.com/docs/static/js/docs.min.0c5bb1abb16f.js"></script>
    

    
    



    

  </body>

<!-- Mirrored from www.twilio.com/docs/api/video/identity by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 22:09:58 GMT -->
</html>
