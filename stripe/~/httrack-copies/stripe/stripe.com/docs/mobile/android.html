<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/mobile/android by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:44:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="BHE_RiUSmVdQLrhxjJnySOjjx73V-Gq1F8M-QcQOV4Kd6ys7I9ddEp1qnG5AkcczwZ1JOolUqxVWdjRpYdmd8w==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Android Integration</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Android Integration">
    <meta property="og:url" content="android.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Android Integration">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="../checkout/tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="ios.html">iOS</a>
    </li>
    <li>
      <a class='selected' href="android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="../subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="../subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="../subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="../subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="../subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="../subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="../subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="../subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="../subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="../subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="../subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="../connect/connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="../connect/identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="../connect/required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="../connect/testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="../connect/bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="../connect/migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="../connect/best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="../connect/special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="../connect/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <style type="text/css" media="screen">#doc .code-example:before {clear: none;}</style>
<header>
  <h1>Android Integration</h1>
  <p>Our Android libraries let you easily accept mobile payments inside any Android app. If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=android">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
</header>

<section>
  <aside class="note">
    <h3>Using Stripe vs. In-App Purchases</h3>
    <p>Google's <a href="https://play.google.com/about/developer-content-policy.html">developer terms</a> require that purchases related to the app, such as premium features or credits, are made via their native <a href="http://developer.android.com/google/play/billing/api.html">In-app Billing API</a>.</p>
    <p>You can only use Stripe for purchasing physical goods (such as groceries, clothing, and appliances) or for services (such as club memberships, hotel reservations, and tickets for events).</p>
  </aside>

<p>Stripe has created a Java library for Android, allowing you to easily submit payments from an Android app. With our mobile library, we shoulder the burden of PCI compliance by eliminating the need to send card data directly to your server. Instead, our libraries send the card data directly to our servers, where we can convert them to <a href="../api.html#tokens">tokens</a>.</p>

<p>Your app will receive the token back, and can then send the token to an endpoint on your server, where it can be used to process a payment, establish recurring billing, or merely saved for later use.</p>

<p>We support Android back to version 9, and the library has no external dependencies.</p></section>

<section>
<h2 id="installation">Installation</h2>

<p>Installing the Stripe Android library is similar using <a href="http://developer.android.com/tools/studio/index.html">Android Studio</a> and <a href="https://www.jetbrains.com/help/idea/2016.3/getting-started-with-android-development.html">IntelliJ</a>. You don’t need to clone a repo or download any files. Just add the following to your project’s <code>build.gradle</code> file, inside the dependencies section.</p>
<div class="code">
  <nav class="nav-filename icon-file">
    build.gradle
  </nav>
  <pre class="language-java numbered" ><code>compile &#39;com.stripe:stripe-android:2.0.2&#39;</code></pre>
</div>

</section>

<section>
<h2 id="collecting-credit-card-information">Collecting credit card information</h2>

<p>At some point in the flow of your app, you’ll want to obtain payment details from the user. There are a couple ways to do this:</p>

<ul>
  <li><a href="#android-pay" class="arrow">Use Android Pay to access your customer’s stored card information</a></li>
  <li><a href="#credit-card-form" class="arrow">Build your own credit card form</a></li>
</ul>

<p>Instructions for each route follows, although you may want to write your app to offer support for both.</p>

<h3 id="android-pay">Using Android Pay <span class="tag beta">Preview</span></h3>

<p>Through Android Pay, you can access payment information stored in your customers’ Google accounts.</p>

<h4 id="setting-up-your-app">Setting up your app</h4>

<p>You’ll first need to obtain credentials and a client ID for your app, as explained in the <a href="https://developers.google.com/android-pay/android/tutorial">Android Pay API Tutorial</a>. You will also need to set up the latest version of <a href="http://developer.android.com/google/play-services/setup.html">Google Play Services</a>, version 8.4 or higher.</p>

<h4 id="collecting-payment-information-through-android-pay">Collecting payment information through Android Pay</h4>

<p>To use Android Pay in your app, first enable the Android Pay API by adding the following to the <code>&lt;application&gt;</code> tag of your <strong>AndroidManifest.xml</strong>:</p>
<div class="code">
  <nav class="nav-filename icon-file">
    AndroidManifest.xml
  </nav>
  <pre class="language-markup numbered" ><code>&lt;application
  ...
  &lt;meta-data
    android:name=&quot;com.google.android.gms.wallet.api.enabled&quot;
    android:value=&quot;true&quot; /&gt;
&lt;/application&gt;</code></pre>
</div>

<p>Your application will need a <code>SupportWalletFragment</code> in the activity’s layout. The fragment is the placeholder for the Android Pay purchase button.  You can create this either programmatically or add it to an activity layout via XML:</p>
<div class="code">
  <pre class="language-markup numbered" ><code>&lt;!-- You will need to add the wallet namespace to your enclosing Layout --&gt;
xmlns:wallet=&quot;http://schemas.android.com/apk/res-auto&quot;

&lt;fragment
  android:id=&quot;@+id/wallet_fragment&quot;
  android:name=&quot;com.google.android.gms.wallet.fragment.SupportWalletFragment&quot;
  android:layout_width=&quot;match_parent&quot;
  android:layout_height=&quot;wrap_content&quot;
  wallet:environment=&quot;test&quot;
  wallet:fragmentMode=&quot;buyButton&quot; /&gt;</code></pre>
</div>

<p>With the fragment in place, back in the activity, you need to:</p>

<ol>
  <li>Grab a reference to that fragment.</li>
  <li>Create a <code>MaskedWalletRequest</code>.</li>
  <li>Initialize the fragment.</li>
</ol>

<p>In the <code>MaskedWalletRequest</code>, you are able to
specify the amount to charge and what additional information
you’d like to collect (e.g., the shipping address). This is also where you
 specify you are using Stripe as the processor. Doing so
will let the application request a Stripe token directly from the wallet.</p>

<p>Before starting the Android Pay flow, use the <code>isReadyToPay()</code> method to check whether the user has the Android Pay app installed and is ready to pay through it. Also see Google’s documentation for information on their <a href="https://developers.google.com/android-pay/ui-branding">UI and branding requirements</a>.</p>
<div class="code">
  <pre class="language-java numbered" ><code>public class PaymentActivity extends FragmentActivity implements GoogleApiClient.ConnectionCallbacks, GoogleApiClient.OnConnectionFailedListener {

  // You will need to use your live API key even while testing
  public static final String PUBLISHABLE_KEY = &quot;pk_live_XXX&quot;;

  // Unique identifiers for asynchronous requests:
  private static final int LOAD_MASKED_WALLET_REQUEST_CODE = 1000;
  private static final int LOAD_FULL_WALLET_REQUEST_CODE = 1001;

  private SupportWalletFragment walletFragment;

  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    Wallet.Payments.isReadyToPay(googleApiClient).setResultCallback(
      new ResultCallback&lt;BooleanResult&gt;() {
        @Override
        public void onResult(@NonNull BooleanResult booleanResult) {
          if (booleanResult.getStatus().isSuccess()) {
            if (booleanResult.getValue()) {
              showAndroidPay();
            } else {
              // Hide Android Pay buttons, show a message that Android Pay
              // cannot be used yet, and display a traditional checkout button
            }
          } else {
            // Error making isReadyToPay call
            Log.e(TAG, &quot;isReadyToPay:&quot; + booleanResult.getStatus());
          }
        }
      }
    );
    ...
  }

  public void showAndroidPay() {
    setContentView(R.layout.payment_activity);

    walletFragment =
      (SupportWalletFragment) getSupportFragmentManager().findFragmentById(R.id.wallet_fragment);

    MaskedWalletRequest maskedWalletRequest = MaskedWalletRequest.newBuilder()

      // Request credit card tokenization with Stripe by specifying tokenization parameters:
      .setPaymentMethodTokenizationParameters(PaymentMethodTokenizationParameters.newBuilder()
        .setPaymentMethodTokenizationType(PaymentMethodTokenizationType.PAYMENT_GATEWAY)
        .addParameter(&quot;gateway&quot;, &quot;stripe&quot;)
        .addParameter(&quot;stripe:publishableKey&quot;, PUBLISHABLE_KEY)
        .addParameter(&quot;stripe:version&quot;, StripeApiHandler.VERSION)
        .build())

      // You want the shipping address:
      .setShippingAddressRequired(true)

      // Price set as a decimal:
      .setEstimatedTotalPrice(&quot;20.00&quot;)
      .setCurrencyCode(&quot;USD&quot;)
      .build();

    // Set the parameters:
    WalletFragmentInitParams initParams = WalletFragmentInitParams.newBuilder()
      .setMaskedWalletRequest(maskedWalletRequest)
      .setMaskedWalletRequestCode(LOAD_MASKED_WALLET_REQUEST_CODE)
      .build();

    // Initialize the fragment:
    walletFragment.initialize(initParams);

    ...
  }

  public void onStart() {
    ...
  }

  public void onStop() {
    ...
  }

  @Override
  protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    ...
  }

  @Override
  public void onConnectionFailed(ConnectionResult connectionResult) {}

  @Override
  public void onConnected(Bundle bundle) {}

  @Override
  public void onConnectionSuspended(int i) {}
}</code></pre>
</div>

<p>Note that the price set within the Android app is written as a decimal. This is for the Android app only. The token received back will be sent to your server, and the charge request will be made of the Stripe API from there. The actual amount to be charged is requested at that point, and is set as an integer.</p>

<p>The last part of the setup process for the app is to connect to the Google Wallet
API. You will need this connection in place for when the user presses the Android Pay purchase button just created.</p>
<div class="code">
  <pre class="language-java numbered" ><code>public class PaymentActivity extends FragmentActivity {
  ...

  private GoogleApiClient googleApiClient;

  public void onCreate(Bundle savedInstanceState) {
    ...

    googleApiClient = new GoogleApiClient.Builder(this)
      .addConnectionCallbacks(this)
      .addOnConnectionFailedListener(this)
      .addApi(Wallet.API, new Wallet.WalletOptions.Builder()
        .setEnvironment(WalletConstants.ENVIRONMENT_TEST)
        .setTheme(WalletConstants.THEME_LIGHT)
        .build())
      .build();
  }

  public void onStart() {
    super.onStart();
    googleApiClient.connect();
  }

  public void onStop() {
    super.onStop();
    googleApiClient.disconnect();
  }
}</code></pre>
</div>

<p>When your customer confirms their purchase, the application then needs to
create a <code>FullWalletRequest</code>. This will allow the application to request access to
the customer’s <code>FullWallet</code>, which is where the payment
information comes from. To do this, implement <code>onActivityResult</code>.</p>
<div class="code">
  <pre class="language-java numbered" ><code>public class PaymentActivity extends FragmentActivity {
  ...

  @Override
  protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);

    if (requestCode == LOAD_MASKED_WALLET_REQUEST_CODE) { // Unique, identifying constant
      if (resultCode == Activity.RESULT_OK) {
        MaskedWallet maskedWallet = data.getParcelableExtra(WalletConstants.EXTRA_MASKED_WALLET);
        FullWalletRequest fullWalletRequest = FullWalletRequest.newBuilder()
          .setCart(Cart.newBuilder()
            .setCurrencyCode(&quot;USD&quot;)
            .setTotalPrice(&quot;20.00&quot;)
            .addLineItem(LineItem.newBuilder() // Identify item being purchased
              .setCurrencyCode(&quot;USD&quot;)
              .setQuantity(&quot;1&quot;)
              .setDescription(&quot;Premium Llama Food&quot;)
              .setTotalPrice(&quot;20.00&quot;)
              .setUnitPrice(&quot;20.00&quot;)
              .build())
            .build())
          .setGoogleTransactionId(maskedWallet.getGoogleTransactionId())
          .build();
        Wallet.Payments.loadFullWallet(googleApiClient, fullWalletRequest, LOAD_FULL_WALLET_REQUEST_CODE);
      }
    } else if (requestCode == LOAD_FULL_WALLET_REQUEST_CODE) { // Unique, identifying constant
      ...
    }
  }
}</code></pre>
</div>

<p>You can see from this example that you can add line items to the
<code>FullWalletRequest</code>’s cart. The above only has one–Premium Llama Food, but if your customer is purchasing multiple
items, you can add multiple line items by calling <code>addLineItem</code> additional
times.</p>

<h3 id="creating-tokens-android">Creating tokens from Android Pay</h3>

<p>Finally, when the customer allows access to their wallet for payment, the application
will be given back a Stripe token. You will want to send this token to
your server for <a href="#using-tokens">use through the API</a>.</p>
<div class="code">
  <pre class="language-java numbered" ><code>public class PaymentActivity extends FragmentActivity {
  ...
  //keep track of your current environment,
  //change to WalletConstants.ENVIRONMENT_PRODUCTION when you&#39;re ready to go live
  public static final int mEnvironment = WalletConstants.ENVIRONMENT_TEST;

  @Override
  protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (requestCode == LOAD_MASKED_WALLET_REQUEST_CODE) {
      ...
    } else if (requestCode == LOAD_FULL_WALLET_REQUEST_CODE) {
      if (resultCode == Activity.RESULT_OK) {
        FullWallet fullWallet = data.getParcelableExtra(WalletConstants.EXTRA_FULL_WALLET);
        String tokenJSON = fullWallet.getPaymentMethodToken().getToken();

        //A token will only be returned in production mode,
        //i.e. WalletConstants.ENVIRONMENT_PRODUCTION
        if (mEnvironment == WalletConstants.ENVIRONMENT_PRODUCTION) {
          try {
            Token token = TokenParser.parseToken(tokenJSON);
            // TODO: send token to your server
          } catch (JSONException jsonException) {
            // Log the error and notify Stripe helpß
          }
        }
      }
    } else {
      super.onActivityResult(requestCode, resultCode, data);
    }
  }
}</code></pre>
</div>

<h3 id="testing-android-pay">Testing and Deploying with Android Pay</h3>
<p>To test your Android Pay flow, use your live Stripe API key, not your test key, in conjunction with the Android Pay test environment, specified by <code>WalletConstants.ENVIRONMENT_TEST</code>.  In test mode, <code>fullWallet.getPaymentMethodToken().getToken()</code> will return the String <code>"TEST_GATEWAY_TOKEN"</code> in place of a JSON string representing a token.</p>

<p>If you want to test your application on a physical device, the device will need to support NFC. You will also need to add a <a href="https://support.google.com/androidpay/answer/6314169?hl=en">supported credit card</a> to your Android Pay account.</p>

<p>When you are ready to go, <a href="https://androidpay.developers.google.com/signup">register your app</a> to access Android Pay for live transactions.</p></section>

<section>
<h2 id="credit-card-form">Building your own form</h2>

<p>If you build your own payment form, you’ll need to collect at least your
customers’ card numbers and expiration dates. You should likely also
collect the CVC to prevent fraud. You can optionally collect the
user’s name and billing address for additional fraud protection.</p>

<p>Once you’ve collected a customer’s information, you will need to
exchange the information for a Stripe token.</p>

<h3 id="creating-cards">Creating &amp; validating cards from a custom form</h3>

<p>You’ll need to import the Stripe classes before you can use them.</p>
<div class="code">
  <pre class="language-java numbered" ><code>import com.stripe.android.*;</code></pre>
</div>

<p>There are two main classes: <code>Card</code> and <code>Stripe</code>. The <code>Card</code> class
contains a bunch of useful helpers for validating card input on the
client-side, before you even try to create a charge.</p>

<p>Let’s construct a <code>Card</code> instance with your customers’ payment
information, perhaps retrieved from a form.</p>
<div class="code">
  <pre class="language-java numbered" ><code>Card card = new Card(
  cardNumber,
  cardExpMonth,
  cardExpYear,
  cardCVC
);

card.validateNumber();
card.validateCVC();</code></pre>
</div>

<p>As you can see in the example above, the <code>Card</code> instance contains some
helpers to validate that the card number passes the Luhn check, that the
expiration date is the future, and that the CVC looks valid. You’ll probably want
to validate these three things at once, so we’ve included a
<code>validateCard</code> function that does so.</p>
<div class="code">
  <pre class="language-java numbered" ><code>Card card = new Card(&quot;4242-4242-4242-4242&quot;, 12, 2018, &quot;123&quot;);

if (!card.validateCard()) {
  // Show errors
}</code></pre>
</div>

<h3 id="creating-tokens-custom">Creating tokens from a custom form</h3>

<p>The next step is to pass off that sensitive payment information securely
to Stripe, where you’ll exchange it for a token. You can create tokens
using the <code>Stripe</code> instance method <code>createToken</code>, passing in a <code>Card</code>
instance, and completion callbacks. An asynchronous network request will
be executed, and the appropriate callback invoked when it completes.</p>
<div class="code">
  <pre class="language-java numbered" ><code>Card card = new Card(&quot;4242424242424242&quot;, 12, 2018, &quot;123&quot;);

Stripe stripe = new Stripe(&quot;pk_test_6pRNASCoBOKtIshFeQd4XMUh&quot;);
stripe.createToken(
  card,
  new TokenCallback() {
    public void onSuccess(Token token) {
      // Send token to your server
    }
    public void onError(Exception error) {
      // Show localized error message
      Toast.makeText(getContext(),
        error.getLocalizedString(getContext()),
        Toast.LENGTH_LONG
      ).show();
    }
  }
)</code></pre>
</div>

<p>We’ve placed your <strong>test publishable</strong> API key as the first argument to
<code>Stripe</code>. You’ll need to swap it out with your <strong>live</strong> publishable key
in production. You can see all your keys in <a href="https://dashboard.stripe.com/account/apikeys">your
dashboard</a>.</p></section>

<section>
<h2 id="using-tokens">Using tokens</h2>

<p>Using the payment token, however it was obtained, requires an API call from your server using your secret API key. (For security purposes, you should never embed your secret API key in your app.)</p>

<p>Set up an endpoint on your server that can receive an HTTP POST call for the token. In the <code>onActivityResult</code> method (for Android Pay) or the <code>onSuccess</code> callback (when using your own form), you’ll need to POST the supplied token to your server. Make sure any communication with your server is <a href="../security.html">SSL secured</a> to prevent eavesdropping.</p>

<p>Take a look at the full <a href="https://github.com/stripe/stripe-android/tree/master/example">example application</a> to see everything put together.</p></section>

<section>
<h2 id="next-up">Next Up</h2>

<p>Once you’ve retrieved a token from Stripe on your server, you’re going to want to do something with the payment details you just collected. This is usually one of two things:</p>
<ul class="next-steps">
    <li><a href="../charges.html"><span>Charge your user immediately</a></li>
    <li><a href="../subscriptions/quickstart.html"><span>Create a subscription</a></li>
</ul>

</section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/mobile/android by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:44:02 GMT -->
</html>
