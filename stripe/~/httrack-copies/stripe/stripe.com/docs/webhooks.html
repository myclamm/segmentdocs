<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/webhooks by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:44:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="0ZsWyFdUNAjNKIJGry-xGNFKALbSiCLQAIngjtuXzVVIAQK1UZHwTQBsplljJ4Rj-DSOMY4k43BBPOqmfkAHJA==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Using Webhooks</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../img/v3/home/social.png">

    <meta property="og:title" content="Using Webhooks">
    <meta property="og:url" content="webhooks.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Using Webhooks">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../index.html" title="Stripe"></a>
          <a class="extension" href="../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="checkout/tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="disputes/types.html">Types</a>
    </li>
    <li>
      <a href="disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="sources.html">Getting Started</a>
    </li>
    <li>
      <a href="sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="ach.html">ACH</a>
    </li>
    <li>
      <a href="apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="alipay.html">Alipay</a>
    </li>
    <li>
      <a href="bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="connect.html">Overview</a>
    </li>
    <li>
      <a href="connect/connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="connect/authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="connect/standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="connect/reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="connect/managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="connect/updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="connect/identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="connect/required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="connect/testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="connect/bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="connect/migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="connect/best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="connect/payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="connect/special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="connect/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="radar.html">Overview</a>
    </li>
    <li>
      <a href="radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul>
    <li>
      <a href="libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a class='selected' href="webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="recipes.html">Recipes</a>
    </li>
    <li>
      <a href="security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Using Webhooks</h1>
  <p>
    Use webhooks to be notified about events that happen in a Stripe account.
    If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=webhooks">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.

  </p>
</header>

<section>
  <aside class="note">
    <h3>Webhook terminology</h3>
    <p>An <em>event</em> is an account occurrence, such as a charge being captured, a transfer paid, or an account being updated. Each occurrence has a corresponding <code>Event</code> object.</p>
    <p><em>Webhook endpoints</em> are URLs defined by users to which Stripe sends events. A single event may be sent to many webhook endpoints.</p>
    <p><em>Webhooks</em> refers to the overall concept of sending notifications to webhook endpoints.</p>
  </aside>

  <p>Interacting with a third-party API like Stripe's can introduce two problems:</p>

  <ul>
    <li>Services not directly responsible for making an API request may still need to know the response of that request</li>
    <li>Some events, like disputed charges and many recurring billing events, are not the result of a direct API request</li>
  </ul>

  <p>Webhooks solve these problems by letting you register a URL that we will notify anytime an event happens in your account. When the event occurs&mdash;for example, when a successful charge is made on a customer's subscription, Stripe creates an <code>Event</code> object. This object contains all the relevant information about what just happened, including the type of event and the data associated with that event. Stripe then sends the <code>Event</code> object to any URLs in your account's webhooks settings via an HTTP POST request.  You can find a full list of all event types in the <a href="api.html#event_types">API docs</a>.</p>

  <p>You might use webhooks as the basis to:</p>

  <ul>
    <li>Update a customer's membership record in your database when a subscription payment succeeds</li>
    <li>Email a customer when a subscription payment fails</li>
    <li>Check out the Dashboard if you see that a dispute was filed</li>
    <li>Make adjustments to an invoice when it's created (but before it's been paid)</li>
    <li>Log an accounting entry when a transfer is paid</li>
  </ul>

  <p>Understand that you only need to use webhooks for behind-the-scenes transactions. The results of most Stripe requests&mdash;including charge attempts and customer creations&mdash;are reported synchronously to your code, and don't require webhooks for verification. (For example, with a charge request, the charge will immediately succeed and a <code>Charge</code> object returned, or the charge will immediately fail and an exception will be thrown.)</p>
</section>

<section>
  <h2 id="configuring-your-webhook-settings">Configuring your webhook settings</h2>

  <aside class="note">
    <h3>Common webhook mistakes</h3>
    <p>The two most common mistakes with webhooks are providing the wrong URL in the Dashboard and the webhook endpoint not returning a <code>200</code> status code.</p>
  </aside>

  <p>Webhooks are configured in the <a href="https://dashboard.stripe.com/account/webhooks" target="_blank">webhooks settings</a> section of the Dashboard. Clicking <strong>Add endpoint</strong> reveals a form to add a new URL for receiving webhooks.</p>

  <p>Stripe supports two webhook types: Account and Connect. You'll likely want to create an account webhook, unless you've created a <a href="connect.html">Connect application</a>.</p>

  <p>You can enter any URL you'd like to have events sent to, but this should be a dedicated page on your server, coded per the instructions below. The mode determines whether test events or live events are sent to this URL; if you want to send both live and test events to the same URL, you need to create two separate settings. You may add as many URLs as you like, and <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">basic access authentication</a> is supported.</p>

  <p>You can also choose to be notified of all event types, or only specific ones.</p>
</section>

<section>
  <h2 id="receiving-a-webhook">Receiving a webhook notification</h2>

  <p>Creating a webhoook endpoint on your server is no different from creating any page on your website. With PHP, you might create a new <strong>.php</strong> file on your server; with a framework like Sinatra, you would add a new route with the desired URL.</p>

  <p>Webhook data is sent as JSON in the POST request body. The full event details are included and can be used directly, after parsing the JSON into an <a href="api.html#event_object">Event object</a>.</p>

  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

require &quot;json&quot;

# Using Sinatra
post &quot;/my/webhook/url&quot; do
  # Retrieve the request&#39;s body and parse it as JSON
  event_json = JSON.parse(request.body.read)

  # Do something with event_json

  status 200
end
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

import json
from django.http import HttpResponse

# Using Django
def my_webhook_view(request):
  # Retrieve the request&#39;s body and parse it as JSON
  event_json = json.loads(request.body)

  # Do something with event_json

  return HttpResponse(status=200)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Retrieve the request&#39;s body and parse it as JSON
$input = @file_get_contents(&quot;php://input&quot;);
$event_json = json_decode($input);

// Do something with $event_json

http_response_code(200); // PHP 5.4 or greater
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

// Using Spark framework (http://sparkjava.com)
public Object handle(Request request, Response response) {
  // Retrieve the request&#39;s body and parse it as JSON
  Event eventJson = APIResource.GSON.fromJson(request.body(), Event.class);

  // Do something with eventJson

  response.status(200);
  return &quot;&quot;;
}
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Using Express
app.post(&quot;/my/webhook/url&quot;, function(request, response) {
  // Retrieve the request&#39;s body and parse it as JSON
  var event_json = JSON.parse(request.body);

  // Do something with event_json

  response.send(200);
});
</code></pre>
</div>

    </div>
  </div>

  <h3 id="receiving-webooks-with-csrf-protection">Receiving webhooks with a CSRF-protected server</h3>

  <p>
    If you're using Rails, Django, or another web framework, your site may automatically check that every POST request
    contains a <em>CSRF token</em>. This is an important security feature that helps protect you and your users from
    <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)">cross-site request forgery</a> attempts. However, this security measure may
    also prevent your site from processing legitimate webhooks. If so, you may need to exempt the webhooks route from CSRF protection.
  </p>

  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="ruby"
           >Rails</a>
        <a data-language="python"
           >Django</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

class StripeController &lt; ApplicationController
  # If your controller accepts requests other than Stripe webhooks,
  # you&#39;ll probably want to use `protect_from_forgery` to add CSRF
  # protection for your application. But don&#39;t forget to exempt
  # your webhook route!
  protect_from_forgery :except =&gt; :webhook

  def webhook
    # Process webhook data in `params`
  end
end
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

import json

# Webhooks are always sent as HTTP POST requests, so we want to ensure
# that only POST requests will reach your webhook view. We can do that by
# decorating `webhook()` with `require_POST`.
#
# Then to ensure that the webhook view can receive webhooks, we need
# also need to decorate `webhook()` with `csrf_exempt`.
@require_POST
@csrf_exempt
def webhook(request):
  # Process webhook data in `request.body`
</code></pre>
</div>

    </div>
  </div>

  <h3 id="receiving-webhooks-with-an-https-server">Receiving webhooks with an HTTPS server</h3>

  <p>If you use an HTTPS URL for your webhook endpoint, Stripe will validate that the connection to your server is secure before sending your webhook data. For this to work, your server must be correctly configured to support HTTPS with a valid server certificate. See our <a href="security.html">guide on SSL/TLS</a> for details on setting this up.</p>
</section>

<section>
  <h2 id="responding-to-a-webhook">Responding to a webhook</h2>

  <p>To acknowledge receipt of a webhook, your endpoint should return a <code>2xx</code> HTTP status code. Any other information returned in the request headers or request body is ignored. All response codes outside this range, including <code>3xx</code> codes, will indicate to Stripe that you did not receive the webhook. This does mean that a URL redirection or a "Not Modified" response will be treated as a failure.</p>

  <p>If a webhook is not successfully received for any reason, Stripe will continue trying to send the webhook once an hour for up to 3 days. Webhooks cannot be manually retried after this time, though you can <a href="api.html#retrieve_event">query for the event</a> to reconcile your data with any missed events.</p>

  <p>When viewing a specific event information through the <a href="https://dashboard.stripe.com/events">Dashboard</a>, you can check how many times we've attempted to send an event to an endpoint by clicking on that endpoint URL in the <strong>Webhook details</strong> section. This will show you the latest response we received from your endpoint, along with a list of all attempted webhooks and the respective HTTP status codes we received.</p>
</section>

<section>
  <h2 id="verifying-events">Verifying events</h2>

  <p>As an extra security measure, you can verify an event with Stripe before acting upon it. Just use the event ID that your webhook received to directly retrieve the event details from Stripe:</p>

  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

require &quot;json&quot;

# Using Sinatra
post &quot;/my/webhook/url&quot; do
  # Retrieve the request&#39;s body and parse it as JSON
  event_json = JSON.parse(request.body.read)

  # Verify the event by fetching it from Stripe
  event = Stripe::Event.retrieve(event_json[&quot;id&quot;])

  # Do something with event

  status 200
end
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

import json
from django.http import HttpResponse

# Using Django
def my_webhook_view(request):
  # Retrieve the request&#39;s body and parse it as JSON
  event_json = json.loads(request.body)

  # Verify the event by fetching it from Stripe
  event = stripe.Event.retrieve(event_json[&quot;id&quot;])

  # Do something with event

  return HttpResponse(status=200)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Retrieve the request&#39;s body and parse it as JSON
$input = @file_get_contents(&quot;php://input&quot;);
$event_json = json_decode($input);

// Verify the event by fetching it from Stripe
$event = \Stripe\Event::retrieve($event_json-&gt;id);

// Do something with $event

http_response_code(200); // PHP 5.4 or greater
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

// Using Spark framework (http://sparkjava.com)
public Object handle(Request request, Response response) {
  // Retrieve the request&#39;s body and parse it as JSON
  Event eventJson = APIResource.GSON.fromJson(request.body(), Event.class);

  // Verify the event by fetching it from Stripe
  Event event = Event.retrieve(eventJson.getId());

  // Do something with event

  response.status(200);
  return &quot;&quot;;
}
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Using Express
app.post(&quot;/my/webhook/url&quot;, function(request, response) {
  // Retrieve the request&#39;s body and parse it as JSON
  var event_json = JSON.parse(request.body);

  // Verify the event by fetching it from Stripe
  stripe.events.retrieve(event_json.id, function(err, event) {
    // Do something with event

    response.send(200);
  });
});
</code></pre>
</div>

    </div>
  </div>

  <p>If successful, the result of the <code>retrieve</code> call will be an <a href="api.html#events"><code>Event</code></a> object.</p>
</section>

<section>
  <h2 id="best-practices">Best practices</h2>

  <p>Before going live, test that your webhook is working properly. You can do so by sending dummy test events from the <a href="https://dashboard.stripe.com/account/webhooks" target="_blank">webhooks settings</a> pane. Understand that as these are fake, test events, they will not map to real customers, invoices, charges, or other objects in your account.</p>

  <p>If your webhook script performs complex logic, or makes network calls, it's possible the script would timeout before Stripe sees its complete execution. For that reason, you may want to have your webhook endpoint immediately acknowledge receipt by returning a <code>2xx</code> HTTP status code, and then perform the rest of its duties.</p>

  <p>Webhook endpoints may occasionally receive the same event more than once. We advise you to guard against  duplicated event receipts by making your event processing <a href="https://en.wikipedia.org/wiki/Idempotence">idempotent</a>. One way of doing this is logging the events you've processed, and then not processing already-logged events.</p>

</section>

<section>
  <h2 id="webhooks-and-api-versions">Webhooks and API versions</h2>

  <p>The structure of an <code>Event</code> object sent in a webhook is dictated by the API version in your account settings at the time of the event's occurrence. For example, if your account is set to an older API version, such as <strong>2015-02-16</strong>, and you change the API version for a specific request via <a href="api.html#versioning">versioning</a>, the <code>Event</code> object generated still aligns with the <strong>2015-02-16</strong> API version.</p>

  <p><code>Event</code> objects will never be changed after the fact. Subsequent updates to your account's API version do not retroactively alter existing <code>Event</code> objects. Fetching older events using a newer API version also has no impact on the event's structure.</p>
</section>

<section>
  <h2 id="next_steps">More information</h2>
<ul class="next-steps">
    <li><a href="api.html#event_types"><span>List of all event types</a></li>
    <li><a href="ips.html"><span>List of IP addresses Stripe uses</a></li>
    <li><a href="recipes/sending-emails-for-failed-payments.html"><span>Recipe for sending emails to customers for failed subscription payments</a></li>
</ul>

</section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/webhooks by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:44:28 GMT -->
</html>
