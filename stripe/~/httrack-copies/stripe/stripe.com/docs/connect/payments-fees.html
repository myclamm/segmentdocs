<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/connect/payments-fees by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:45:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="zVWw-OyfjMbfjBMEKbSCJGATQoPXYMAafGPDwt23ZrZUz6SF6lpIgxLINxvlvLdfSW3MBIvMAbo91snqeGCsxw==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Creating Payments and Collecting Fees</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Creating Payments and Collecting Fees">
    <meta property="og:url" content="payments-fees.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Creating Payments and Collecting Fees">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="../checkout/tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="../mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="../subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="../subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="../subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="../subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="../subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="../subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="../subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="../subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="../subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="../subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="../subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a class='selected' href="payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Creating Payments and Fees</h1>
  <p>With Connect, you can make charges and create subscriptions on behalf of connected users, optionally taking transaction fees in the process. If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=connect">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
</header>

<section>
  <aside class="note">
    <h3>Connect</h3>
    <p>Don't know much about Connect yet? Check out the <a href="../connect.html">overview</a>.</p>
  </aside>

<p>Connect allows you to use the full <a href="../api.html">Stripe API</a> on behalf of your connected users. This means, among <a href="../api.html">other functionality</a>, you can:</p>

<ul>
  <li><a href="#creating-payments">Create payments</a> or set up <a href="#creating-subscriptions">recurring billing</a></li>
  <li>Collect <a href="#collecting-fees">application fees</a> for your platform</li>
  <li><a href="#issuing-refunds">Issue refunds</a></li>
</ul></section>

<section>
<h2 id="creating-payments">Creating payments</h2>

<aside class="note">
  <h3>Chargebacks and refunds</h3>
  <p>If you’ve opted to <a href="managed-accounts.html">directly manage</a> the accounts on your platform, you’ll still be ultimately <a href="bank-transfers.html#negative-balances">responsible</a> for any negative balances your users cannot cover.</p>
</aside>

<p>There are two ways to create a charge on behalf of a connected account:</p>

<ul>
  <li>Create the charge directly on the connected account.</li>
  <li>Create the charge on the platform’s account, but set a <code>destination</code> parameter identifying the Stripe account that should receive the funds from the payment.</li>
</ul>

<p>With the first approach, the connected account is responsible for the fees, refunds, and chargebacks. The payment itself will appear as a charge in the connected account.</p>

<p>The latter, new approach provides much more customizability but makes the platform account responsible for the fees, refunds, and chargebacks. The payment appears as a charge in the platform account, along with a transfer from the platform account to the connected account.</p>

<h3 id="charging-directly">Charging directly</h3>

<p>Processing a charge directly on a connected account requires <a href="authentication.html">authentication</a>, best achieved by providing the platform account’s secret key and the <code>Stripe-Account</code> header:</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges \
   -u {PLATFORM_SECRET_KEY}: \
   -H &quot;Stripe-Account: {CONNECTED_STRIPE_ACCOUNT_ID}&quot; \
   -d amount=1000 \
   -d currency=usd \
   -d source=&quot;{TOKEN}&quot;
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

Stripe::Charge.create({
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {TOKEN}
}, {:stripe_account =&gt; CONNECTED_STRIPE_ACCOUNT_ID})
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={TOKEN},
  stripe_account={CONNECTED_STRIPE_ACCOUNT_ID}
)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

\Stripe\Charge::create(array(
  &#39;amount&#39; =&gt; 1000,
  &#39;currency&#39; =&gt; &#39;usd&#39;,
  &#39;source&#39; =&gt; {TOKEN}
), array(&#39;stripe_account&#39; =&gt; CONNECTED_STRIPE_ACCOUNT_ID));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

RequestOptions requestOptions = RequestOptions.builder().setStripeAccount(CONNECTED_STRIPE_ACCOUNT_ID).build();
Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;source&quot;, {TOKEN});

Charge.create(chargeParams, requestOptions);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.charges.create({
  amount: 1000,
  currency: &#39;usd&#39;,
  source: {TOKEN}
}, {stripe_account: {CONNECTED_STRIPE_ACCOUNT_ID}});
</code></pre>
</div>

    </div>
  </div>

  <aside class="note">
    <h3>Stripe.js</h3>
    <p>We require <a href="../stripe.html">Stripe.js</a> for all platforms&mdash;you cannot send credit card data directly from your server.</p>
  </aside>

<p>When charging directly on a connected account, you can provide a token created using either the platform’s or the connected account’s publishable key. (When using direct charging of a saved customer, not a token, the <code>Customer</code> object must exist within the connected account, not within the platform account.)</p>

<p>Charges created directly on a connected account will only be available on that account—you won’t see it in your platform’s Dashboard or reporting.</p>

<h3 id="charging-through-the-platform">Charging through the platform</h3>

<p>The second way to perform a charge on behalf of a connected account is to create it on your platform’s Stripe account and use the <code>destination</code> parameter–specifying the connected account ID–in the charge request.</p>

<p>You’ll want to charge through the platform if you’d like to keep all of your charge data on one account (e.g., for aggregated reporting) or if you’d like to have greater flexibility over fees and what customers see on their credit card statement. If you’re <a href="managed-accounts.html">managing Stripe accounts</a>, we recommend that you create charges directly on your platform.</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges \
   -u {PLATFORM_SECRET_KEY}: \
   -d amount=1000 \
   -d currency=usd \
   -d source=&quot;{TOKEN}&quot; \
   -d destination=&quot;{CONNECTED_STRIPE_ACCOUNT_ID}&quot;
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

Stripe::Charge.create({
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {TOKEN},
  :destination =&gt; {CONNECTED_STRIPE_ACCOUNT_ID}
})
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={TOKEN},
  destination={CONNECTED_STRIPE_ACCOUNT_ID}
)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

\Stripe\Charge::create(array(
  &#39;amount&#39; =&gt; 1000,
  &#39;currency&#39; =&gt; &#39;usd&#39;,
  &#39;source&#39; =&gt; {TOKEN},
  &#39;destination&#39; =&gt; {CONNECTED_STRIPE_ACCOUNT_ID}
));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;source&quot;, {TOKEN});
chargeParams.put(&quot;destination&quot;, {CONNECTED_STRIPE_ACCOUNT_ID});

Charge.create(chargeParams);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.charges.create({
  amount: 1000,
  currency: &#39;usd&#39;,
  source: {TOKEN},
  destination: {CONNECTED_STRIPE_ACCOUNT_ID}
});
</code></pre>
</div>

    </div>
  </div>

<p>When you use the <code>destination</code> parameter:</p>

<ul>
  <li>The entire amount of the charge will be immediately transferred to the destination account. The ID of the resulting transfer will be returned in the <code>transfer</code> field of the response.</li>
  <li>The Stripe fee comes out of the charge object on the platform’s account (i.e., you pay the fee).</li>
  <li>The amount specified by the <code>application_fee</code> parameter (if provided) will be deducted from the total amount and credited to the platform’s account.</li>
  <li>The charge will be attributed to the destination account for tax reporting.</li>
  <li>When using a token as the payment source, the token must be created using the platform’s publishable key. If charging a <code>Customer</code> object, the <code>Customer</code> must exist within the platform’s account.</li>
  <li>The charge will be settled in the default currency of the destination account. The platform will also take its <code>application_fee</code> in this currency, accumulating balances in the currency of the destination account. If the platform does not have a bank account in this currency, the platform may manually <a href="payments-fees.html#handling-balances-in-multiple-currencies">convert these balances to another currency</a>.</li>
</ul>

<p>As you can tell from that list, this approach also creates more objects within Stripe than processing the charge on the connected account directly. The destination account receives a charge object. The platform account will have the charge object and a transfer (the transfer is tied to the destination account’s charge). The platform account will have an application fee object, too, if an <a href="#collecting-fees">application fee was set</a>. Note, as well, that the Stripe fee is paid by the platform account in this case.</p>

<p>This may seem complicated, but such complexity is necessary to handle many edge cases of currency conversion and possible refunds. This structure allows each part of the flow to be refunded independently of others. For example, you can choose to refund the charge to a customer’s credit card with or without reversing the transfer to the connected account, and with or without reversing the application fee you took.</p></section>

<section>
<h2 id="collecting-fees">Collecting application fees</h2>

<p>With Connect, your platform can take an application fee on charges, <a href="#creating-subscriptions">subscriptions</a>, and even on <a href="special-case-transfers.html#taking-application-fees-from-a-transfer">transfers</a>.</p>

<p>There are three things to note about application fees, whenever they are requested:</p>

<ul>
  <li>The <code>application_fee</code> parameter must be a positive integer (e.g., an amount in cents)</li>
  <li>The <code>application_fee</code> will be capped at the total transaction amount minus any Stripe fees—no error will be thrown for application fees that are automatically capped</li>
  <li>No Stripe fees are applied to the application fee</li>
</ul>

<p>The <code>application_fee</code> is always specified in the same currency as the
transaction. For direct charges, application fees are collected in the
platform’s default currency. When charging through the platform with the
<code>destination</code> parameter, the application fee is collected in the settlement
currency of the connected account.</p>

<h3 id="fees-on-charges">Fees on charges</h3>

<p>To charge a fee on top of Stripe’s fees for a one-off charge, all you need to do is pass in the optional <code>application_fee</code> parameter (in cents) when <a href="../api.html#create_charge">creating the charge</a>.</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges \
   -u {PLATFORM_SECRET_KEY}: \
   -H &quot;Stripe-Account: {CONNECTED_STRIPE_ACCOUNT_ID}&quot; \
   -d amount=1000 \
   -d currency=usd \
   -d source=&quot;{TOKEN}&quot; \
   -d description=&quot;payinguser@example.com&quot; \
   -d application_fee=123
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Get the credit card details submitted by the form
token = params[:stripeToken]

# Create the charge with Stripe
charge = Stripe::Charge.create({
    :amount =&gt; 1000, # amount in cents
    :currency =&gt; &quot;usd&quot;,
    :source =&gt; token,
    :description =&gt; &quot;Example charge&quot;,
    :application_fee =&gt; 123 # amount in cents
  },
  {:stripe_account =&gt; CONNECTED_STRIPE_ACCOUNT_ID}
)
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Get the credit card details submitted by the form
token = request.POST[&#39;stripeToken&#39;]

# Create the charge with Stripe
charge = stripe.Charge.create(
  amount=1000, # amount in cents
  currency=&quot;usd&quot;,
  source=token,
  description=&quot;Example charge&quot;,
  application_fee=123, # amount in cents
  stripe_account=CONNECTED_STRIPE_ACCOUNT_ID
)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Get the credit card details submitted by the form
$token = $_POST[&#39;stripeToken&#39;];

// Create the charge with Stripe
$charge = \Stripe\Charge::create(
  array(
    &quot;amount&quot; =&gt; 1000, // amount in cents
    &quot;currency&quot; =&gt; &quot;usd&quot;,
    &quot;source&quot; =&gt; $token,
    &quot;description&quot; =&gt; &quot;Example charge&quot;,
    &quot;application_fee&quot; =&gt; 123 // amount in cents
  ),
  array(&quot;stripe_account&quot; =&gt; CONNECTED_STRIPE_ACCOUNT_ID)
);
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

// Get the credit card details submitted by the form
String token = request.getParameter(&quot;stripeToken&quot;);

// Create the charge with Stripe
Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000); // amount in cents
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;source&quot;, token);
chargeParams.put(&quot;description&quot;, &quot;Example charge&quot;);
chargeParams.put(&quot;application_fee&quot;, 123); // amount in cents

RequestOptions requestOptions = RequestOptions.builder().setStripeAccount(CONNECTED_STRIPE_ACCOUNT_ID).build();

Charge charge = Charge.create(chargeParams, requestOptions);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Get the credit card details submitted by the form
var token = request.body.stripeToken;

// Create the charge with Stripe
stripe.charges.create(
  {
    amount: 1000, // amount in cents
    currency: &quot;usd&quot;,
    source: token,
    description: &quot;Example charge&quot;,
    application_fee: 123 // amount in cents
  },
  {stripe_account: CONNECTED_STRIPE_ACCOUNT_ID},
  function(err, charge) {
    // check for `err`
    // do something with `charge`
  }
);
</code></pre>
</div>

    </div>
  </div>

<p>The resulting charge’s <a href="../api.html#retrieve_balance_transaction">balance transaction</a> will include a detailed fee breakdown:</p>
<div class="code">
  <pre class="language-javascript numbered" ><code>{
  &quot;object&quot;: &quot;balance_transaction&quot;,
  &quot;type&quot;: &quot;charge&quot;,
  &quot;amount&quot;: 1000,
  &quot;currency&quot;: &quot;usd&quot;,
  &quot;fee&quot;: 182,
  ...
  &quot;fee_details&quot;: [
    {
      &quot;type&quot;: &quot;stripe_fee&quot;,
      &quot;amount&quot;: 59,
      &quot;application&quot;: null,
      &quot;currency&quot;: &quot;usd&quot;
    },
    {
      &quot;type&quot;: &quot;application_fee&quot;,
      &quot;amount&quot;: 123,
      &quot;application&quot;: &quot;ca_32D88BD1qLklliziD7gYQvctJIhWBSQ7&quot;,
      &quot;currency&quot;: &quot;usd&quot;
    }
  ]
}</code></pre>
</div>

<h3 id="flow-of-funds">Flow of funds</h3>

<p>When you specify an application fee on a charge–either by creating the charge or through recurring billing, the fee amount will be transferred to your (the platform owner’s) Stripe account. If you process a charge directly on a connected account, the charge amount, less the Stripe fees and application fees, will be deposited into the connected user’s account. For example, if a charge of $10 is made as in the example above, $1.23 will be transferred to your account, and $8.18 cents ($10 - $0.59 - $1.23) will be transferred to your connected user’s account.</p>

<p>If you process a charge on the platform account, and use the <code>destination</code> parameter, the charge amount less the application fee will be deposited into the connected user’s account ($8.77, assuming a $1.23 application fee on a $10 charge). The application fee less the Stripe fees (on the charge amount) will be deposited into your account ($0.64, which is $1.23 - $0.59).</p>

<p>Any application fees earned will become available to your Stripe account on the normal 2-day rolling basis, just like funds from regular Stripe charges. Application fees are viewable in the <a href="https://dashboard.stripe.com/applications/fees">Collected Fees</a> section of the Dashboard.</p>

<h3 id="refunding-fees">Refunding Fees</h3>

<p>When a charge is refunded, the end customer will always be refunded the full amount of the charge. Stripe will never automatically refund the application fee: you must explicitly refund the application fee, or your connected user—the account on which the charge was created—will eat the cost of the fee.</p>

<p>You can refund application fees incurred by your application in several ways:</p>

<ul>
  <li>From the <a href="https://dashboard.stripe.com/applications/fees">dashboard</a>.</li>
  <li>Upon <a href="../api.html#create_refund">refunding a charge</a> (passing <code>refund_application_fee</code> will refund the application fee proportional to the amount of the charge refunded, as of <a href="../upgrades.html#2013-12-03">December 3, 2013</a>).</li>
  <li>Using the <a href="../api.html#application_fees">application fees API</a>.</li>
</ul></section>

<section>
<h2 id="creating-subscriptions">Creating subscriptions</h2>

<p>Through Connect, you can create subscriptions on connected user accounts. You can also take an application fee percentage on those subscription payments. Both the customer and the plan must be defined on the connected account in order to create the subscription.</p>

<p>Subscriptions do not currently support the <code>destination</code> parameter: they can only be created directly on the connected account. But as with creating charges directly on a connected account, you can create a customer and a subscription in a connected account using a token created with either the platform’s or the connected account’s publishable key.</p>

<h3 id="fees-on-subscriptions">Fees on subscriptions</h3>

<p>When creating or updating a subscription, you can specify an <code>application_fee_percent</code> parameter as an integer between 1 and 100. Each billing period, Stripe takes that percentage off the final invoice amount—including any bundled invoice items, discounts, or account balance adjustments—as a fee for your application, on top of any Stripe fees charged.</p>

<p>For example, take this scenario:</p>

<ul>
  <li>The subscription cost per billing cycle is $100</li>
  <li>There’s a $10 invoice item</li>
  <li>A 50% coupon applies</li>
  <li>The <code>application_fee_percent</code> is 10</li>
</ul>

<p>In that case, the total application fee taken will be $5.50: ($100 + $10) * 50% * 10%.</p>

<p>Application fees on subscriptions must be a percentage, as the amount billed via subscriptions often varies. You cannot set a flat amount for the application fee on a subscription, but can on an invoice as explained below.</p>

<p>To create a subscription without an application fee, omit the <code>application_fee_percent</code> argument.</p>

<h3 id="prorations-and-invoice-items">Prorations and Invoice Items</h3>

<p>Invoices created outside of a subscription billing period will not have the <code>application_fee_percent</code> applied to them. This includes proration invoice items that are immediately invoiced. You’ll need to set an <code>application_fee</code> on the invoice directly for the application fee amount you’d like to charge (see below).</p>

<p>If you’re not planning to create extra invoices, prorations will be automatically bundled into the next billing cycle and will automatically inherit the <code>application_fee_percent</code> set on the updated subscription.</p>

<h3 id="invoices">Invoices</h3>

<p>If you’d like to charge a flat or dynamic fee, or otherwise any fee that can’t be automatically calculated with <code>application_fee_percent</code>, you can add an <code>application_fee</code> directly on the invoice. (Usually this is done programmatically upon receiving an <code>invoice.created</code> webhook notification, although you can separately create an invoice for pending invoice items and set an application fee on it.)</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code># Update the invoice with an application_fee to be applied when the
# invoice is paid
curl https://api.stripe.com/v1/invoices/{INVOICE_ID} \
   -u {PLATFORM_SECRET_KEY}: \
   -H &quot;Stripe-Account: {CONNECTED_STRIPE_ACCOUNT_ID}&quot; \
   -d application_fee=100
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Update the invoice with an application_fee to be applied when the
# invoice is paid
invoice.application_fee = 100 # amount in cents
invoice.save
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Update the invoice with an application_fee to be applied when the
# invoice is paid
invoice.application_fee = 100 # amount in cents
invoice.save()
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Update the invoice with an application_fee to be applied when the
// invoice is paid
$invoice-&gt;application_fee = 100; // amount in cents
$invoice-&gt;save();
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

// Update the invoice with an application_fee to be applied when the
// invoice is paid
Map&lt;String, Object&gt; invoiceParams = new HashMap&lt;String, Object&gt;();
invoiceParams.put(&quot;application_fee&quot;, 100); // amount in cents
invoice.update(invoiceParams, requestOptions);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Update the invoice with an application_fee to be applied when the
// invoice is paid
stripe.invoices.update(
  invoiceId,
  {application_fee: 100},
  {stripe_account: CONNECTED_STRIPE_ACCOUNT_ID},
  function(err, invoice) {}
);
</code></pre>
</div>

    </div>
  </div>

<p>The <code>application_fee</code> set directly on an invoice overrides any application fee amount calculated with <code>application_fee_percent</code>, and will be capped at the invoice’s final charge amount.</p>

<h3 id="permissions">Permissions</h3>

<p>You cannot update or cancel a subscription that was not created by your application. You also can’t add an <code>application_fee</code> to an invoice that was not created by your application or that contains invoice items belonging to another application.</p></section>

<section>
<h2 id="issuing-refunds">Issuing refunds on charges</h2>
  <p>Charges created on the platform account can be refunded using the platform account's secret key:</p>

  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges/{CHARGE_ID}/refunds \
   -u {PLATFORM_SECRET_KEY}: \
   -d amount=1000
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = Stripe::Charge.retrieve(CHARGE_ID)
ch.refunds.create(:amount =&gt; 1000)
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = stripe.Charge.retrieve(CHARGE_ID)
ch.refunds.create(amount=1000)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$ch = \Stripe\Charge::retrieve(CHARGE_ID);
$ch-&gt;refunds-&gt;create(array(&#39;amount&#39; =&gt; 1000));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Charge ch = Charge.retrieve(CHARGE_ID);

Map&lt;String, Object&gt; refundParams = new HashMap&lt;String, Object&gt;();
refundParams.put(&quot;amount&quot;, 1000);

ch.refund(refundParams);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.charges.createRefund(
  CHARGE_ID,
  {amount: 1000},
  function(err, refund) {}
);
</code></pre>
</div>

    </div>
  </div>

  <p>Charges created on a connected account can be refunded simply by authenticating the platform and identifying the connected account:</p>

  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges/{CHARGE_ID}/refunds \
   -u {PLATFORM_SECRET_KEY}: \
   -H &quot;Stripe-Account: {CONNECTED_STRIPE_ACCOUNT_ID}&quot; \
   -d amount=1000
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = Stripe::Charge.retrieve(CHARGE_ID, :stripe_account =&gt; CONNECTED_STRIPE_ACCOUNT_ID)
ch.refunds.create(:amount =&gt; 1000)
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = stripe.Charge.retrieve(CHARGE_ID, stripe_account=CONNECTED_STRIPE_ACCOUNT_ID)
ch.refunds.create(amount=1000)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$ch = \Stripe\Charge::retrieve(CHARGE_ID, array(&#39;stripe_account&#39; =&gt; CONNECTED_STRIPE_ACCOUNT_ID));
$ch-&gt;refunds-&gt;create(array(&#39;amount&#39; =&gt; 1000));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

RequestOptions requestOptions = RequestOptions.builder().setStripeAccount(CONNECTED_STRIPE_ACCOUNT_ID).build();
Charge ch = Charge.retrieve(CHARGE_ID, requestOptions);

Map&lt;String, Object&gt; refundParams = new HashMap&lt;String, Object&gt;();
refundParams.put(&quot;amount&quot;, 1000);

ch.refund(refundParams);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.charges.createRefund(
  CHARGE_ID,
  {amount: 1000},
  {stripe_account: CONNECTED_STRIPE_ACCOUNT_ID},
  function(err, refund) {}
);
</code></pre>
</div>

    </div>
  </div>

<p>When refunding a charge that has a <code>destination</code> value, by default the destination account will keep the funds that were transferred to it, leaving the platform account to cover the negative balance from the refund. To pull back the funds from the connected account to cover the refund, set the <code>reverse_transfer</code> parameter to true when creating the refund:</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/charges/{CHARGE_ID}/refunds \
   -u {PLATFORM_SECRET_KEY}: \
   -d amount=1000 \
   -d reverse_transfer=true
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = Stripe::Charge.retrieve(CHARGE_ID)
ch.refunds.create(:amount =&gt; 1000, :reverse_transfer =&gt; true)
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

ch = stripe.Charge.retrieve(CHARGE_ID)
ch.refunds.create(amount=1000, reverse_transfer=true)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$ch = \Stripe\Charge::retrieve(CHARGE_ID);
$ch-&gt;refunds-&gt;create(array(&#39;amount&#39; =&gt; 1000, &#39;reverse_transfer&#39; =&gt; true));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Charge ch = Charge.retrieve(CHARGE_ID);

Map&lt;String, Object&gt; refundParams = new HashMap&lt;String, Object&gt;();
refundParams.put(&quot;amount&quot;, 1000);
refundParams.put(&quot;reverse_transfer&quot;, true);

ch.refund(refundParams);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.charges.createRefund(
  CHARGE_ID,
  {amount: 1000, reverse_transfer: true},
  function(err, refund) {}
);
</code></pre>
</div>

    </div>
  </div>

<p>When you use the <code>reverse_transfer</code> parameter, a proportional amount of the transfer will be reversed to cover the refund. If the <code>refund_application_fee</code> parameter is also set to true:</p>

<ul>
  <li>If the refund results in the entire charge being refunded, all unrefunded application fees will be refunded</li>
  <li>Otherwise, a proportional amount of the application fee will be refunded to the Connected account</li>
</ul></section>

<section>
<h2 id="accounting-for-negative-balances">Accounting for negative balances</h2>

<p>Some actions, such as refunds and chargebacks, create negative transactions in a Stripe account. If at all possible, Stripe automatically offsets those against payments to ensure a positive Stripe balance.</p>

<p>Stripe first assigns negative transactions to the account on which the associated charge was made. For example, when charging on a connected account, a refund or chargeback will come from the connected account. When charging on the platform using the <code>destination</code> parameter, a refund or chargeback will come from the platform account.</p>

<p>Ultimate responsibility for negative balances depends upon the relationship between the platform and the connected account. A connected standalone account is always ultimately responsible. For Managed Accounts, the <em>platform</em> is ultimately responsible to cover negative balances.</p>

<p>For example, your platform uses managed
accounts and you create a charge on a connected account. Should a chargeback occur, we’ll first attempt to take the funds out of the
managed account balance, because the charge was created on the
connected account. In most cases, the adjustment is made without problem. If, for some reason,
we cannot adjust the connected account and its balance goes negative (and is negative for a
while), we’ll eventually look to the platform account to make the
balance whole again (because it’s a managed account and the platform
has ultimate liability).</p></section>

<section>
<h2 id="handling-balances-in-multiple-currencies">Handling balances in multiple currencies</h2>

<p>When creating destination charges on behalf of a connected account, the
platform will collect its application fees in the settlement currency of the
connected account. If your platform has connected accounts in many different
countries, you can expect to accumulate balances in a variety of currencies.</p>

<p>Because platforms may not have bank accounts for these other currencies, Stripe
provides a way for platforms to pay out from balances in non-default currencies
to the platform’s default bank account. These payouts are created as a manual
transfer with <code>currency</code> set as the currency for the source balance, and
<code>destination</code> set to <code>default_for_currency</code>:</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/transfers \
   -u {PLATFORM_SECRET_KEY}: \
   -d amount=1000 \
   -d currency=krw \
   -d destination=default_for_currency
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

Stripe::Transfer.create(
  :amount =&gt; 1000,
  :currency =&gt; &#39;krw&#39;,
  :destination =&gt; &#39;default_for_currency&#39;
)
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

stripe.Transfer.create(
  amount=1000,
  currency=&quot;krw&quot;,
  destination=&quot;default_for_currency&quot;
)
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

\Stripe\Transfer::create(array(
  &#39;amount&#39; =&gt; 1000,
  &#39;currency&#39; =&gt; &quot;krw&quot;,
  &#39;destination&#39; =&gt; &quot;default_for_currency&quot;
));
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Map&lt;String, Object&gt; transferParams = new HashMap&lt;String, Object&gt;();
transferParams.put(&quot;amount&quot;, 1000);
transferParams.put(&quot;currency&quot;, &quot;krw&quot;);
transferParams.put(&quot;destination&quot;, &quot;default_for_currency&quot;);

Transfer.create(transferParams);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.transfers.create(
  {
    amount: 1000,
    currency: &#39;krw&#39;,
    destination: &#39;default_for_currency&#39;
  }
);
</code></pre>
</div>

    </div>
  </div>

<p>As long as there are sufficient funds in the balance for the specified
<code>currency</code>, Stripe will automatically convert the funds to the default
bank account’s currency.</p>

<p>To create these currency conversions, the platform will have to be on
<a href="https://dashboard.stripe.com/account/transfers">manual transfers</a>.</p></section>

<section>
  <h2>Further reading</h2>
  <p>Read up on the rest of this section to discover what other Connect functionality is available for your users.</p>
<ul class="next-steps">
    <li><a href="shared-customers.html"><span>Sharing customers</a></li>
    <li><a href="special-case-transfers.html"><span>Special-case transfers</a></li>
</ul>

</section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/connect/payments-fees by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:45:03 GMT -->
</html>
