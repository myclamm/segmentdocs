<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/connect/testing-verification by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:47:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="iNGhzt1nW2GdLUz-s7ULAB08dZ_dVQaLhWZ_i5q3aP4RS7Wz26KfJFBpaOF_vT57NEL7GIH5xyvE03WjP2Cijw==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Testing Managed Account Verification</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Testing Managed Account Verification">
    <meta property="og:url" content="testing-verification.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Testing Managed Account Verification">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="../checkout/tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="../mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="../subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="../subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="../subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="../subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="../subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="../subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="../subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="../subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="../subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="../subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="../subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a class='selected' href="testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Testing Managed Account Verification </h1>
  <p>A walkthrough of testing different verification states for Connect Managed Accounts using your test API key. If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=connect">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
</header>

<section>
  <aside class="note">
    <h3>Managed vs. Standalone Accounts</h3>
<p>This section deals solely with testing <em>managed</em> accounts, which have fairly involved obligations around information collection and identity verification.</p>

<p>If you’d like to connect to an existing Stripe account, or have Stripe handle details like identity document collection, take a look at <a href="standalone-accounts.html">Standalone Accounts</a>.</p>  </aside>

<p>This document assumes you’re familiar with <a href="managed-accounts.html">Managed Accounts</a> overall, as well as <a href="updating-accounts.html">updating accounts</a> and <a href="identity-verification.html">identity verification</a>.</p>

<p>Your platform is responsible for the identity verification process for its Managed Accounts. Connect streamlines this process by allowing Managed Accounts to be incrementally verified. Instead of requiring all information up front, Connect asks for a minimal set of information initially but limits how the account can be used (usually by blocking payouts past a certain limit). As the account provides Stripe with more information, we relax these limitations.</p>

<p>This incremental model of verification is split into stages. Once a managed account does a certain volume, a stage is “triggered”, meaning Stripe will ask for that stage’s information requirements. Once triggered, you have to provide the requested information within a limited time and additional charge volume. Once you’ve provided this information, a stage is completed. We allow you to provide information that may be required before a stage is triggered, which can minimize inconveniences.</p>
  <div class="image full"><a href="../../img/new-documentation/connect_verification_diagram.png" class="zoomable" data-width="2055" data-height="1685"><img src="../../img/new-documentation/connect_verification_diagram.png" width="100%"></a></div>

<p>The diagram above demonstrates the stages involved in incremental verification for U.S. Managed Accounts. Note that each country has different requirements.</p>

<p>In test mode, transitioning between the different stages is done with <a href="testing.html#trigger-cards">special credit card numbers</a>.</p>

<p>Let’s manually go through the verification process for a new managed account. It’s recommended to follow this series of commands sequentially. Please note that multiple steps can be completed at the same time: for example, you can create an account with a name and date of birth, bank account, and terms of service acceptance info. This would immediately bypass the first stage of verification, and jump you right to step 5 in this flow.</p></section>

<section>
<h2 id="creating-a-managed-account">1. Creating a managed account</h2>

<p>Let’s start by creating a new test mode managed account, adding a bank account, and showing that the managed account holder has accepted the Stripe Services Agreement. Explicit Services Agreement acceptance is <a href="updating-accounts.html#tos-acceptance">required for making transfers</a>.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>ACCT=$(curl https://api.stripe.com/v1/accounts \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
   -d managed=true \
   -d country=US \
   -d external_account[object]=bank_account \
   -d external_account[country]=US \
   -d external_account[currency]=usd \
   -d external_account[routing_number]=110000000 \
   -d external_account[account_number]=000123456789 \
   -d tos_acceptance[date]=1484350983 \
   -d tos_acceptance[ip]=&quot;67.207.109.102&quot;
)

ACCT_ID=$(echo $ACCT | python -c &#39;import json,sys;obj=json.load(sys.stdin);print obj[&quot;id&quot;]&#39;)
echo $ACCT_ID
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

acct = Stripe::Account.create(
  {
    :country =&gt; &#39;US&#39;,
    :managed =&gt; true,
    :external_account =&gt; {
      :object =&gt; &#39;bank_account&#39;,
      :country =&gt; &#39;US&#39;,
      :currency =&gt; &#39;usd&#39;,
      :routing_number =&gt; &#39;110000000&#39;,
      :account_number =&gt; &#39;000123456789&#39;,
    },
    :tos_acceptance =&gt; {
      :date =&gt; 1484350983,
      :ip =&gt; &#39;67.207.109.102&#39;,
    }
  }
)

acct_id = acct.id
puts acct_id
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

acct = stripe.Account.create(
  managed=True,
  country=&#39;US&#39;,
  external_account=dict(
    object=&#39;bank_account&#39;,
    country=&#39;US&#39;,
    currency=&#39;usd&#39;,
    routing_number=&#39;110000000&#39;,
    account_number=&#39;000123456789&#39;,
  ),
  tos_acceptance=dict(
    date=1484350983,
    ip=&quot;67.207.109.102&quot;,
  ),
)

acct_id = acct.id
print acct_id
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$acct = \Stripe\Account::create(array(
  &quot;managed&quot; =&gt; true,
  &quot;country&quot; =&gt; &quot;US&quot;,
  &quot;external_account&quot; =&gt; array(
    &quot;object&quot; =&gt; &quot;bank_account&quot;,
    &quot;country&quot; =&gt; &quot;US&quot;,
    &quot;currency&quot; =&gt; &quot;usd&quot;,
    &quot;routing_number&quot; =&gt; &quot;110000000&quot;,
    &quot;account_number&quot; =&gt; &quot;000123456789&quot;,
  ),
  &quot;tos_acceptance&quot; =&gt; array(
    &quot;date&quot; =&gt; 1484350983,
    &quot;ip&quot; =&gt; &quot;67.207.109.102&quot;
  )
));

$acct_id = $acct-&gt;id;
echo $acct_id;
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

var acct;

stripe.accounts.create({
  managed: true,
  country: &#39;US&#39;,
  external_account: {
    object: &quot;bank_account&quot;,
    country: &quot;US&quot;,
    currency: &quot;usd&quot;,
    routing_number: &quot;110000000&quot;,
    account_number: &quot;000123456789&quot;,
  },
  tos_acceptance: {
    date: 1484350983,
    ip: &quot;67.207.109.102&quot;
  }
}, function(err, account) {
  acct_id = account.id;
  console.log(acct_id);
});
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Map&lt;String, Object&gt; accountParams = new HashMap&lt;String, Object&gt;();
accountParams.put(&quot;managed&quot;, true);
accountParams.put(&quot;country&quot;, &#39;US&#39;);

Map&lt;String, Object&gt; externalAccountParams = new HashMap&lt;String, Object&gt;();
externalAccountParams.put(&quot;object&quot;, &quot;bank_account&quot;);
externalAccountParams.put(&quot;country&quot;, &quot;US&quot;);
externalAccountParams.put(&quot;currency&quot;, &quot;usd&quot;);
externalAccountParams.put(&quot;routing_number&quot;, &quot;110000000&quot;);
externalAccountParams.put(&quot;account_number&quot;, &quot;000123456789&quot;);
accountParams.put(&quot;external_account&quot;, externalAccountParams);

Map&lt;String, Object&gt; tosParams = new HashMap&lt;String, Object&gt;();
tosParams.put(&quot;date&quot;, 1484350983);
tosParams.put(&quot;ip&quot;, &quot;67.207.109.102&quot;);
accountParams.put(&quot;tos_acceptance&quot;, tosParams);

Account acct = Account.create(accountParams);
acctId = acct.id;
System.out.println(acctId);
</code></pre>
</div>

    </div>
  </div>
</section>

<section>
<h2 id="first-verification-stage">2. First verification stage</h2>
  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_0.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_0.png" width="100%"></a>
    <p>No stage active</p>
  </div>

<p>Initially, no stages are active. At this point you can make charges but not transfer funds. That is the starting state of all Managed Accounts.</p>

<p>Now you will trigger the account’s first stage with one of our <a href="testing.html#trigger-cards">test card numbers</a> (<code>4000 0000 0000 4202</code>). This magic credit card simulates crossing the stage’s trigger threshold. Typically this happens after crossing a specific dollar amount in total charges.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/charges \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -d amount=1000 \
  -d currency=usd \
  -d source[object]=card \
  -d source[number]=4000000000004202 \
  -d source[exp_month]=2 \
  -d source[exp_year]=2017 \
  -d destination=&quot;$ACCT_ID&quot;
)

# Re-fetch the account to see what its status is.
curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2:

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Charge.create(
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {
    :object =&gt; &quot;card&quot;,
    :number =&gt; &quot;4000000000004202&quot;,
    :exp_month =&gt; 2,
    :exp_year =&gt; 2018
  },
  :destination =&gt; acct_id
)

# Re-fetch the account to see what its status is.
Stripe::Account.retrieve(acct_id)</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={
    object=&quot;card&quot;,
    number=&quot;4000000000004202&quot;,
    exp_month=2,
    exp_year=2018
  },
  destination=acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Charge::create(array(
  &quot;amount&quot; =&gt; 1000,
  &quot;currency&quot; =&gt; &quot;usd&quot;,
  &quot;source&quot; =&gt; array(
    object =&gt; &quot;card&quot;,
    number =&gt; &quot;4000000000004202&quot;,
    exp_month =&gt; 2,
    exp_year =&gt; 2018
  ),
  &quot;destination&quot; =&gt; $acct_id
));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.charges.create({
  amount: 1000,
  currency: &quot;usd&quot;,
  source: {
    object: &quot;card&quot;,
    number: &quot;4000000000004202&quot;,
    exp_month: 2,
    exp_year: 2018
  },
  destination: acct_id
}, function(err, charge) {
  // asynchronously called
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;destination&quot;, acctId);

Map&lt;String, Object&gt; sourceParams = new HashMap&lt;String, Object&gt;();
sourceParams.put(&quot;object&quot;, &quot;card&quot;);
sourceParams.put(&quot;number&quot;, &quot;4000000000004202&quot;);
sourceParams.put(&quot;exp_month&quot;, 2);
sourceParams.put(&quot;exp_year&quot;, 2018);
chargeParams.put(&quot;source&quot;, sourceParams); // obtained with Stripe.js

Charge.create(chargeParams);</code></pre>
</div>

    </div>
  </div>

<p>You should now see that in addition to requesting additional information via <code>verification[fields_needed]</code>, there’s now a deadline for providing this information in the <code>verification[due_by]</code> field.</p>
  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_1a.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_1a.png" width="100%"></a>
    <p>Stage 1a Triggered</p>
  </div>

<p>This is because you have triggered the first stage. In this stage, just as with the initial state, charges are enabled but transfers are disabled. You’ll see that <code>charges_enabled</code> on your account is still <code>true</code>: Stripe has given you a deadline to provide this information, but you have not passed it yet.</p></section>

<section>
<h2 id="triggering-charge-limits">3. Triggering charge limits</h2>

<p>While the stage allows charges at first, it has a limit to the volume of charges you can make while in that stage. To simulate crossing that limit, you will make a charge with another <a href="testing.html#trigger-cards">trigger card number</a> (<code>4000 0000 0000 4210</code>).</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/charges \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -d amount=1000 \
  -d currency=usd \
  -d source[object]=card \
  -d source[number]=4000000000004210 \
  -d source[exp_month]=2 \
  -d source[exp_year]=2017 \
  -d destination=&quot;$ACCT_ID&quot;
)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Charge.create(
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {
    :object =&gt; &quot;card&quot;,
    :number =&gt; &quot;4000000000004210&quot;,
    :exp_month =&gt; 2,
    :exp_year =&gt; 2018
  },
  :destination =&gt; acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={
    object=&quot;card&quot;,
    number=&quot;4000000000004210&quot;,
    exp_month=2,
    exp_year=2018
  },
  destination=acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Charge::create(array(
  &quot;amount&quot; =&gt; 1000,
  &quot;currency&quot; =&gt; &quot;usd&quot;,
  &quot;source&quot; =&gt; array(
    object =&gt; &quot;card&quot;,
    number =&gt; &quot;4000000000004210&quot;,
    exp_month =&gt; 2,
    exp_year =&gt; 2018
  ),
  &quot;destination&quot; =&gt; $acct_id
));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.charges.create({
  amount: 1000,
  currency: &quot;usd&quot;,
  source: {
    object: &quot;card&quot;,
    number: &quot;4000000000004210&quot;,
    exp_month: 2,
    exp_year: 2018
  },
  destination: acct_id
}, function(err, charge) {
  // asynchronously called
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;destination&quot;, acctId);

Map&lt;String, Object&gt; sourceParams = new HashMap&lt;String, Object&gt;();
sourceParams.put(&quot;object&quot;, &quot;card&quot;);
sourceParams.put(&quot;number&quot;, &quot;4000000000004210&quot;);
sourceParams.put(&quot;exp_month&quot;, 2);
sourceParams.put(&quot;exp_year&quot;, 2018);
chargeParams.put(&quot;source&quot;, sourceParams); // obtained with Stripe.js

Charge.create(chargeParams);</code></pre>
</div>

    </div>
  </div>

  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_1b.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_1b.png" width="100%"></a>
    <p>Stage 1b Triggered</p>
  </div>

<p>Now you are not able to make new charges, and the account has been updated to show both <code>charges_enabled</code> as <code>false</code> and <code>verification[disabled_reason]</code> as <code>fields_needed</code>.</p></section>

<section>
<h2 id="fulfilling-the-first-stage">4. Fulfilling the first stage</h2>

<p>To know what fields you need to provide at this stage, you should first get a list of necessary fields.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2:

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>puts(Stripe::Account.retrieve(acct_id))</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>print stripe.Account.retrieve(acct_id)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>var_dump(\Stripe\Account::retrieve($acct_id));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.accounts.retrieve(
  acct_id,
  function(err, account) {
    console.log(account);
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>System.out.println(Account.retrieve(acctId, null));</code></pre>
</div>

    </div>
  </div>

  <aside class="note">
    <h3>OFAC</h3>
    <p>OFAC, and related checks Stripe performs at this stage, are legally mandated checks designed to help prevent funding for terrorists and other sanctioned individuals.</p>
  </aside>

<p>You’ll see that in the U.S. these <code>verification[fields_needed]</code> are <code>first_name</code>, <code>last_name</code>, and <code>dob</code>.</p>

<p>Stripe must collect this initial set of fields in order to satisfy our <a href="https://www.treasury.gov/about/organizational-structure/offices/Pages/Office-of-Foreign-Assets-Control.aspx">OFAC</a> requirements. Because of the nature of these checks, if they are not provided Stripe must block charges for the account. While you can charge a certain amount before collecting name and date of birth, since charge blocking is so disruptive to a business, we highly recommend collecting these fields upfront to avoid any potential issues.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
   -d legal_entity[dob][day]=10 \
   -d legal_entity[dob][month]=1 \
   -d legal_entity[dob][year]=1986 \
   -d legal_entity[first_name]=Jenny \
   -d legal_entity[last_name]=Rosen \
   -d legal_entity[type]=individual

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>account = Stripe::Account.retrieve(acct_id)
account.legal_entity.dob.day = 10
account.legal_entity.dob.month = 01
account.legal_entity.dob.year = 1986
account.legal_entity.first_name = &quot;Jenny&quot;
account.legal_entity.last_name = &quot;Rosen&quot;
account.legal_entity.type = &quot;individual&quot;
account.save</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>account = stripe.Account.retrieve(acct_id)
account.legal_entity.dob.day = 10
account.legal_entity.dob.month = 01
account.legal_entity.dob.year = 1986
account.legal_entity.first_name = &quot;Jenny&quot;
account.legal_entity.last_name = &quot;Rosen&quot;
account.legal_entity.type = &quot;individual&quot;
account.save()</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>$account = \Stripe\Account::retrieve($acct_id);
$account-&gt;legal_entity-&gt;dob-&gt;day = 10;
$account-&gt;legal_entity-&gt;dob-&gt;month = 01;
$account-&gt;legal_entity-&gt;dob-&gt;year = 1986;
$account-&gt;legal_entity-&gt;first_name = &quot;Jenny&quot;;
$account-&gt;legal_entity-&gt;last_name = &quot;Rosen&quot;;
$account-&gt;legal_entity-&gt;type = &quot;individual&quot;;
$account-&gt;save();</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.accounts.update(acct_id, {
  legal_entity: {
    dob: {
      day: 10,
      month: 1,
      year: 1986
    },
    first_name: &quot;Jenny&quot;,
    last_name: &quot;Rosen&quot;,
    type: &quot;individual&quot;
  }
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Account account = Account.retrieve(acctId, null);
Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; legalEntityParams = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; dobParams = new HashMap&lt;String, Object&gt;();
dobParams.put(&quot;day&quot;, 10);
dobParams.put(&quot;month&quot;, 1);
dobParams.put(&quot;year&quot;, 1986);
legalEntityParams.put(&quot;dob&quot;, dobParams)
legalEntityParams.put(&quot;first_name&quot;, &quot;Jenny&quot;);
legalEntityParams.put(&quot;last_name&quot;, &quot;Rosen&quot;);
legalEntityParams.put(&quot;type&quot;, &quot;individual&quot;);
params.put(&quot;legal_entity&quot;, legalEntityParams);
account.update(params);</code></pre>
</div>

    </div>
  </div>

  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_1.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_1.png" width="100%"></a>
    <p>Stage 1 Resolved</p>
  </div>

<p>Once you provide this information, Stripe immediately re-enables charges, and enables transfers. You’ll also notice that while <code>verification[fields_needed]</code> is still set (with different values,) <code>verification[due_by]</code> is not. This means that while Stripe will require more information in the future, it’s not immediately required, and you are able to defer providing it until the account has charged more.</p></section>

<section>
<h2 id="second-stage">5. Second stage</h2>

<p>Let’s go ahead and trigger the next stage using the trigger threshold magic card.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/charges \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -d amount=1000 \
  -d currency=usd \
  -d source[object]=card \
  -d source[number]=4000000000004202 \
  -d source[exp_month]=2 \
  -d source[exp_year]=2017 \
  -d destination=&quot;$ACCT_ID&quot;
)

# Re-fetch the account to see what its status is.
curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2:

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Charge.create(
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {
    :object =&gt; &quot;card&quot;,
    :number =&gt; &quot;4000000000004202&quot;,
    :exp_month =&gt; 2,
    :exp_year =&gt; 2018
  },
  :destination =&gt; acct_id
)

# Re-fetch the account to see what its status is.
puts(Stripe::Account.retrieve(acct_id))</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={
    object=&quot;card&quot;,
    number=&quot;4000000000004202&quot;,
    exp_month=2,
    exp_year=2018
  },
  destination=acct_id
)

# Re-fetch the account to see what its status is.
print stripe.Account.retrieve(acct_id)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Charge::create(array(
  &quot;amount&quot; =&gt; 1000,
  &quot;currency&quot; =&gt; &quot;usd&quot;,
  &quot;source&quot; =&gt; array(
    object =&gt; &quot;card&quot;,
    number =&gt; &quot;4000000000004202&quot;,
    exp_month =&gt; 2,
    exp_year =&gt; 2018
  ),
  &quot;destination&quot; =&gt; $acct_id
));

// Re-fetch the account to see what its status is.
var_dump(\Stripe\Account::retrieve($acct_id));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.charges.create({
  amount: 1000,
  currency: &quot;usd&quot;,
  source: {
    object: &quot;card&quot;,
    number: &quot;4000000000004202&quot;,
    exp_month: 2,
    exp_year: 2018
  },
  destination: acct_id
}, function(err, charge) {
  stripe.accounts.retrieve(
    acct_id,
    function(err, account) {
      console.log(account);
    }
  );
);

});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;destination&quot;, acctId);

Map&lt;String, Object&gt; sourceParams = new HashMap&lt;String, Object&gt;();
sourceParams.put(&quot;object&quot;, &quot;card&quot;);
sourceParams.put(&quot;number&quot;, &quot;4000000000004202&quot;);
sourceParams.put(&quot;exp_month&quot;, 2);
sourceParams.put(&quot;exp_year&quot;, 2018);
chargeParams.put(&quot;source&quot;, sourceParams);

Charge.create(chargeParams);

System.out.println(Account.retrieve(acctId));</code></pre>
</div>

    </div>
  </div>

  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_2a.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_2a.png" width="100%"></a>
    <p>Stage 2a Triggered</p>
  </div>

<p>You can still charge and transfer, just as before, but now <code>verification[due_by]</code> on the account is set, meaning you need to provide more information in the near future.</p>

<p>The worst that can happen in this stage is that Stripe will disable transfers (again, the only time Stripe disables charges due to verification is in the first stage).</p></section>

<section>
<h2 id="triggering-transfer-limits">6. Triggering transfer limits</h2>

<p>While this stage does not have a charge-disabling limit, it does have a transfer-disabling limit. You can trigger a transfer limit using a trigger card number (<code>4000 0000 0000 4236</code>). This is similar to the charge limit, but it blocks transfers.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/charges \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -d amount=1000 \
  -d currency=usd \
  -d source[object]=card \
  -d source[number]=4000000000004236 \
  -d source[exp_month]=2 \
  -d source[exp_year]=2017 \
  -d destination=&quot;$ACCT_ID&quot;
)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Charge.create(
  :amount =&gt; 1000,
  :currency =&gt; &quot;usd&quot;,
  :source =&gt; {
    :object =&gt; &quot;card&quot;,
    :number =&gt; &quot;4000000000004236&quot;,
    :exp_month =&gt; 2,
    :exp_year =&gt; 2018
  },
  :destination =&gt; acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Charge.create(
  amount=1000,
  currency=&quot;usd&quot;,
  source={
    object=&quot;card&quot;,
    number=&quot;4000000000004236&quot;,
    exp_month=2,
    exp_year=2018
  },
  destination=acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Charge::create(array(
  &quot;amount&quot; =&gt; 1000,
  &quot;currency&quot; =&gt; &quot;usd&quot;,
  &quot;source&quot; =&gt; array(
    object =&gt; &quot;card&quot;,
    number =&gt; &quot;4000000000004236&quot;,
    exp_month =&gt; 2,
    exp_year =&gt; 2018
  ),
  &quot;destination&quot; =&gt; $acct_id
));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.charges.create({
  amount: 1000,
  currency: &quot;usd&quot;,
  source: {
    object: &quot;card&quot;,
    number: &quot;4000000000004236&quot;,
    exp_month: 2,
    exp_year: 2018
  },
  destination: acct_id
}, function(err, charge) {

});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Map&lt;String, Object&gt; chargeParams = new HashMap&lt;String, Object&gt;();
chargeParams.put(&quot;amount&quot;, 1000);
chargeParams.put(&quot;currency&quot;, &quot;usd&quot;);
chargeParams.put(&quot;destination&quot;, acctId);

Map&lt;String, Object&gt; sourceParams = new HashMap&lt;String, Object&gt;();
sourceParams.put(&quot;object&quot;, &quot;card&quot;);
sourceParams.put(&quot;number&quot;, &quot;4000000000004236&quot;);
sourceParams.put(&quot;exp_month&quot;, 2);
sourceParams.put(&quot;exp_year&quot;, 2018);
chargeParams.put(&quot;source&quot;, sourceParams);

Charge.create(chargeParams);</code></pre>
</div>

    </div>
  </div>

  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_2b.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_2b.png" width="100%"></a>
    <p>Stage 2b Triggered</p>
  </div>

<p>After this trigger, all transfers should fail.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code># Will return an error
curl https://api.stripe.com/v1/transfers \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -H Stripe-Account=&quot;$ACCT_ID&quot; \
  -d amount=400 \
  -d currency=usd \
  -d recipient=self
)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Transfer.create(
  {
    :amount =&gt; 400,
    :currency =&gt; &quot;usd&quot;,
    :recipient =&gt; &quot;self&quot;,
  },
  {
    :stripe_account =&gt; acct_id
  }
)</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Transfer.create(
  amount=400,
  currency=&quot;usd&quot;,
  recipient=&quot;self&quot;,
  stripe_account=acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Transfer::create(
  array(
    &quot;amount&quot; =&gt; 400,
    &quot;currency&quot; =&gt; &quot;usd&quot;,
    &quot;recipient&quot; =&gt; &quot;self&quot;
  ),
  array(
    &quot;stripe_account&quot; =&gt; $acct_id
  )
);</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.transfers.create({
  amount: 400,
  currency: &quot;usd&quot;,
  recipient: &quot;self&quot;
}, {
  stripe_account: acct_id
}, function(err, transfer) {
  // asynchronously called
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>RequestOptions requestOptions = RequestOptions.builder().setStripeAccount(acctId).build();

Map&lt;String, Object&gt; transferParams = new HashMap&lt;String, Object&gt;();
transferParams.put(&quot;amount&quot;, 400);
transferParams.put(&quot;currency&quot;, &quot;usd&quot;);
transferParams.put(&quot;recipient&quot;, &quot;self&quot;);

Transfer.create(transferParams, requestOptions);</code></pre>
</div>

    </div>
  </div>
</section>

<section>
<h2 id="fulfilling-the-second-stage">7. Fulfilling the second stage</h2>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
   -d legal_entity[address][line1]=&quot;1234 Main Street&quot; \
   -d legal_entity[address][postal_code]=94111 \
   -d legal_entity[address][city]=&quot;San Francisco&quot; \
   -d legal_entity[address][state]=CA \
   -d legal_entity[ssn_last_4]=1234

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>account = Stripe::Account.retrieve(acct_id)
account.legal_entity.address.line1 = &quot;1234 Main Street&quot;
account.legal_entity.address.postal_code = 94111
account.legal_entity.address.city = &quot;San Francisco&quot;
account.legal_entity.address.state = &quot;CA&quot;
account.legal_entity.ssn_last_4 = 1234
account.save</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>account = stripe.Account.retrieve(acct_id)
account.legal_entity.address.line1 = &quot;1234 Main Street&quot;
account.legal_entity.address.postal_code = 94111
account.legal_entity.address.city = &quot;San Francisco&quot;
account.legal_entity.address.state = &quot;CA&quot;
account.legal_entity.ssn_last_4 = 1234
account.save()</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>$account = \Stripe\Account::retrieve($acct_id);
$account-&gt;legal_entity-&gt;address.line1 = &quot;1234 Main Street&quot;;
$account-&gt;legal_entity-&gt;address.postal_code = 94111;
$account-&gt;legal_entity-&gt;address.city = &quot;San Francisco&quot;;
$account-&gt;legal_entity-&gt;address.state = &quot;CA&quot;;
$account-&gt;legal_entity-&gt;ssn_last_4 = 1234;
$account-&gt;save();</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.accounts.update(acct_id, {
  legal_entity: {
    address: {
      line1: &quot;1234 Main Street&quot;,
      postal_code: 94111,
      city: &quot;San Francisco&quot;,
      state: &quot;CA&quot;
    },
    ssn_last_4: 1234
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Account account = Account.retrieve(acctId, null);
Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; legalEntityParams = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; addressParams = new HashMap&lt;String, Object&gt;();
addressParams.put(&quot;line1&quot;, &quot;1234 Main Street&quot;);
addressParams.put(&quot;postal_code&quot;, 94111);
addressParams.put(&quot;city&quot;, &quot;San Francisco&quot;);
addressParams.put(&quot;state&quot;, &quot;CA&quot;);
legalEntityParams.put(&quot;address&quot;, addressParams)
legalEntityParams.put(&quot;ssn_last_4&quot;, 1234);
params.put(&quot;legal_entity&quot;, legalEntityParams);
account.update(params);</code></pre>
</div>

    </div>
  </div>

  <div class="image full">
    <a href="../../img/new-documentation/connect_verification_2.png" class="zoomable" data-width="1219" data-height="649"><img src="../../img/new-documentation/connect_verification_2.png" width="100%"></a>
    <p>Stage 2 Resolved</p>
  </div>

<p>After fulfilling the stage, transfers work again.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/transfers \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -H Stripe-Account=&quot;$ACCT_ID&quot; \
  -d amount=400 \
  -d currency=usd \
  -d recipient=self
)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>Stripe::Transfer.create(
  {
    :amount =&gt; 400,
    :currency =&gt; &quot;usd&quot;,
    :recipient =&gt; &quot;self&quot;,
  },
  {
    :stripe_account =&gt; acct_id
  }
)</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>stripe.Transfer.create(
  amount=400,
  currency=&quot;usd&quot;,
  recipient=&quot;self&quot;,
  stripe_account=acct_id
)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>\Stripe\Transfer::create(
  array(
    &quot;amount&quot; =&gt; 400,
    &quot;currency&quot; =&gt; &quot;usd&quot;,
    &quot;recipient&quot; =&gt; &quot;self&quot;
  ),
  array(
    &quot;stripe_account&quot; =&gt; $acct_id
  )
);</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.transfers.create({
  amount: 400,
  currency: &quot;usd&quot;,
  recipient: &quot;self&quot;
}, {
  stripe_account: acct_id
}, function(err, transfer) {
  // asynchronously called
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>RequestOptions requestOptions = RequestOptions.builder().setStripeAccount(acctId).build();

Map&lt;String, Object&gt; transferParams = new HashMap&lt;String, Object&gt;();
transferParams.put(&quot;amount&quot;, 400);
transferParams.put(&quot;currency&quot;, &quot;usd&quot;);
transferParams.put(&quot;recipient&quot;, &quot;self&quot;);

Transfer.create(transferParams, requestOptions);</code></pre>
</div>

    </div>
  </div>
</section>

<section>
<h2 id="fulfilling-multiple-stages">8. Fulfilling multiple stages</h2>

<p>As noted before, providing the right information can fulfill multiple stages. Let’s try to complete the last two stages all at once.</p>

<p>First, obtain the <a href="testing.html#identity-verification">test success image</a> by running:</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-curl numbered" ><code>wget https://stripe.com/img/documentation/guides/testing/success.png</code></pre>
</div>

<p>From here, you can <a href="identity-verification.html#uploading-a-file">upload the test success image</a>.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>FILE_OBJ=$(curl https://uploads.stripe.com/v1/files \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -H Stripe-Account=&quot;$ACCT_ID&quot; \
  -F purpose=identity_document \
  -F file=&quot;@success.png&quot;
)

FILE=$(echo $FILE_OBJ | python -c &#39;import json,sys;obj=json.load(sys.stdin);print obj[&quot;id&quot;]&#39;)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>file_obj = Stripe::FileUpload.create(
  {
    :purpose =&gt; &#39;identity_document&#39;,
    :file =&gt; File.new(&#39;success.png&#39;)
  },
  {
    :stripe_account =&gt; acct_id
  }
)
file = file_obj.id</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>fp = open(&#39;success.png&#39;, &#39;r&#39;)
file_obj = stripe.FileUpload.create(
  purpose=&#39;identity_document&#39;,
  file=fp,
  stripe_account=acct_id
)
file = file_obj.id</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>$fp = fopen(&#39;success.png&#39;, &#39;r&#39;);
$file_obj = \Stripe\FileUpload::create(
  array(
    &quot;purpose&quot; =&gt; &quot;identity_document&quot;,
    &quot;file&quot; =&gt; $fp
  ),
  array(
    &quot;stripe_account&quot; =&gt; $acct_id
  )
));
$file = $file_obj-&gt;id;</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>var fp = fs.readFileSync(&#39;success.png&#39;);
var file;
stripe.fileUploads.create({
  purpose: &#39;identity_document&#39;,
  file: {
    data: fp,
    name: &#39;success.png&#39;,
    type: &#39;application/octet-stream&#39;
  }
}, function(err, fileUpload) {
  file = fileUpload.id;
});</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Map&lt;String, Object&gt; fileUploadParams = new HashMap&lt;String, Object&gt;();
fileUploadParams.put(&quot;purpose&quot;, &quot;identity_document&quot;);
fileUploadParams.put(&quot;file&quot;, new File(&#39;success.png&#39;));

FileUpload fileObj = FileUpload.create(fileUploadParams);
file = fileObj.id;</code></pre>
</div>

    </div>
  </div>

<p>Once the image is uploaded, you can update the account with both pieces of verification information.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/accounts/$ACCT_ID \
  -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
  -d legal_entity[personal_id_number]=123456789 \
  -d legal_entity[verification][document]=&quot;$FILE&quot;
)
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>account = Stripe::Account.retrieve(acct_id)
account.legal_entity.personal_id_number = 123456789
account.legal_entity.verification.document = file
account.save</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>account = stripe.Account.retrieve(acct_id)
account.legal_entity.personal_id_number = 123456789
account.legal_entity.verification.document = file
account.save()</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>$account = \Stripe\Account::retrieve($acct_id);
$account-&gt;legal_entity-&gt;personal_id_number = 123456789;
$account-&gt;legal_entity-&gt;verification-&gt;document = $file;
$account-&gt;save();</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.accounts.update(acct_id, {
  legal_entity: {
    personal_id_number: 123456789,
    verification: {
      document: file
    }
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Account account = Account.retrieve(acctId, null);
Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; legalEntityParams = new HashMap&lt;String, Object&gt;();
Map&lt;String, Object&gt; verificationParams = new HashMap&lt;String, Object&gt;();
verificationParams.put(&quot;document&quot;, file);
legalEntityParams.put(&quot;verification&quot;, verificationParams)
legalEntityParams.put(&quot;personal_id_number&quot;, 123456789);
params.put(&quot;legal_entity&quot;, legalEntityParams);
account.update(params);</code></pre>
</div>

    </div>
  </div>

<p>This single update will actually jump through two stages, from stage 2 fulfilled to complete. You can confirm verification with a GET account call.</p>
  <div class="tabs tabs-code animated">
    <nav class="nav-languages">
        <a data-language="curl"
           >curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="node"
           >Node</a>
        <a data-language="java"
           >Java</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered" ><code>curl https://api.stripe.com/v1/accounts/$ACCT_ID \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2:

</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code>puts(Stripe::Account.retrieve(acct_id))</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code>print stripe.Account.retrieve(acct_id)</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>var_dump(\Stripe\Account::retrieve($acct_id));</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>stripe.accounts.retrieve(
  acct_id,
  function(err, account) {
    console.log(account);
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>Account.retrieve(acctId, null);</code></pre>
</div>

    </div>
  </div>

<p>You’ll see that <code>verification[fields_needed]</code> is now empty, meaning Stripe will not need any additional information for this account unless a significant exception happens (for example, if the account appears to be used for fraud).</p></section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/connect/testing-verification by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:47:52 GMT -->
</html>
