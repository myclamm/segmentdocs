<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/subscriptions/upgrading-downgrading by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:47:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="J7aJUDDYJa4kpPA0g1WPG3dUZdZ2udb0LFvy1utDLcq-LJ0tNh3h6-ng1CtPXbpgXirrUSoVF1Rt7vj-TpTnuw==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Upgrading and Downgrading Plans</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Upgrading and Downgrading Plans">
    <meta property="og:url" content="upgrading-downgrading.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Upgrading and Downgrading Plans">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="../checkout/tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="../mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul>
    <li>
      <a href="quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a class='selected' href="upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="../connect/connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="../connect/identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="../connect/required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="../connect/testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="../connect/bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="../connect/migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="../connect/best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="../connect/special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="../connect/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Upgrading and Downgrading Plans</h1>
  <p>Learn how to change a customer's subscription by upgrading or downgrading their plan. If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=subscriptions">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
</header>

<section>
<p>One way existing subscriptions can be modified is by <a href="#switching">upgrading or downgrading</a> the underlying plan. For example, a customer might want to switch from your basic plan to your pro plan, which is easily accomplished via an <a href="../api.html#update_subscription">upgrade subscription call</a>.</p>

<p>Changing a subscription often results in a <a href="#understanding-proration">proration</a>: a charge adjustment. So you can prepare your customer for any additional expense that comes with a plan change, we provide a method of <a href="#previewing-prorations">previewing a proration</a>. Alternatively, you can choose to <a href="#disable-proration">disable proration</a>.</p></section>

<section>
  <h2 id="switching">Switching plans</h2>
<p>Subscriptions can be changed by switching the plan to which a customer is subscribed or by changing the quantity of a plan. Normally the result qualifies as either <em>upgrading</em> or <em>downgrading</em> the subscription, depending upon the price difference between the two subscriptions.</p>

<p>Assuming a customer is currently subscribed to the <strong>standard-monthly</strong> plan at $10 per month, the following code switches the customer to the <strong>pro-monthly</strong> plan at $30/month:</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
        <a data-language="go"
           >Go</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/subscriptions/sub_49ty4767H20z6a \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
   -d plan=pro-monthly
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

subscription = Stripe::Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.save</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

subscription = stripe.Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.save()</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$subscription = \Stripe\Subscription::retrieve(&quot;sub_49ty4767H20z6a&quot;);
$subscription-&gt;plan = &quot;pro-monthly&quot;;
$subscription-&gt;save();</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Subscription subscription = Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;);

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put(&quot;plan&quot;, &quot;pro-monthly&quot;);
subscription.update(params);</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.subscriptions.update(&quot;sub_49ty4767H20z6a&quot;, {
    plan: &quot;pro-monthly&quot;,
  }, function(err, subscription) {
    // asynchronously called
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-go numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.Key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

params := &amp;stripe.SubParams{
  Plan: &quot;pro-monthly&quot;,
}
subscription, err := sub.Update(&quot;sub_49ty4767H20z6a&quot;, params)</code></pre>
</div>

    </div>
  </div>

<p>If both plans have the same billing periods–combination of <code>interval</code> and <code>interval_count</code>, the subscription retains the same billing dates. If the plans have different billing periods, the new plan is billed at the new interval, starting on the day of the change. For example, switching a customer from one monthly plan to another does not change the billing dates. However, switching a customer from a monthly plan to a yearly plan moves the billing date to the date of the switch. Switching a customer from a monthly plan to a monthly plan with a trial period also moves the billing date (to the conclusion of the trial).</p>

<p>Stripe immediately attempts payment for these subscription changes:</p>

<ul>
  <li>From a subscription that doesn’t require payment (e.g., due to a trial, free plan, or coupon) to a paid subscription</li>
  <li>When the billing period changes</li>
</ul>

<p>If the required payment fails, the subscription change request also fails, leaving the subscription unchanged.</p>

<p>If you want the customer to immediately pay the price difference when switching to a more expensive plan on the same billing cycle, you need to <a href="invoices.html#generating-invoices">generate an invoice</a> after making the switch.</p></section>

<section>
  <h2 id="understanding-proration">Understanding proration</h2>
<p>The most confusing aspect to changing subscriptions is how existing payments are factored into the amount to be invoiced. By default, Stripe <em>prorates</em> subscription costs.</p>

<p>For example, say the customer in the above code is billed on the 1st of each month and that code is executed exactly halfway through the plan’s billing cycle (i.e., on the 15th of April). In that case, the customer has already paid $10, and used half of the current billing cycle. When the customer switches to the new plan, with a cost of $30, the unused portion of the previous plan results in a credit of $5. The cost of the new plan for the rest of the billing cycle (i.e., the rest of April) is $15. Therefore, the total prorated cost of switching from the cheaper plan to the more expensive plan is $10. This amount is added to the next invoice.</p>

<p>The next invoice, on May 1st, also reflects the payment required on the new plan for that upcoming month: $30. Thus, the May 1st invoice is for a total of $40.</p>

<p>The customer is not billed the $40 at the time the plans are switched. The plan change impacts the <em>next</em> invoice, which remains on the same billing cycle (as both plans have the same billing interval).</p>

<p>As another example, say a customer is halfway through a monthly plan that costs $30 per month and is switched to a yearly plan that costs $300 per year. The customer is credited $15 for the unused portion of the monthly plan and owes $300 for the first year of the new plan. The customer is invoiced–at the time of the switch–$285, and the annual billing cycle begins that day.</p>

<p>When the new plan is less expensive than the current plan, the prorated credit is larger than the new amount due. For example, if the customer switches from the $30/month plan to the $10/month plan exactly halfway through the billing cycle, the customer receives a net credit of $10: a credit of $15 for the unused portion of the old plan less a charge of $5 for the remaining time on the new plan. The next invoice, at the start of the next billing period, reflects the $10 credit and the $10 due for a full, upcoming month on the new plan, resulting in a net amount due of $0.</p>

<p>When credits are created, they’ll continue to apply to subsequent invoices until the credit is covered and payment is due again. For example, a move from a $50/month plan until a $10/month plan–exactly halfway through the billing period–results in a net credit of $20: a credit of $25 for the unused portion of the more expensive plan and a debit of $5 to pay for the remainder of the billing period on the new plan. The next two invoices would net to $0.</p>

<p>The prorated amount is calculated down to the second by Stripe. We calculate the difference between the two plans based on the time  the API call was made to change the customer’s subscription, using the current billing period’s start and end times.</p></section>

<section>
  <h2 id="previewing-prorations">Previewing prorations</h2>
<p>To preview the cost of a proration before changing the customer’s subscription, make an <a href="../api.html#upcoming_invoice">upcoming invoice API</a> call. This endpoint shows what the customer’s next invoice looks like after applying the provided parameters, such as a plan change.</p>

<p>In the returned invoice, the invoice items reflect the prorations created by an update.</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
        <a data-language="go"
           >Go</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Set proration date to this moment:
proration_date = Time.now.to_i

# See what the next invoice would look like with a plan switch
# and proration set:
invoice = Stripe::Invoice.upcoming(
  :customer =&gt; &quot;cus_3R1W8PG2DmsmM9&quot;,
  :subscription =&gt; &quot;sub_49ty4767H20z6a&quot;,
  :subscription_plan =&gt; &quot;pro-monthly&quot;, # Switch to new plan
  :subscription_proration_date =&gt; proration_date)

# Calculate the proration cost:
current_prorations = invoice.lines.data.select { |ii| ii.period.start == proration_date }
cost = 0
current_prorations.each do |p|
  cost += p.amount
end
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# Set proration date to this moment:
import time
proration_date = int(time.time())

# See what the next invoice would look like with a plan switch
# and proration set:
invoice = stripe.Invoice.upcoming(
  customer=&quot;cus_3R1W8PG2DmsmM9&quot;,
  subscription=&quot;sub_3R3PlB2YlJe84a&quot;,
  subscription_plan=&quot;pro-monthly&quot;, # Switch to new plan
  subscription_proration_date=proration_date)

# Calculate the proration cost:
current_prorations = [ii for ii in invoice.lines.data if ii.period.start == proration_date]
cost = sum([p.amount for p in current_prorations])
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Set proration date to this moment:
$proration_date = time();

// See what the next invoice would look like with a plan switch
// and proration set:
$invoice = \Stripe\Invoice::upcoming(array(
  &quot;customer&quot; =&gt; &quot;cus_3R1W8PG2DmsmM9&quot;,
  &quot;subscription&quot; =&gt; &quot;sub_3R3PlB2YlJe84a&quot;,
  &quot;subscription_plan&quot; =&gt; &quot;pro-monthly&quot;, # Switch to new plan
  &quot;subscription_proration_date&quot; =&gt; $proration_date
));

// Calculate the proration cost:
$cost = 0;
$current_prorations = array();
foreach ($invoice-&gt;lines-&gt;data as $line) {
  if ($line-&gt;period-&gt;start == proration_date) {
    array_push($current_prorations, $line);
    $cost += $line-&gt;amount;
  }
}
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

# Set proration date to this moment:
long prorationDate = System.currentTimeMillis() / 1000L;

# See what the next invoice would look like with a plan switch
# and proration set:
Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put(&quot;customer&quot;, &quot;cus_3R1W8PG2DmsmM9&quot;);
params.put(&quot;subscription&quot;, &quot;sub_3R3PlB2YlJe84a&quot;);
params.put(&quot;subscription_plan&quot;, &quot;pro-monthly&quot;); # Switch to new plan
params.put(&quot;subscription_proration_date&quot;, prorationDate);

Invoice invoice = Invoice.upcoming(params);

# Calculate the proration cost:
long cost = 0;
List&lt;InvoiceLineItem&gt; currentProrations = new LinkedList&lt;InvoiceLineItem&gt;();
for (InvoiceLineItem line: invoice.getLines().getData()) {
  if (line.getPeriod().getStart() == prorationDate) {
    currentProrations.add(line);
    cost += line.getAmount();
  }
}
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// Set proration date to this moment:
var proration_date = Math.floor(Date.now() / 1000);

// See what the next invoice would look like with a plan switch
// and proration set:
stripe.invoices.retrieveUpcoming(
  &quot;cus_3R1W8PG2DmsmM9&quot;,
  &quot;sub_3R3PlB2YlJe84a&quot;,
  {
    subscription_plan: &#39;pro-monthly&#39;, // Switch to new plan
    subscription_proration_date: proration_date
  },
  function(err, invoice) {
    // asynchronously called
    if (err === null) {

      // Calculate the proration cost:
      var current_prorations = [];
      var cost = 0;
      for (var i = 0; i &lt; invoice.lines.data.length; i++) {
        var invoice_item = invoice.lines.data[i];
        if (invoice_item.period.start == proration_date) {
          current_prorations.push(invoice_item);
          cost += invoice_item.amount;
        }
      }
    } else {
      // handle error
    }
  }
);
</code></pre>
</div>
<div class="code">
  <pre class="language-go numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.Key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

// Set the proration date to this moment:
prorationDate := time.Now().Unix()

// See what the next invoice would look like with a plan switch
// and proration set:
invoiceParams := &amp;stripe.InvoiceParams{
  Customer: &quot;cus_3R1W8PG2DmsmM9&quot;,
  Sub: &quot;sub_3R3PlB2YlJe84a&quot;,
  SubPlan: &quot;pro-monthly&quot;,
  SubProrationDate: prorationDate,
}
invoice, err := invoice.GetNext(invoiceParams)

// Calculate the proration cost:
var cost int64 = 0
for _, invoiceItem := range invoice.Lines.Values {
  if (invoiceItem.Period.Start == prorationDate) {
    cost += invoiceItem.Amount
  }
}
</code></pre>
</div>

    </div>
  </div>

<p>After using the invoice items to calculate the cost of the proposed subscription change, you could confirm the amount with the customer before making the change. But because Stripe prorates to the second, the amount of the prorations can change slightly between the time they are previewed, and the time the update is actually performed. To avoid this problem, lock in the proration by passing a <code>subscription_proration_date</code> parameter (on an invoice, as in the above code) or <code>proration_date</code> parameter (on a subscription, in the following), which causes the proration to be calculated as though the change was made at that time.</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
        <a data-language="go"
           >Go</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# later...
subscription = Stripe::Subscription.retrieve(&quot;sub_3R3PlB2YlJe84a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.proration_date = proration_date # Same value as before
subscription.save
</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

# later...
subscription = stripe.Subscription.retrieve(&quot;sub_3R3PlB2YlJe84a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.proration_date = proration_date # Same value as before
subscription.save()
</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// later...
$subscription = \Stripe\Subscription::retrieve(&#39;sub_3R3PlB2YlJe84a&#39;);
$subscription-&gt;plan = &#39;pro-monthly&#39;;
$subscription-&gt;proration_date = $proration_date; // Same value as before
$subscription-&gt;save();
</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

// later...
Subscription subscription = Subscription.retrieve(&quot;sub_3R3PlB2YlJe84a&quot;);

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put(&quot;plan&quot;, &quot;pro-monthly&quot;);
params.put(&quot;proration_date&quot;, prorationDate); # Same value as before

subscription.update(params);
</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

// later...
stripe.subscriptions.update(
  &quot;sub_3R3PlB2YlJe84a&quot;,
  {
    plan: &quot;pro-monthly&quot;,
    proration_date: proration_date, // Same value as before
  },
  function(err, subscription) {
    // asynchronously called
  }
);
</code></pre>
</div>
<div class="code">
  <pre class="language-go numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.Key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

// later...
subscriptionParams := &amp;stripe.SubParams{
  Plan: &quot;pro-monthly&quot;,
  ProrationDate: prorationDate, // Same value as before
}
subscription, err := sub.Update(&quot;sub_3R3PlB2YlJe84a&quot;, subscriptionParams)
</code></pre>
</div>

    </div>
  </div>

</section>

<section>
  <h2 id="disable-prorations">Disabling prorations</h2>
<p>Prorating the costs of plans is the default behavior but you can disable proration by setting <code>prorate</code> to false when making a subscription change:</p>
  <div class="tabs tabs-code animated" data-platform=server>
    <nav class="nav-languages">
        <a data-language="curl"
            class="selected">curl</a>
        <a data-language="ruby"
           >Ruby</a>
        <a data-language="python"
           >Python</a>
        <a data-language="php"
           >PHP</a>
        <a data-language="java"
           >Java</a>
        <a data-language="node"
           >Node</a>
        <a data-language="go"
           >Go</a>
    </nav>
    <div class="tabs-content">
      <div class="code">
  <pre class="language-curl numbered selected" ><code>curl https://api.stripe.com/v1/subscriptions/sub_49ty4767H20z6a \
   -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \
   -d plan=pro-monthly \
   -d prorate=false
</code></pre>
</div>
<div class="code">
  <pre class="language-ruby numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

subscription = Stripe::Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.prorate = false
subscription.save</code></pre>
</div>
<div class="code">
  <pre class="language-python numbered" ><code># Set your secret key: remember to change this to your live secret key in production
# See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.api_key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

subscription = stripe.Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;)
subscription.plan = &quot;pro-monthly&quot;
subscription.prorate = False
subscription.save()</code></pre>
</div>
<div class="code">
  <pre class="language-php numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
\Stripe\Stripe::setApiKey(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

$subscription = \Stripe\Subscription::retrieve(&quot;sub_49ty4767H20z6a&quot;);
$subscription-&gt;plan = &quot;pro-monthly&quot;;
$subscription-&gt;prorate = false
$subscription-&gt;save();</code></pre>
</div>
<div class="code">
  <pre class="language-java numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
Stripe.apiKey = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;;

Subscription subscription = Subscription.retrieve(&quot;sub_49ty4767H20z6a&quot;);

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put(&quot;plan&quot;, &quot;pro-monthly&quot;);
params.put(&quot;prorate&quot;, false);
subscription.update(params);</code></pre>
</div>
<div class="code">
  <pre class="language-javascript numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
var stripe = require(&quot;stripe&quot;)(&quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;);

stripe.subscriptions.update(&quot;sub_49ty4767H20z6a&quot;, {
    plan: &quot;pro-monthly&quot;,
    prorate = false,
  }, function(err, subscription) {
    // asynchronously called
  }
);</code></pre>
</div>
<div class="code">
  <pre class="language-go numbered" ><code>// Set your secret key: remember to change this to your live secret key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
stripe.Key = &quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&quot;

params := &amp;stripe.SubParams{
  Plan: &quot;pro-monthly&quot;,
  Prorate: false,
}
subscription, err := sub.Update(&quot;sub_49ty4767H20z6a&quot;, params)</code></pre>
</div>

    </div>
  </div>

<p>With proration disabled, the customer is billed the full amount for the new plan when the next invoice is generated. You can choose to <a href="invoices.html#generating-invoices">generate an invoice</a> after making the switch to bill the customer sooner.</p></section>

<section>
  <h2>Next steps</h2>
  <p>Congrats! You know how to upgrade or downgrade a subscription. Some resources you might want to see next:</p>
<ul class="next-steps">
    <li><a href="billing-cycle.html"><span>Billing Cycle</a></li>
    <li><a href="canceling-pausing.html"><span>Canceling &amp; Pausing</a></li>
    <li><a href="../api.html#update_subscription"><span>Update Subscription API</a></li>
</ul>
</section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/subscriptions/upgrading-downgrading by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:47:48 GMT -->
</html>
