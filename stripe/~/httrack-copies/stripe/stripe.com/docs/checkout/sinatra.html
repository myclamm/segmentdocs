<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/checkout/sinatra by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:48:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="Z9IWQoIC6_7CvmOCW3o4ve_tlltxq-r52vUj5-dG69r-SAI_hMcvuw_6R52Xcg3GxpMY3C0HK1mbQCnPQpEhqw==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Sinatra Checkout Guide</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Sinatra Checkout Guide">
    <meta property="og:url" content="sinatra.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Sinatra Checkout Guide">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="../mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="../subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="../subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="../subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="../subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="../subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="../subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="../subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="../subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="../subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="../subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="../subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="../connect/connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="../connect/identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="../connect/required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="../connect/testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="../connect/bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="../connect/migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="../connect/best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="../connect/special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="../connect/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Using Checkout and Sinatra</h1>
  <p>This tutorial will help you integrate Stripe and Ruby's Sinatra framework. If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=checkout">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
</header>

<section>
<p>We’re going to create a simple application using <a href="http://www.sinatrarb.com/">Sinatra</a> and Stripe’s <a href="../checkout.html">Checkout</a> to accept payments in a few lines of code. Sinatra and Stripe are extremely well suited to each other, and the <a href="https://gist.github.com/michaelvillar/7146708">end result of this tutorial</a> is elegant and compact.</p>

<p>You’ll need to have the following prerequisites before we go any further:</p>

<ul>
  <li>A <a href="../../index.html">Stripe</a> account</li>
  <li>A <a href="http://www.ruby-lang.org/en">Ruby</a> &gt;= 1.9.3 environment</li>
</ul>

<p>The first step is to install the Stripe and Sinatra gems:</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>gem install stripe sinatra</code></pre>
</div>

<p>Let’s create a file called <code>app.rb</code> and setup Stripe’s configuration:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>require &#39;sinatra&#39;
require &#39;stripe&#39;

set :publishable_key, ENV[&#39;PUBLISHABLE_KEY&#39;]
set :secret_key, ENV[&#39;SECRET_KEY&#39;]

Stripe.api_key = settings.secret_key</code></pre>
</div>

<p>We’re creating two Sinatra settings, <code>:publishable_key</code> and <code>:secret_key</code> which are being pulled out of the current environmental variables. We’re not hardcoding these keys, since it’s often bad practice to put sensitive data into source control.</p>

<p>Next, let’s create some Sinatra methods, to first display our payment form, and then to create charges.</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>get &#39;/&#39; do
  erb :index
end

post &#39;/charge&#39; do
  # Amount in cents
  @amount = 500

  customer = Stripe::Customer.create(
    :email =&gt; &#39;customer@example.com&#39;,
    :source  =&gt; params[:stripeToken]
  )

  charge = Stripe::Charge.create(
    :amount      =&gt; @amount,
    :description =&gt; &#39;Sinatra Charge&#39;,
    :currency    =&gt; &#39;usd&#39;,
    :customer    =&gt; customer.id
  )

  erb :charge
end</code></pre>
</div>

<p>In our <code>/charge</code> method, we’re creating a <code>Stripe::Charge</code> object with various POST parameters. Stripe expects charges to be in cents, so we’re converting the <code>amount</code> parameter by multiplying it by a hundred.</p>

<p>Stripe Charges also take an optional <code>:description</code> parameter, which in this case is <code>Sinatra Charge</code>. This is not something that’ll display in people’s statements, but just in Stripe’s management interface.</p>

<p>Finally, we’re setting the <code>:source</code> property to the <code>stripeToken</code> parameter. This is something that is automatically created for us by <a href="../checkout.html">Checkout</a>, which we’re going to cover next.</p>

<p>Some payments could fail, for a variety of reasons such as an invalid CVC, card number or failed charge. We can cater for this in a basic manner for the time being, and catch any <code>CardError</code> exceptions.</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>error Stripe::CardError do
  env[&#39;sinatra.error&#39;].message
end</code></pre>
</div>
</section>

<section>
<h2 id="templates">Templates</h2>

<p>Sinatra lets you <a href="http://www.sinatrarb.com/intro.html#Inline%20Templates">inline templates</a> into Ruby files using a neat little Ruby trick, the <code>__END__</code> keyword.</p>

<p>First we’re going to create a Sinatra layout, which is going to wrap our templates.</p>
<div class="code">
  <pre class="language-html numbered" ><code>__END__

@@ layout
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;%= yield %&gt;
  &lt;/body&gt;
  &lt;/html&gt;</code></pre>
</div>

<p>Next, let’s create our <code>:index</code> template, which is going to have the credit card form, amount and description. Notice we’re using <a href="../checkout.html">Checkout</a>, which will display a credit card overlay which includes validation and error handling.</p>
<div class="code">
  <pre class="language-html numbered" ><code>@@ index
  &lt;form action=&quot;/charge&quot; method=&quot;post&quot; class=&quot;payment&quot;&gt;
    &lt;article&gt;
      &lt;label class=&quot;amount&quot;&gt;
        &lt;span&gt;Amount: $5.00&lt;/span&gt;
      &lt;/label&gt;
    &lt;/article&gt;

    &lt;script src=&quot;https://checkout.stripe.com/checkout.js&quot; class=&quot;stripe-button&quot;
            data-key=&quot;&lt;%= settings.publishable_key %&gt;&quot;
            data-description=&quot;A month&#39;s subscription&quot;
            data-amount=&quot;500&quot;
            data-locale=&quot;auto&quot;&gt;&lt;/script&gt;
  &lt;/form&gt;</code></pre>
</div>

<p>Finally let’s create a <code>:charge</code> template that shows users a success message.</p>
<div class="code">
  <pre class="language-html numbered" ><code>@@ charge
  &lt;h2&gt;Thanks, you paid &lt;strong&gt;$5.00&lt;/strong&gt;!&lt;/h2&gt;</code></pre>
</div>

<p>So that’s it, complete Stripe and Sinatra integration in about 60 lines of Ruby and HTML! You can see the <a href="https://gist.github.com/michaelvillar/7146708">full example here</a>. Let’s start the server, making sure to set the environmental variables we used earlier to Stripe’s <a href="https://dashboard.stripe.com/account/apikeys">publishable and secret keys</a>. For now, let’s use the test keys, rather than the live ones.</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>PUBLISHABLE_KEY=pk_test_6pRNASCoBOKtIshFeQd4XMUh SECRET_KEY=sk_test_BQokikJOvBiI2HlWgH4olfQ2 ruby app.rb</code></pre>
</div>

<p>Now, if we navigate to <a href="http://localhost:4567/">http://localhost:4567</a>, we should see our payment form ready to use. If you’re using Stripe’s test keys, then we can test it with some dummy data. Enter the test number <strong>4242 4242 4242 4242</strong>, a three digit CVC and any expiry date in the future. Submitting the form should bring up our successful charge page.</p></section>

<section>
<h2 id="deploying-to-heroku">Deploying to Heroku</h2>

<p>So now we’ve created our basic payment page, let’s get it deployed somewhere so people can use it! Heroku is an awesome way to do this, and integrates seamlessly with Sinatra and Rack. Firstly, get a <a href="https://www.heroku.com/">Heroku</a> account, and install the <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a>. We then need to setup a few things, so Heroku knows what gems we’re using. Firstly, we’ll to create a <code>Gemfile</code> for <a href="http://gembundler.com/">Bundler</a>:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>source &#39;http://rubygems.org&#39;
gem &#39;sinatra&#39;
gem &#39;stripe&#39;</code></pre>
</div>

<p>Remember to run <code>bundle install</code> to create the <code>Gemfile.lock</code>. Next, let’s add a file called <code>config.ru</code> for Rack:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>require &#39;./app&#39;
run Sinatra::Application</code></pre>
</div>

<p>That’s all the setup required. Now we’ll push our code to Heroku and tell it to deploy our application.</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>git init
git add .
git commit -m &#39;My simple Stripe application&#39;
heroku create
heroku config:set PUBLISHABLE_KEY=pk_test_6pRNASCoBOKtIshFeQd4XMUh SECRET_KEY=sk_test_BQokikJOvBiI2HlWgH4olfQ2
git push heroku master
heroku open</code></pre>
</div>

<p>Note that we’ve placed your <strong>test</strong> API keys in the example above. You’ll need to swap it out with your <strong>live</strong> keys in production. You can see all your keys in <a href="https://dashboard.stripe.com/account/apikeys">your Dashboard</a>.</p>

<p>By default, Heroku includes SSL for all applications. Just change the url from <code>http://</code> to <code>https://</code>.</p></section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/checkout/sinatra by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:48:31 GMT -->
</html>
