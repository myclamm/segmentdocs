<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from stripe.com/docs/checkout/rails by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:48:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <meta charset="utf-8">
    <meta name="google-site-verification" content="f0LCrdI6z4Fo8zld4sHCgo5SiUE4EYYRUa6KVeX3Mw8" />
    <meta name="csrf-token" content="QIdSV13w8eB2OiHyu1OLOSNtOsEAoxThWkhnNeVGg0_ZHUYqWzU1pbt-Be13W75CChO0RlwP1UEb_W0dQJFJPg==">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Rails Checkout Guide</title>

    <meta name="description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <link rel="shortcut icon" href="../../favicon.ico">

    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon/180x180.png">
    <link rel="icon" href="../../img/apple-touch-icon/180x180.png">


    <link rel="image_src" type="image/png" href="../../img/v3/home/social.png">

    <meta property="og:title" content="Rails Checkout Guide">
    <meta property="og:url" content="rails.html">
    <meta property="og:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">
    <meta property="og:image" content="../../img/v3/home/social.png">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:image" content="../../img/v3/home/twitter.png">
    <meta name="twitter:site" content="@stripe">
    <meta name="twitter:title" content="Rails Checkout Guide">
    <meta name="twitter:description" content="Stripe is a suite of APIs that powers commerce for businesses of all sizes.">


    <script type="application/json" id="strut_files">{&quot;v3/shared/navigation_ie10.css&quot;:&quot;/assets/v3/shared/navigation_ie10-ec238f46e7cb9867e3c1b529e2cfa37b.css&quot;}</script>

    

    

    <link rel="stylesheet" href="../../assets/v3/default-ef2bff54073622b9e08cf24466b5668f.css">
    <link rel="stylesheet" href="../../assets/v3/shared/common-d0fb03fa2d48fcf29010779ca9a12b2c.css">
    <link rel="stylesheet" href="../../assets/v3/documentation/base-47c1fd7d3d670e4e08df8f5a67b20dea.css">
    <link rel="stylesheet" href="../../assets/v3/shared/prism_light-6d08c6ec0d72453693d775c3b96629c0.css">
    
    
    <meta name="viewport" content="width=1060">
    <meta name="robots" content="noarchive">
  </head>
  <body class="">
    
    <div id="docs">
      <div id="sidebar">
        <div class="logo">
          <a class="site" href="../../index.html" title="Stripe"></a>
          <a class="extension" href="../../docs.html">docs</a>
        </div>
        <div class="nav-border"></div>
        <nav>
          <h1 class="home"><a href="../../docs.html">Home</a></h1>
          <h1 class="payments"><a class="toggle-content">Payments</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../quickstart.html">Quickstart</a>
    </li>
    <li class="category">Collecting payment details
    </li>
    <li>
      <a href="tutorial.html">Checkout</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../checkout.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../custom-form.html">Stripe.js</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../stripe.html">Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../mobile/ios.html">iOS</a>
    </li>
    <li>
      <a href="../mobile/android.html">Android</a>
    </li>
    <li class="category">Charges
    </li>
    <li>
      <a href="../charges.html">Creating Charges</a>
    </li>
    <li>
      <a href="../declines.html">Declines &amp; Failed Payments</a>
    </li>
    <li>
      <a href="../disputes.html">Disputes</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../disputes/evidence.html">Submitting Evidence</a>
    </li>
    <li>
      <a href="../disputes/types.html">Types</a>
    </li>
    <li>
      <a href="../disputes/faq.html">FAQ</a>
    </li>
</ul>

    </li>
    <li class="category">Products &amp; Orders
    </li>
    <li>
      <a href="../orders.html">Orders</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../orders/guide.html">Guide</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../orders/tax-integration.html">Tax Integrations</a>
    </li>
    <li>
      <a href="../orders/shipping-integration.html">Shipping Integrations</a>
    </li>
    <li>
      <a href="../sources.html">Getting Started</a>
    </li>
    <li>
      <a href="../sources/payment-methods.html">Payment Methods</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../sources/cards.html">Cards</a>
    </li>
    <li>
      <a href="../sources/3d-secure.html">3D Secure</a>
    </li>
    <li>
      <a href="../sources/bancontact.html">Bancontact</a>
    </li>
    <li>
      <a href="../sources/giropay.html">Giropay</a>
    </li>
    <li>
      <a href="../sources/ideal.html">iDEAL</a>
    </li>
    <li>
      <a href="../sources/sepa-direct-debit.html">SEPA Direct Debit</a>
    </li>
    <li>
      <a href="../sources/sofort.html">Sofort</a>
    </li>
</ul>

    </li>
    <li class="category">Other Payment Methods
    </li>
    <li>
      <a href="../ach.html">ACH</a>
    </li>
    <li>
      <a href="../apple-pay.html">Apple Pay</a>
      <ul class='hidden' data-hidden=true>
    <li>
      <a href="../apple-pay/apps.html">Apple Pay in Apps</a>
    </li>
    <li>
      <a href="../apple-pay/web.html">Apple Pay on the Web</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../alipay.html">Alipay</a>
    </li>
    <li>
      <a href="../bitcoin.html">Bitcoin</a>
    </li>
    <li class='separator'>
      <a href="../testing.html">Testing</a>
    </li>
</ul>

          <h1 class="subscriptions"><a class="toggle-content">Subscriptions</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../subscriptions/quickstart.html">Quickstart</a>
    </li>
    <li>
      <a href="../subscriptions/creating.html">Creating Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/discounts.html">Applying Discounts</a>
    </li>
    <li>
      <a href="../subscriptions/trials.html">Using Trial Periods</a>
    </li>
    <li>
      <a href="../subscriptions/quantities.html">Setting Quantities</a>
    </li>
    <li>
      <a href="../subscriptions/taxes.html">Adding Taxes</a>
    </li>
    <li>
      <a href="../subscriptions/multiple.html">Multiple Subscriptions</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/lifecycle.html">Lifecycle &amp; Events</a>
    </li>
    <li>
      <a href="../subscriptions/webhooks.html">Using Webhooks</a>
    </li>
    <li>
      <a href="../subscriptions/changing.html">Changing Subscriptions</a>
      <ul data-collapsable=false>
    <li>
      <a href="../subscriptions/upgrading-downgrading.html">Upgrading &amp; Downgrading</a>
    </li>
    <li>
      <a href="../subscriptions/billing-cycle.html">Billing Cycle</a>
    </li>
    <li>
      <a href="../subscriptions/canceling-pausing.html">Canceling &amp; Pausing</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../subscriptions/invoices.html">Working with Invoices</a>
      <ul data-collapsable=false>
</ul>

    </li>
    <li>
      <a href="../subscriptions/plans.html">Managing Plans</a>
    </li>
    <li>
      <a href="../subscriptions/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="connect"><a class="toggle-content">Connect</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../connect.html">Overview</a>
    </li>
    <li>
      <a href="../connect/connecting-to-accounts.html">Connecting to Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/authentication.html">Authentication</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/standalone-accounts.html">Standalone Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/reference.html">OAuth Reference</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/managed-accounts.html">Managed Accounts</a>
      <ul data-collapsable=false>
    <li>
      <a href="../connect/updating-accounts.html">Updating Accounts</a>
    </li>
    <li>
      <a href="../connect/identity-verification.html">Identity Verification</a>
    </li>
    <li>
      <a href="../connect/required-verification-information.html">Verification Fields</a>
    </li>
    <li>
      <a href="../connect/testing-verification.html">Testing Verification</a>
    </li>
    <li>
      <a href="../connect/bank-transfers.html">Bank Transfers</a>
    </li>
    <li>
      <a href="../connect/migrating.html">Migrating Recipients</a>
    </li>
    <li>
      <a href="../connect/best-practices.html">Best Practices</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../connect/payments-fees.html">Payments and Fees</a>
    </li>
    <li>
      <a href="../connect/special-case-transfers.html">Special-case Transfers</a>
    </li>
    <li class='separator'>
      <a href="../connect/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="relay"><a class="toggle-content">Relay</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../relay.html">Selling in Other Apps</a>
    </li>
    <li>
      <a href="../relay/apps-guide.html">Accepting Orders in Your App</a>
      <ul data-collapsable=false>
    <li>
      <a href="../relay/apps-error-guide.html">Error Handling</a>
    </li>
</ul>

    </li>
</ul>

          <h1 class="radar"><a class="toggle-content">Radar</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../radar.html">Overview</a>
    </li>
    <li>
      <a href="../radar/risk-evaluation.html">Risk Evaluation</a>
    </li>
    <li>
      <a href="../radar/review.html">Review</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/review/auth-and-capture.html">Uncaptured Payments</a>
    </li>
</ul>

    </li>
    <li>
      <a href="../radar/rules.html">Rules</a>
      <ul data-collapsable=false>
    <li>
      <a href="../radar/rules/reference.html">Reference</a>
    </li>
</ul>

    </li>
    <li class='separator'>
      <a href="../radar/testing.html">Testing</a>
    </li>
</ul>

          <h1 class="account"><a class="toggle-content">Account</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../dashboard.html">Your Account</a>
    </li>
    <li>
      <a href="../checklist.html">Going Live Checklist</a>
    </li>
    <li>
      <a href="../transfers.html">Getting Paid</a>
    </li>
    <li>
      <a href="../reporting.html">Reporting</a>
    </li>
</ul>

          <h1 class="api"><a class="toggle-content">Development</a></h1>
<ul class='hidden' data-hidden=true>
    <li>
      <a href="../libraries.html">API Libraries</a>
    </li>
    <li>
      <a href="../upgrades.html">API Upgrades</a>
    </li>
    <li>
      <a href="../webhooks.html">Webhooks</a>
    </li>
    <li>
      <a href="../building-integrations.html">Integrations</a>
    </li>
    <li>
      <a href="../recipes.html">Recipes</a>
    </li>
    <li>
      <a href="../security.html">Security</a>
    </li>
</ul>


          <h1 class="references"><a href="../api.html" class="external" target="_blank">API Reference</a></h1>
        </nav>
      </div>
      <div id="content-wrapper" tabindex="0">
        <div class="overlay"></div>
        <header id="main-header">
          <nav>
            <ul class="external">
              <li><a href="https://support.stripe.com/">Support</a></li>

              <li class="button">
                <a data-adroll-segment='submit_two' href="https://dashboard.stripe.com/login">Sign in</a>
              </li>
            </ul>
          </nav>
        </header>
        <article id="content">
          <header>
  <h1>Using Checkout and Rails</h1>
  <p>Get up and running with <a href="../../checkout.html">Checkout</a> and Ruby on Rails in no time at all! If you need help after reading this, check out our answers to <a href="https://support.stripe.com/search?q=checkout">common questions</a> or chat live with other developers in <a href="irc://irc.freenode.net/stripe">#stripe</a> on freenode.
</p>
<p>Stripe’s <a href="../checkout.html">Checkout</a> makes it easy to securely accept a customer’s credit card details. By directly sending card information from the customer’s browser to Stripe’s server, receiving a representative token in return, you can provide a seamless user experience without a heavy PCI compliance burden.</p></header>

<section>
<h2 id="getting-started">Getting started</h2>

<p>The first step is adding the Stripe gem to your application’s <strong>Gemfile</strong>:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>gem &#39;stripe&#39;</code></pre>
</div>

<p>Then, run <code>bundle install</code> to install the gem.</p>

<p>Next, generate a new <code>Charges</code> controller:</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>rails g controller charges</code></pre>
</div>

<p>The controller does two things:</p>

<ol>
  <li>Shows a credit card form (using Checkout).</li>
  <li>Creates the actual charges by calling our API.</li>
</ol>

<p>Add two actions to the controller:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>def new
end

def create
  # Amount in cents
  @amount = 500

  customer = Stripe::Customer.create(
    :email =&gt; params[:stripeEmail],
    :source  =&gt; params[:stripeToken]
  )

  charge = Stripe::Charge.create(
    :customer    =&gt; customer.id,
    :amount      =&gt; @amount,
    :description =&gt; &#39;Rails Stripe customer&#39;,
    :currency    =&gt; &#39;usd&#39;
  )

rescue Stripe::CardError =&gt; e
  flash[:error] = e.message
  redirect_to new_charge_path
end</code></pre>
</div>

<p>The code first creates a <a href="../api.html#customer_object">Customer</a> object using two POST parameters. You can create a charge directly, but creating a customer first allows for repeat billing. The <code>:source</code> property is set to the <code>stripeToken</code> parameter, representing the payment method provided. The token is automatically created by Checkout.</p>

<p>Stripe expects amounts to be in cents; since the charge is for $5, the <code>amount</code> parameter is assigned <strong>500</strong>. A <code>Charge</code> also takes an optional <code>:description</code> parameter, which can be anything meaningful to you. The customer ID is provided in the charge request, meaning the previously stored payment method will be charged.</p>

<p>Some payment attempts fail for a variety of reasons, such as an invalid CVC, bad card number, or general decline. Any <code>Stripe::CardError</code> exception will be caught and stored in the <code>flash</code> hash.</p></section>

<section>
<h2 id="defining-the-route">Defining the route</h2>

<p>So users can access the newly created controller, add a route to it in <strong>config/routes.rb</strong>:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>resources :charges</code></pre>
</div>
</section>

<section>
<h2 id="configuring-the-application">Configuring the application</h2>

<p>The application makes use of your publishable and secret API keys to interact with Stripe. An initializer is a good place to set these values, which will be provided when the application is started.</p>

<p>Add the following to <strong>config/initializers/stripe.rb</strong>:</p>
<div class="code">
  <pre class="language-ruby numbered" ><code>Rails.configuration.stripe = {
  :publishable_key =&gt; ENV[&#39;PUBLISHABLE_KEY&#39;],
  :secret_key      =&gt; ENV[&#39;SECRET_KEY&#39;]
}

Stripe.api_key = Rails.configuration.stripe[:secret_key]</code></pre>
</div>

<p>These keys values are pulled out of environmental variables so as not to hardcode them. It’s best practice not to write API keys into your code, where they could easily wind up in source control repositories and other non-private destinations.</p></section>

<section>
<h2 id="creating-the-views">Creating the views</h2>

<p>The next step is to create the relevant views: for the credit card form and for the charge response. Create a <strong>charges.html.erb</strong> layout under <strong>app/views/layouts</strong>:</p>
<div class="code">
  <pre class="language-html numbered" ><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>

<p>Now create <strong>new.html.erb</strong> under <strong>app/views/charges</strong>, which is the checkout page. Notice the page uses <a href="../checkout.html">Checkout</a>. Checkout displays a credit card overlay form, performs basic validation, and reports errors inline.</p>

<p>The form also has a place to report any server-side error that may occur:</p>
<div class="code">
  <pre class="language-html numbered" ><code>&lt;%= form_tag charges_path do %&gt;
  &lt;article&gt;
    &lt;% if flash[:error].present? %&gt;
      &lt;div id=&quot;error_explanation&quot;&gt;
        &lt;p&gt;&lt;%= flash[:error] %&gt;&lt;/p&gt;
      &lt;/div&gt;
    &lt;% end %&gt;
    &lt;label class=&quot;amount&quot;&gt;
      &lt;span&gt;Amount: $5.00&lt;/span&gt;
    &lt;/label&gt;
  &lt;/article&gt;

  &lt;script src=&quot;https://checkout.stripe.com/checkout.js&quot; class=&quot;stripe-button&quot;
          data-key=&quot;&lt;%= Rails.configuration.stripe[:publishable_key] %&gt;&quot;
          data-description=&quot;A month&#39;s subscription&quot;
          data-amount=&quot;500&quot;
          data-locale=&quot;auto&quot;&gt;&lt;/script&gt;
&lt;% end %&gt;</code></pre>
</div>

<p>Finally, make a <strong>create.html.erb</strong> view under <strong>app/views/charges</strong> that shows users a success message:</p>
<div class="code">
  <pre class="language-html numbered" ><code>&lt;h2&gt;Thanks, you paid &lt;strong&gt;$5.00&lt;/strong&gt;!&lt;/h2&gt;</code></pre>
</div>

<p>And that’s a wrap! A complete Stripe and Rails integration in a matter of minutes.</p></section>

<section>
<h2 id="testing-the-integration">Testing the integration</h2>

<p>To test the integration, start the Rails server, making sure to set the environmental variables to your <a href="https://dashboard.stripe.com/account/apikeys">publishable and secret keys</a>. For now, use the test keys, rather than your live ones:</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>PUBLISHABLE_KEY=pk_test_6pRNASCoBOKtIshFeQd4XMUh \
SECRET_KEY=sk_test_BQokikJOvBiI2HlWgH4olfQ2 rails s</code></pre>
</div>

<p>We’ve placed random API keys in the code. Replace these with your <a href="https://dashboard.stripe.com/account/apikeys">actual API keys</a> to test this code for yourself.</p>

<p>Now, navigate to <a href="http://localhost:3000/charges/new">http://localhost:3000/charges/new</a> to see the payment form ready to use. If you’re using test API keys, you can try the process with some dummy data. Enter the special credit card number <strong>4242 4242 4242 4242</strong>, a three-digit CVC, and any expiry date in the future. Submitting the form should bring up the successful charge page, and you can see the charge in the <a href="https://dashboard.stripe.com/test/payments">Dashboard</a>.</p></section>

<section>
<h2 id="deploying-to-heroku">Deploying to Heroku</h2>

<p>Now that you’ve created a basic payment page, you can deploy it somewhere so people can use it! Heroku is an awesome way to do this, and integrates seamlessly with Rails and Rack. First, get a <a href="https://www.heroku.com/">Heroku</a> account, and install the <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a>.</p>

<p>Now tell Heroku to deploy the application:</p>
<div class="code">
  <nav class="nav-filename icon-terminal">
    Terminal
  </nav>
  <pre class="language-bash numbered" ><code>git init
git add .
git commit -m &#39;My simple Stripe application&#39;
heroku create
heroku config:set PUBLISHABLE_KEY=pk_test_6pRNASCoBOKtIshFeQd4XMUh SECRET_KEY=sk_test_BQokikJOvBiI2HlWgH4olfQ2
git push heroku master
heroku open</code></pre>
</div>

<p>Again, when you’re ready for production usage, provide your live API keys in the deploy.</p></section>


          <footer>
  <h2>Questions?</h2>
  <p>We're always happy to help with code or other questions you might have! <a href="https://support.stripe.com/">Search</a> our site for more information, <a href="https://support.stripe.com/email">send us an email</a>, or <a href="../../contact/sales.html">get in touch</a> with our sales team!</p>
</footer>

        </article>
      </div>
    </div>

    <div id="loading-bar"></div>

    <script src="../../assets/external/jquery.min-94df374d2ad5d02ae136584dc008fb1c.js"></script>
    <script src="../../assets/prism-aa9f4cb7aff3f31b5394455bcbea0d8b.js"></script>
    <script src="../../assets/external/dynamics.min-14579f80273a61e6d0f4f45484e20dc7.js"></script>
    <script src="../../assets/jquery.cookie-d7482a1bbfda18d981eda4398666acdd.js"></script>
    <script src="../../assets/documentation-84c208e01668170139f2f511cfc37644.js"></script>
    <script>
      parseKey("sk_test_BQokikJOvBiI2HlWgH4olfQ2", "secret-key", null);
      parseKey("pk_test_6pRNASCoBOKtIshFeQd4XMUh", "publishable-key", null);
    </script>
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    
    <script src="../../assets/config-aead70c07cdca45cec67e4141bf18edc.js"></script>
    
<script type="application/json" id="analytics_config">{&quot;mixpanel&quot;:{&quot;identifier&quot;:&quot;eb71b6171a4f7ed97de9b7a0395b7ca5&quot;},&quot;ga&quot;:{},&quot;trackpage&quot;:true}</script>

<script src="https://js.stripe.com/internal/v2/analytics.min.js"></script>
<script src="../../assets/analytics-e800ab0ba76de2b697ea3f61c673695b.js"></script>
<script src="https://js.stripe.com/v2/m.js"></script>
<script src="../../assets/mirador_ping-6bba7d3d9fbb1e991b7f0f8fab43b2b1.js"></script>

    <script type="text/javascript">
    if ('Analytics' in window) {
      Analytics.viewed("docs", {
        docs_version: "2",
      });
    }
    </script>
  </body>

<!-- Mirrored from stripe.com/docs/checkout/rails by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 23:48:31 GMT -->
</html>
